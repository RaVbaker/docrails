<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
  <title>Przewodnik po asocjacjach modułu Active Record</title>
  <!--[if lt IE 8]>
  <script src="http://ie7-js.googlecode.com/svn/version/2.0(beta3)/IE8.js" type="text/javascript"></script>
  <![endif]-->
  <link href="stylesheets/base.css" media="screen" rel="Stylesheet" type="text/css" />
  <link href="stylesheets/forms.css" media="screen" rel="Stylesheet" type="text/css" />
  <link href="stylesheets/more.css" media="screen" rel="Stylesheet" type="text/css" />
</head>
<body>
  <div id="header" >
    <div id="logo">
      <a href="index.html" title="Ruby on Rails"><img src="images/rails_logo_remix.gif" alt="Rails" height="140" width="110" /></a>
    </div>

    <h1 id="site_title"><span>Ruby on Rails</span></h1>
    <h2 id="site_title_tagline">Sustainable productivity for web-application development</h2>

    <ul id="navMain">
      <li class="first-child"><a href="http://www.rubyonrails.org/" title="Ruby on Rails" class="ruby_on_rails">Ruby on Rails</a></li>
      <li><a class="manuals" href="index.html" title="Manuals Index">Guides Index</a></li>
    </ul>
  </div>

  <div id="container">
    
    <div id="sidebar">
      <h2>Chapters</h2>
      <ol>
          <li>
          <a href="#_dlaczego_asocjacje">Dlaczego Asocjacje?</a>
          </li>
          <li>
          <a href="#_typy_asocjacji">Typy asocjacji</a>
            <ul>
            
              <li><a href="#_asocjacja_tt_belongs_to_tt">Asocjacja <tt>belongs_to</tt></a></li>
            
              <li><a href="#_asocjacja_tt_has_one_tt">Asocjacja <tt>has_one</tt></a></li>
            
              <li><a href="#_asocjacja_tt_has_many_tt">Asocjacja <tt>has_many</tt></a></li>
            
              <li><a href="#_asocjacja_has_many_through">Asocjacja has_many :through</a></li>
            
              <li><a href="#_asocjacja_tt_has_one_through_tt">Asocjacja <tt>has_one :through</tt></a></li>
            
              <li><a href="#_asocjacja_tt_has_and_belongs_to_many_tt">Asocjacja <tt>has_and_belongs_to_many</tt></a></li>
            
              <li><a href="#_wyb_r_pomi_dzy_tt_belongs_to_tt_i_tt_has_one_tt">Wybór pomiędzy <tt>belongs_to</tt> i <tt>has_one</tt></a></li>
            
              <li><a href="#_wyb_r_pomi_dzy_tt_has_many_through_tt_i_tt_has_and_belongs_to_many_tt">Wybór pomiędzy <tt>has_many :through</tt> i <tt>has_and_belongs_to_many</tt></a></li>
            
              <li><a href="#_asocjacje_polimorficzne">Asocjacje polimorficzne</a></li>
            
              <li><a href="#_samoodniesienie_wi_zanie_rekurencyjne">Samoodniesienie (wiązanie rekurencyjne)</a></li>
            
            </ul>
          </li>
          <li>
          <a href="#_porady_triki_i_ostrze_enia">Porady, triki i ostrzeżenia</a>
            <ul>
            
              <li><a href="#_kontrolowanie_cachingu">Kontrolowanie cachingu</a></li>
            
              <li><a href="#_unikanie_kolizji_nazw">Unikanie kolizji nazw</a></li>
            
              <li><a href="#_aktualizacja_schematu">Aktualizacja schematu</a></li>
            
              <li><a href="#_kontrolowanie_zakresu_widoczno_ci_asocjacji">Kontrolowanie zakresu widoczności asocjacji</a></li>
            
            </ul>
          </li>
          <li>
          <a href="#_szczeg_owy_spis_asocjacji">Szczegółowy spis asocjacji</a>
            <ul>
            
              <li><a href="#_asocjacja_belongs_to">Asocjacja belongs_to</a></li>
            
              <li><a href="#_asocjacja_tt_has_one_tt_2">Asocjacja <tt>has_one</tt></a></li>
            
              <li><a href="#_asocjacja_has_many">Asocjacja has_many</a></li>
            
              <li><a href="#_asocjacja_tt_has_and_belongs_to_many_tt_2">Asocjacja <tt>has_and_belongs_to_many</tt></a></li>
            
              <li><a href="#_callbacki_asocjacji">Callbacki asocjacji</a></li>
            
              <li><a href="#_rozszerzenia_asocjacji">Rozszerzenia asocjacji</a></li>
            
            </ul>
          </li>
          <li>
          <a href="#_changelog">Changelog</a>
          </li>
      </ol>
    </div>
    
    <div id="content">
        <h1>Przewodnik po asocjacjach modułu Active Record</h1>
      <div id="preamble">
<div class="sectionbody">
<div class="paragraph"><p>Niniejszy przewodnik obejmuje opis asocjacji (<em>associations</em>) – elementów modułu Active
Record. Z pomocą tego przewodnika będziesz w stanie:</p></div>
<div class="ulist"><ul>
<li>
<p>
Zadeklarować asocjacje w modelach wykorzystujących moduł Active Record
</p>
</li>
<li>
<p>
Zrozumieć różne typy asocjacji dostępnych w ramach modułu Active Record
</p>
</li>
<li>
<p>
Stosować metody dodane do twoich modeli dzięki stworzeniu asocjacji
</p>
</li>
</ul></div>
</div>
</div>
<h2 id="_dlaczego_asocjacje">1. Dlaczego Asocjacje?</h2>
<div class="sectionbody">
<div class="paragraph"><p>Dlaczego potrzebne są asocjacje (<em>powiązania</em>, <em>połączenia</em> - przyp. tłum.) między
modelami? Ponieważ sprawiają one, że wspólne operacje (czyli operacje na kilku modelach
– przyp.tłum.) stają się mniej skomplikowane i łatwe do implementacji w kodzie.
Na przykład, pomyśl o prostej aplikacji zawierającej dwa modele – klienta (<em>customer</em>)
oraz zamówień (<em>order(s)</em>). Każdy klient może składać wiele zamówień.
Bez zdefiniowania powiązania deklaracja modelu mogłaby wyglądać tak:</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 2.11
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="font-weight: bold"><span style="color: #0000FF">class</span></span> Customer <span style="color: #990000">&lt;</span> ActiveRecord<span style="color: #990000">::</span>Base
<span style="font-weight: bold"><span style="color: #0000FF">end</span></span>

<span style="font-weight: bold"><span style="color: #0000FF">class</span></span> Order <span style="color: #990000">&lt;</span> ActiveRecord<span style="color: #990000">::</span>Base
<span style="font-weight: bold"><span style="color: #0000FF">end</span></span></tt></pre></div></div>
<div class="paragraph"><p>Teraz załóżmy, że chcielibyśmy dodać nowe zamówienie złożone przez istniejącego klienta. Należałoby zrobić coś takiego:</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 2.11
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="color: #009900">@order</span> <span style="color: #990000">=</span> Order<span style="color: #990000">.</span>create<span style="color: #990000">(:</span>order_date <span style="color: #990000">=&gt;</span> Time<span style="color: #990000">.</span>now<span style="color: #990000">,</span> <span style="color: #990000">:</span>customer_id <span style="color: #990000">=&gt;</span> <span style="color: #009900">@customer</span><span style="color: #990000">.</span>id<span style="color: #990000">)</span></tt></pre></div></div>
<div class="paragraph"><p>Przypuśćmy, że chcemy teraz usunąć klienta. W takim przypadku powinniśmy zadbać, by wszystkie zamówienia złożone przez niego zostały również usunięte:</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 2.11
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="color: #009900">@orders</span> <span style="color: #990000">=</span> Order<span style="color: #990000">.</span>find_by_customer_id<span style="color: #990000">(</span><span style="color: #009900">@customer</span><span style="color: #990000">.</span>id<span style="color: #990000">)</span>
<span style="color: #009900">@orders</span><span style="color: #990000">.</span>each <span style="font-weight: bold"><span style="color: #0000FF">do</span></span> <span style="color: #990000">|</span>order<span style="color: #990000">|</span>
  order<span style="color: #990000">.</span>destroy
<span style="font-weight: bold"><span style="color: #0000FF">end</span></span>
<span style="color: #009900">@customer</span><span style="color: #990000">.</span>destroy</tt></pre></div></div>
<div class="paragraph"><p>Z asocjacjami modułu Active Record można znacznie usprawnić tego typu operacje (i wiele innych). Poprzez deklarację możemy <em>powiedzieć</em> Railsom, że istnieje relacja między dwoma modelami. Oto poprawione zgodnie z tymi założeniami modele - klienta i zamówienia:</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 2.11
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="font-weight: bold"><span style="color: #0000FF">class</span></span> Customer <span style="color: #990000">&lt;</span> ActiveRecord<span style="color: #990000">::</span>Base
  has_many <span style="color: #990000">:</span>orders
<span style="font-weight: bold"><span style="color: #0000FF">end</span></span>

<span style="font-weight: bold"><span style="color: #0000FF">class</span></span> Order <span style="color: #990000">&lt;</span> ActiveRecord<span style="color: #990000">::</span>Base
  belongs_to <span style="color: #990000">:</span>customer
<span style="font-weight: bold"><span style="color: #0000FF">end</span></span></tt></pre></div></div>
<div class="paragraph"><p>Dzięki tej zmianie stworzenie nowego zamówienia dla konkretnego klienta jest łatwiejsze:</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 2.11
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="color: #009900">@order</span> <span style="color: #990000">=</span> <span style="color: #009900">@customer</span><span style="color: #990000">.</span>orders<span style="color: #990000">.</span>create<span style="color: #990000">(:</span>order_date <span style="color: #990000">=&gt;</span> Time<span style="color: #990000">.</span>now<span style="color: #990000">)</span></tt></pre></div></div>
<div class="paragraph"><p>Także usuwanie klienta i jego wszystkich zamówień jest <em>o</em> <em>wiele</em> prostsze.</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 2.11
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="color: #009900">@customer</span><span style="color: #990000">.</span>destroy</tt></pre></div></div>
<div class="paragraph"><p>Aby dowiedzieć się więcej o różnych rodzajach asocjacji, przeczytaj następny rozdział tego przewodnika. Zapoznasz się tam z kilkoma wskazówkami i trikami przydatnymi w pracy z asocjacjami, a także z kompletnym spisem metod i opcji dla asocjacji w Railsach.</p></div>
</div>
<h2 id="_typy_asocjacji">2. Typy asocjacji</h2>
<div class="sectionbody">
<div class="paragraph"><p>W Railsach <em>asocjacja</em> to powiązanie ze sobą modeli wykorzystujących moduł Active Record. Asocjacje są realizowane poprzez makro-połączenia, a więc dzięki dodaniu stosownej funkcji do modelu poprzez jej zadeklarowanie. Na przykład, deklarując, że jeden model <em>należy do</em> (<tt>belongs_to</tt>) innego, instruujesz Railsy by utrzymywały powiązanie klucza podstawowego z obcym kluczem między instancjami tych dwóch modeli, a dzięki temu otrzymujesz także szereg narzędzi (metod), które możesz wykorzystać w swoim modelu. Railsy obsługują sześć typów asocjacji:</p></div>
<div class="ulist"><ul>
<li>
<p>
<tt>belongs_to</tt>
</p>
</li>
<li>
<p>
<tt>has_one</tt>
</p>
</li>
<li>
<p>
<tt>has_many</tt>
</p>
</li>
<li>
<p>
<tt>has_many :through</tt>
</p>
</li>
<li>
<p>
<tt>has_one :through</tt>
</p>
</li>
<li>
<p>
<tt>has_and_belongs_to_many</tt>
</p>
</li>
</ul></div>
<div class="paragraph"><p>W dalszej części przewodnika dowiesz się jak deklarować asocjacje i jak używać różnych z nich. Ale najpierw – krótkie wprowadzenie do przypadków właściwych użyć poszczególnych asocjacji.</p></div>
<h3 id="_asocjacja_tt_belongs_to_tt">2.1. Asocjacja <tt>belongs_to</tt></h3>
<div class="paragraph"><p>Asocjacja <tt>belongs_to</tt> ustanawia relację  typu jeden-do-jeden z innym modelem w taki sposób, że każda instancja  zadeklarowanego modelu "należy do" (<em>belongs</em> <em>to</em>) jednej instancji innego modelu.
Na przykład: jeśli twoja aplikacja zawiera modele klientów i ich zamówienia, a każde zamówienie przypisane jest dokładnie do jednego klienta, można zadeklarować model zamówienia w ten sposób:</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 2.11
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="font-weight: bold"><span style="color: #0000FF">class</span></span> Order <span style="color: #990000">&lt;</span> ActiveRecord<span style="color: #990000">::</span>Base
  belongs_to <span style="color: #990000">:</span>customer
<span style="font-weight: bold"><span style="color: #0000FF">end</span></span></tt></pre></div></div>
<div class="paragraph"><p><span class="image">
<img src="images/belongs_to.png" alt="diagram asocjacji belongs_to" title="diagram asocjacji belongs_to" />
</span></p></div>
<h3 id="_asocjacja_tt_has_one_tt">2.2. Asocjacja <tt>has_one</tt></h3>
<div class="paragraph"><p>Asocjacja <tt>has_one</tt> również ustanawia relację typu jeden-do-jeden pomiędzy dwoma
modelami, jednak posiada inną semantykę (i konsekwencje). Ta asocjacja wskazuje, iż
każda instancja jednego modelu posiada jedną instancję drugiego.
Na przykład: Każdy dostawca (<em>supplier</em>) w twojej aplikacji ma tylko jedno konto –
możesz zadeklarować model dostawcy w taki sposób:</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 2.11
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="font-weight: bold"><span style="color: #0000FF">class</span></span> Supplier <span style="color: #990000">&lt;</span> ActiveRecord<span style="color: #990000">::</span>Base
  has_one <span style="color: #990000">:</span>account
<span style="font-weight: bold"><span style="color: #0000FF">end</span></span></tt></pre></div></div>
<div class="paragraph"><p><span class="image">
<img src="images/has_one.png" alt="diagram asocjacji has_one" title="diagram asocjacji has_one" />
</span></p></div>
<h3 id="_asocjacja_tt_has_many_tt">2.3. Asocjacja <tt>has_many</tt></h3>
<div class="paragraph"><p>Asocjacja <tt>has_many</tt> wskazuje relację typu jeden-do-wiele. Będziesz mógł często znaleźć tę asocjację "po drugiej stronie" asocjacji <tt>belongs_to</tt>. Ta relacja wskazuje, że każda instancja modelu posiada zero i więcej instancji innego modelu.
Na przykład, w aplikacji zawierającej klientów i zamówienia, model klienta mógłby zostać zadeklarowany następująco:</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 2.11
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="font-weight: bold"><span style="color: #0000FF">class</span></span> Customer <span style="color: #990000">&lt;</span> ActiveRecord<span style="color: #990000">::</span>Base
  has_many <span style="color: #990000">:</span>orders
<span style="font-weight: bold"><span style="color: #0000FF">end</span></span></tt></pre></div></div>
<div class="admonitionblock">
<table><tr>
<td class="icon">
<img src="./images/icons/note.png" alt="Note" />
</td>
<td class="content">Kiedy deklarujemy asocjację <tt>has_many</tt>, nazwa wiązanego modelu jest zamieniana na jej liczbę mnogą (oczywiście mowa tu o gramatyce języka angielskiego - przyp. tłum.).</td>
</tr></table>
</div>
<div class="paragraph"><p><span class="image">
<img src="images/has_many.png" alt="diagram asocjacji has_many" title="diagram asocjacji has_many" />
</span></p></div>
<h3 id="_asocjacja_has_many_through">2.4. Asocjacja has_many :through</h3>
<div class="paragraph"><p>Asocjacja <tt>has_many :through</tt> (<em>posiada_wiele :poprzez</em>) często używana jest do stworzenia relacji wiele-do-wiele z innym modelem. Asocjacja wskazuje, że zadeklarowany model może być powiązany z zerem i większą ilością instancji innego modelu poprzez trzeci model (dzięki użyciu <em>through</em>).
Na przykład, wyobraź sobie praktykę lekarską, gdzie pacjenci (<em>patient(s)</em>) rezerwują wizyty (<em>appointment(s)</em>) u lekarzy (<em>physician(s)</em>). Odpowiednio zadeklarowana asocjacja mogłaby wyglądać tak:</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 2.11
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="font-weight: bold"><span style="color: #0000FF">class</span></span> Physician <span style="color: #990000">&lt;</span> ActiveRecord<span style="color: #990000">::</span>Base
  has_many <span style="color: #990000">:</span>appointments
  has_many <span style="color: #990000">:</span>patients<span style="color: #990000">,</span> <span style="color: #990000">:</span>through <span style="color: #990000">=&gt;</span> <span style="color: #990000">:</span>appointments
<span style="font-weight: bold"><span style="color: #0000FF">end</span></span>

<span style="font-weight: bold"><span style="color: #0000FF">class</span></span> Appointment <span style="color: #990000">&lt;</span> ActiveRecord<span style="color: #990000">::</span>Base
  belongs_to <span style="color: #990000">:</span>physician
  belongs_to <span style="color: #990000">:</span>patient
<span style="font-weight: bold"><span style="color: #0000FF">end</span></span>

<span style="font-weight: bold"><span style="color: #0000FF">class</span></span> Patient <span style="color: #990000">&lt;</span> ActiveRecord<span style="color: #990000">::</span>Base
  has_many <span style="color: #990000">:</span>appointments
  has_many <span style="color: #990000">:</span>physicians<span style="color: #990000">,</span> <span style="color: #990000">:</span>through <span style="color: #990000">=&gt;</span> <span style="color: #990000">:</span>appointments
<span style="font-weight: bold"><span style="color: #0000FF">end</span></span></tt></pre></div></div>
<div class="paragraph"><p><span class="image">
<img src="images/has_many_through.png" alt="diagram asocjacji has_many :through" title="diagram asocjacji has_many :through" />
</span></p></div>
<div class="paragraph"><p>Asocjacja <tt>has_many :through</tt> przydaje się także do tworzenia "skrótów" poprzez zagnieżdżone asocjacje <tt>has_many</tt>. Na przykład, jeśli dokument ma wiele rozdziałów (<em>sections</em>), a rozdział wiele paragrafów (<em>paragraph</em>), możesz czasem chcieć utworzyć prosty zbiór (in. kolekcję - <em>collection</em>) wszystkich paragrafów w dokumencie. Da się to zrobić w ten sposób:</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 2.11
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="font-weight: bold"><span style="color: #0000FF">class</span></span> Document <span style="color: #990000">&lt;</span> ActiveRecord<span style="color: #990000">::</span>Base
  has_many <span style="color: #990000">:</span>sections
  has_many <span style="color: #990000">:</span>paragraphs<span style="color: #990000">,</span> <span style="color: #990000">:</span>through <span style="color: #990000">=&gt;</span> <span style="color: #990000">:</span>sections
<span style="font-weight: bold"><span style="color: #0000FF">end</span></span>

<span style="font-weight: bold"><span style="color: #0000FF">class</span></span> Section <span style="color: #990000">&lt;</span> ActiveRecord<span style="color: #990000">::</span>Base
  belongs_to <span style="color: #990000">:</span>document
  has_many <span style="color: #990000">:</span>paragraphs
<span style="font-weight: bold"><span style="color: #0000FF">end</span></span>

<span style="font-weight: bold"><span style="color: #0000FF">class</span></span> Paragraph <span style="color: #990000">&lt;</span> ActiveRecord<span style="color: #990000">::</span>Base
  belongs_to <span style="color: #990000">:</span>section
<span style="font-weight: bold"><span style="color: #0000FF">end</span></span></tt></pre></div></div>
<h3 id="_asocjacja_tt_has_one_through_tt">2.5. Asocjacja <tt>has_one :through</tt></h3>
<div class="paragraph"><p>Asocjacja <tt>has_one :through</tt> (<em>posiada jeden :poprzez</em>) ustanawia relację typu jeden-do-jeden z innym modelem. Asocjacja ta wskazuje, że deklaracja jednego modelu może być dopasowana do instancji innego modelu poprzez model trzeci.
Na przykład, jeśli każdy dostawca posiada jedno konto (<em>account</em>), a każde konto jest powiązane (<em>associate</em>) z jedną historią konta (<em>account history</em>), wtedy model klienta  mógłby wyglądać następująco:</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 2.11
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="font-weight: bold"><span style="color: #0000FF">class</span></span> Supplier <span style="color: #990000">&lt;</span> ActiveRecord<span style="color: #990000">::</span>Base
  has_one <span style="color: #990000">:</span>account
  has_one <span style="color: #990000">:</span>account_history<span style="color: #990000">,</span> <span style="color: #990000">:</span>through <span style="color: #990000">=&gt;</span> <span style="color: #990000">:</span>account
<span style="font-weight: bold"><span style="color: #0000FF">end</span></span>

<span style="font-weight: bold"><span style="color: #0000FF">class</span></span> Account <span style="color: #990000">&lt;</span> ActiveRecord<span style="color: #990000">::</span>Base
  belongs_to <span style="color: #990000">:</span>supplier
  has_one <span style="color: #990000">:</span>account_history
<span style="font-weight: bold"><span style="color: #0000FF">end</span></span>

<span style="font-weight: bold"><span style="color: #0000FF">class</span></span> AccountHistory <span style="color: #990000">&lt;</span> ActiveRecord<span style="color: #990000">::</span>Base
  belongs_to <span style="color: #990000">:</span>account
<span style="font-weight: bold"><span style="color: #0000FF">end</span></span></tt></pre></div></div>
<div class="paragraph"><p><span class="image">
<img src="images/has_one_through.png" alt="diagram asocjacji has_one :through" title="diagram asocjacji has_one :through" />
</span></p></div>
<h3 id="_asocjacja_tt_has_and_belongs_to_many_tt">2.6. Asocjacja <tt>has_and_belongs_to_many</tt></h3>
<div class="paragraph"><p>Asocjacja has_and_belongs_to_many tworzy bezpośrednią relację typu
wiele-do-wiele z innym modelem bez ingerencji modelu pośredniego (nie ma
potrzeby deklarowania go, jednak zauważyć należy, iż jest wykorzystywna stosowna tabela wiążąca - przyp.tłum.).
Na przykład, jeżeli projekt miałby zawierać zbiory (zestawy - <em>assembly(ies)</em>)  i części
(<em>part(s)</em>) oraz każdy zbiór posiadałby wiele części, a każda część mogłaby pojawić się
w wielu zbiorach,  modele można zadeklarować w ten sposób:</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 2.11
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="font-weight: bold"><span style="color: #0000FF">class</span></span> Assembly <span style="color: #990000">&lt;</span> ActiveRecord<span style="color: #990000">::</span>Base
  has_and_belongs_to_many <span style="color: #990000">:</span>parts
<span style="font-weight: bold"><span style="color: #0000FF">end</span></span>

<span style="font-weight: bold"><span style="color: #0000FF">class</span></span> Part <span style="color: #990000">&lt;</span> ActiveRecord<span style="color: #990000">::</span>Base
  has_and_belongs_to_many <span style="color: #990000">:</span>assemblies
<span style="font-weight: bold"><span style="color: #0000FF">end</span></span></tt></pre></div></div>
<div class="paragraph"><p><span class="image">
<img src="images/habtm.png" alt="diagram asocjacji has_and_belongs_to_many" title="diagram asocjacji has_and_belongs_to_many" />
</span></p></div>
<h3 id="_wyb_r_pomi_dzy_tt_belongs_to_tt_i_tt_has_one_tt">2.7. Wybór pomiędzy <tt>belongs_to</tt> i <tt>has_one</tt></h3>
<div class="paragraph"><p>Jeśli chcesz ustawić relację typu jeden-do-jeden między dwoma modelami, powinieneś użyć asocjacji <tt>belongs_to</tt> do jednego i <tt>has_one</tt> do drugiego. Ale skąd wiedzieć która powinna być w którym modelu?</p></div>
<div class="paragraph"><p>Rozróżnić to należy sprawdzając, w której tabeli (w którym modelu) ustawiłeś klucz obcy (foreign key) (dla klasy tej tabeli potrzebujesz asocjacji <tt>belongs_to</tt>), ale powinieneś pomyśleć także nad znaczeniem danych. Relacja <tt>has_one</tt> mówi, że "jednen ze zbioru" należy do ciebie – tzn. że coś wskazuje z powrotem na ciebie.
Na przykład: ma większy sens powiedzenie, że dostawca posiada konto, aniżeli konto posiada dostawcę. To sugeruje nam, że poprawne relacje wyglądają tak:</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 2.11
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="font-weight: bold"><span style="color: #0000FF">class</span></span> Supplier <span style="color: #990000">&lt;</span> ActiveRecord<span style="color: #990000">::</span>Base
  has_one <span style="color: #990000">:</span>account
<span style="font-weight: bold"><span style="color: #0000FF">end</span></span>

<span style="font-weight: bold"><span style="color: #0000FF">class</span></span> Account <span style="color: #990000">&lt;</span> ActiveRecord<span style="color: #990000">::</span>Base
  belongs_to <span style="color: #990000">:</span>supplier
<span style="font-weight: bold"><span style="color: #0000FF">end</span></span></tt></pre></div></div>
<div class="paragraph"><p>Powiązana relacja może wyglądać tak:</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 2.11
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="font-weight: bold"><span style="color: #0000FF">class</span></span> CreateSuppliers <span style="color: #990000">&lt;</span> ActiveRecord<span style="color: #990000">::</span>Migration
  <span style="font-weight: bold"><span style="color: #0000FF">def</span></span> <span style="font-weight: bold"><span style="color: #0000FF">self</span></span><span style="color: #990000">.</span>up
    create_table <span style="color: #990000">:</span>suppliers <span style="font-weight: bold"><span style="color: #0000FF">do</span></span> <span style="color: #990000">|</span>t<span style="color: #990000">|</span>
      t<span style="color: #990000">.</span>string  <span style="color: #990000">:</span>name
      t<span style="color: #990000">.</span>timestamps
    <span style="font-weight: bold"><span style="color: #0000FF">end</span></span>

    create_table <span style="color: #990000">:</span>accounts <span style="font-weight: bold"><span style="color: #0000FF">do</span></span> <span style="color: #990000">|</span>t<span style="color: #990000">|</span>
      t<span style="color: #990000">.</span>integer <span style="color: #990000">:</span>supplier_id
      t<span style="color: #990000">.</span>string  <span style="color: #990000">:</span>account_number
      t<span style="color: #990000">.</span>timestamps
    <span style="font-weight: bold"><span style="color: #0000FF">end</span></span>
  <span style="font-weight: bold"><span style="color: #0000FF">end</span></span>

  <span style="font-weight: bold"><span style="color: #0000FF">def</span></span> <span style="font-weight: bold"><span style="color: #0000FF">self</span></span><span style="color: #990000">.</span>down
    drop_table <span style="color: #990000">:</span>accounts
    drop_table <span style="color: #990000">:</span>suppliers
  <span style="font-weight: bold"><span style="color: #0000FF">end</span></span>
<span style="font-weight: bold"><span style="color: #0000FF">end</span></span></tt></pre></div></div>
<div class="admonitionblock">
<table><tr>
<td class="icon">
<img src="./images/icons/note.png" alt="Note" />
</td>
<td class="content">Użycie t.integer :supplier_id powoduje, że nazwa klucza obcego jest podana wprost, ale jednocześnie samo użycie
klucza jest niejawne. W obecnej wersji Railsów można ukryć ten szczegół implementacyjny używając składni t.references :supplier</td>
</tr></table>
</div>
<h3 id="_wyb_r_pomi_dzy_tt_has_many_through_tt_i_tt_has_and_belongs_to_many_tt">2.8. Wybór pomiędzy <tt>has_many :through</tt> i <tt>has_and_belongs_to_many</tt></h3>
<div class="paragraph"><p>Railsy oferują dwa sposoby deklaracji relacji tyou wiele-do-wiele między modelami. Łatwiejszym wyjściem jest użycie <tt>has_and_belongs_to_many</tt>, które umożliwia bezpośrednie ustanowienie asocjacji:</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 2.11
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="font-weight: bold"><span style="color: #0000FF">class</span></span> Assembly <span style="color: #990000">&lt;</span> ActiveRecord<span style="color: #990000">::</span>Base
  has_and_belongs_to_many <span style="color: #990000">:</span>parts
<span style="font-weight: bold"><span style="color: #0000FF">end</span></span>

<span style="font-weight: bold"><span style="color: #0000FF">class</span></span> Part <span style="color: #990000">&lt;</span> ActiveRecord<span style="color: #990000">::</span>Base
  has_and_belongs_to_many <span style="color: #990000">:</span>assemblies
<span style="font-weight: bold"><span style="color: #0000FF">end</span></span></tt></pre></div></div>
<div class="paragraph"><p>Druga opcja implementacji relacji tyou wiele-do-wiele to użycie <tt>has_many :through</tt>. Ustanawia to asocjację pośrednio, poprzed dołączenie dodatkowego modelu (<em>join model</em>):</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 2.11
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="font-weight: bold"><span style="color: #0000FF">class</span></span> Assembly <span style="color: #990000">&lt;</span> ActiveRecord<span style="color: #990000">::</span>Base
  has_many <span style="color: #990000">:</span>manifests
  has_many <span style="color: #990000">:</span>parts<span style="color: #990000">,</span> <span style="color: #990000">:</span>through <span style="color: #990000">=&gt;</span> <span style="color: #990000">:</span>manifests
<span style="font-weight: bold"><span style="color: #0000FF">end</span></span>

<span style="font-weight: bold"><span style="color: #0000FF">class</span></span> Manifest <span style="color: #990000">&lt;</span> ActiveRecord<span style="color: #990000">::</span>Base
  belongs_to <span style="color: #990000">:</span>assembly
  belongs_to <span style="color: #990000">:</span>part
<span style="font-weight: bold"><span style="color: #0000FF">end</span></span>

<span style="font-weight: bold"><span style="color: #0000FF">class</span></span> Part <span style="color: #990000">&lt;</span> ActiveRecord<span style="color: #990000">::</span>Base
  has_many <span style="color: #990000">:</span>manifests
  has_many <span style="color: #990000">:</span>assemblies<span style="color: #990000">,</span> <span style="color: #990000">:</span>through <span style="color: #990000">=&gt;</span> <span style="color: #990000">:</span>manifests
<span style="font-weight: bold"><span style="color: #0000FF">end</span></span></tt></pre></div></div>
<div class="paragraph"><p>Najłatwiejsza zasada polega na tym, że ustawiasz relację <tt>has_many :through</tt> jeśli chcesz pracować z pośrednim (wiążącym pozostałe dwa) modelem jako niezależnym bytem. Jeśli jednak nie potrzebujesz niczego z nim robić, łatwiejsze będzie wykorzystanie asocjacji <tt>has_and_belongs_to_many</tt> (choć musisz pamiętać, że należy stworzyć tabelę łączącą)</p></div>
<div class="paragraph"><p>Należy używać <tt>:has_many :through</tt> jeśli potrzebujesz opcji walidacji, callback-ów lub dodatkowych atrybutów dla wiążącego modelu.</p></div>
<h3 id="_asocjacje_polimorficzne">2.9. Asocjacje polimorficzne</h3>
<div class="paragraph"><p>Nieco bardziej zaawansowanym typem asocjacji jest asocjacja polimorficzna. Dzięki polimorficznym asocjacjom model może być powiązany z więcej niż jednym innym modelem, za pomocją pojedynczej asocjacji.
Na przykład, chcesz mieć model  "zdjęcia" (<em>picture</em>), który należy do (<tt>belongs_to</tt>) modelu pracownika (<em>employee</em>) lub produktu (<em>product</em>). Oto w jaki sposób mogłoby to zostać zadeklarowane:</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 2.11
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="font-weight: bold"><span style="color: #0000FF">class</span></span> Picture <span style="color: #990000">&lt;</span> ActiveRecord<span style="color: #990000">::</span>Base
  belongs_to <span style="color: #990000">:</span>imageable<span style="color: #990000">,</span> <span style="color: #990000">:</span>polymorphic <span style="color: #990000">=&gt;</span> <span style="font-weight: bold"><span style="color: #0000FF">true</span></span>
<span style="font-weight: bold"><span style="color: #0000FF">end</span></span>

<span style="font-weight: bold"><span style="color: #0000FF">class</span></span> Employee <span style="color: #990000">&lt;</span> ActiveRecord<span style="color: #990000">::</span>Base
  has_many <span style="color: #990000">:</span>pictures<span style="color: #990000">,</span> <span style="color: #990000">:</span>as <span style="color: #990000">=&gt;</span> <span style="color: #990000">:</span>imageable
<span style="font-weight: bold"><span style="color: #0000FF">end</span></span>

<span style="font-weight: bold"><span style="color: #0000FF">class</span></span> Product <span style="color: #990000">&lt;</span> ActiveRecord<span style="color: #990000">::</span>Base
  has_many <span style="color: #990000">:</span>pictures<span style="color: #990000">,</span> <span style="color: #990000">:</span>as <span style="color: #990000">=&gt;</span> <span style="color: #990000">:</span>imageable
<span style="font-weight: bold"><span style="color: #0000FF">end</span></span></tt></pre></div></div>
<div class="paragraph"><p>Mógłbyś pomyśleć, że polimofriczna deklaracja <tt>belongs_to</tt> ustanawia taki interfejs, że żaden inny model nie może go użyć. Z instancji modelu pracownika (<tt>Employee</tt>) można pobrać zbiór zdjęć: <tt>@employee.pictures</tt>. Podobnie, możesz pobrać zdjęcia produktów - <tt>@product.pictures</tt>. Jeśli masz instancję modelu zdjęcia (<tt>Picture</tt>), możesz "dostać się" do jego rodzica dzięki <tt>@picture.imageable</tt>. By to zadziałało, potrzebujesz zadeklarować w modelu, który ma mieć polimorficzny interfejs (tu: <tt>Picture</tt>) dwie rzeczy: klucz obcy (dla id pracownika lub produktu – przyp. tłum.), jak i "typ” wiązanego modelu:</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 2.11
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="font-weight: bold"><span style="color: #0000FF">class</span></span> CreatePictures <span style="color: #990000">&lt;</span> ActiveRecord<span style="color: #990000">::</span>Migration
  <span style="font-weight: bold"><span style="color: #0000FF">def</span></span> <span style="font-weight: bold"><span style="color: #0000FF">self</span></span><span style="color: #990000">.</span>up
    create_table <span style="color: #990000">:</span>pictures <span style="font-weight: bold"><span style="color: #0000FF">do</span></span> <span style="color: #990000">|</span>t<span style="color: #990000">|</span>
      t<span style="color: #990000">.</span>string  <span style="color: #990000">:</span>name
      t<span style="color: #990000">.</span>integer <span style="color: #990000">:</span>imageable_id
      t<span style="color: #990000">.</span>string  <span style="color: #990000">:</span>imageable_type
      t<span style="color: #990000">.</span>timestamps
    <span style="font-weight: bold"><span style="color: #0000FF">end</span></span>
  <span style="font-weight: bold"><span style="color: #0000FF">end</span></span>

  <span style="font-weight: bold"><span style="color: #0000FF">def</span></span> <span style="font-weight: bold"><span style="color: #0000FF">self</span></span><span style="color: #990000">.</span>down
    drop_table <span style="color: #990000">:</span>pictures
  <span style="font-weight: bold"><span style="color: #0000FF">end</span></span>
<span style="font-weight: bold"><span style="color: #0000FF">end</span></span></tt></pre></div></div>
<div class="paragraph"><p>Migracja dla takiego modelu może być uproszczona dzięki użyciu t.references:</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 2.11
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="font-weight: bold"><span style="color: #0000FF">class</span></span> CreatePictures <span style="color: #990000">&lt;</span> ActiveRecord<span style="color: #990000">::</span>Migration
  <span style="font-weight: bold"><span style="color: #0000FF">def</span></span> <span style="font-weight: bold"><span style="color: #0000FF">self</span></span><span style="color: #990000">.</span>up
    create_table <span style="color: #990000">:</span>pictures <span style="font-weight: bold"><span style="color: #0000FF">do</span></span> <span style="color: #990000">|</span>t<span style="color: #990000">|</span>
      t<span style="color: #990000">.</span>string  <span style="color: #990000">:</span>name
      t<span style="color: #990000">.</span>references <span style="color: #990000">:</span>imageable<span style="color: #990000">,</span> <span style="color: #990000">:</span>polymorphic <span style="color: #990000">=&gt;</span> <span style="font-weight: bold"><span style="color: #0000FF">true</span></span>
      t<span style="color: #990000">.</span>timestamps
    <span style="font-weight: bold"><span style="color: #0000FF">end</span></span>
  <span style="font-weight: bold"><span style="color: #0000FF">end</span></span>

  <span style="font-weight: bold"><span style="color: #0000FF">def</span></span> <span style="font-weight: bold"><span style="color: #0000FF">self</span></span><span style="color: #990000">.</span>down
    drop_table <span style="color: #990000">:</span>pictures
  <span style="font-weight: bold"><span style="color: #0000FF">end</span></span>
<span style="font-weight: bold"><span style="color: #0000FF">end</span></span></tt></pre></div></div>
<div class="paragraph"><p><span class="image">
<img src="images/polymorphic.png" alt="diagram asocjacji polimorficznej" title="diagram asocjacji polimorficznej" />
</span></p></div>
<h3 id="_samoodniesienie_wi_zanie_rekurencyjne">2.10. Samoodniesienie (wiązanie rekurencyjne)</h3>
<div class="paragraph"><p>Przy projektowaniu modeli danych, możesz czasem natknąć się na model, który powinien mieć odniesienie do siebie samego. Na przykład, chcesz przechowywać wszystkich pracowników w jednym modelu bazy danych (w jednej tabeli w bazie), ale też chciałbyś móc prześledzić hierarchie między pracownikami (takie jak manager i jego podwładni). Takie powiązanie może być zadeklarowane za pomocą asocjacji samoodniesienia:</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 2.11
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="font-weight: bold"><span style="color: #0000FF">class</span></span> Employee <span style="color: #990000">&lt;</span> ActiveRecord<span style="color: #990000">::</span>Base
  has_many <span style="color: #990000">:</span>subordinates<span style="color: #990000">,</span> <span style="color: #990000">:</span>class_name <span style="color: #990000">=&gt;</span> <span style="color: #FF0000">"Employee"</span><span style="color: #990000">,</span> <span style="color: #990000">:</span>foreign_key <span style="color: #990000">=&gt;</span> <span style="color: #FF0000">"manager_id"</span>
  belongs_to <span style="color: #990000">:</span>manager<span style="color: #990000">,</span> <span style="color: #990000">:</span>class_name <span style="color: #990000">=&gt;</span> <span style="color: #FF0000">"Employee"</span>
<span style="font-weight: bold"><span style="color: #0000FF">end</span></span></tt></pre></div></div>
<div class="paragraph"><p>Dzięki takiemu ustawieniu możesz "wyciągnąć" <tt>@employee.subordinates</tt> (podwładni pracownika) i <tt>@employee.manager</tt> (manager pracownika).</p></div>
</div>
<h2 id="_porady_triki_i_ostrze_enia">3. Porady, triki i ostrzeżenia</h2>
<div class="sectionbody">
<div class="paragraph"><p>W tym rozdziale znajdziesz kilka rzeczy, które powinieneś wiedzieć, by skutecznie używać modułu Active Record w twoich aplikacjach Rails.</p></div>
<div class="ulist"><ul>
<li>
<p>
Kontrolowanie cachingu
</p>
</li>
<li>
<p>
Unikanie kolizji nazw
</p>
</li>
<li>
<p>
Aktualizacje schematów
</p>
</li>
<li>
<p>
Kontrolowanie zakresu widoczności asocjacji
</p>
</li>
</ul></div>
<h3 id="_kontrolowanie_cachingu">3.1. Kontrolowanie cachingu</h3>
<div class="paragraph"><p>Wszystkie metody asocjacji są cache-owane tak, że wynik ostatniego zapytania dostępny jest dla następnych operacji. Zawartość <em>cache</em> jest nawet widoczna z innych metod. Na przykład:</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 2.11
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt>customer<span style="color: #990000">.</span>orders               <span style="font-style: italic"><span style="color: #9A1900"># pobiera zamówienia z bazy danych</span></span>
customer<span style="color: #990000">.</span>orders<span style="color: #990000">.</span>size          <span style="font-style: italic"><span style="color: #9A1900"># używa kopii zamówień z cache</span></span>
customer<span style="color: #990000">.</span>orders<span style="color: #990000">.</span>empty?        <span style="font-style: italic"><span style="color: #9A1900"># używa kopii zamówień z cache</span></span></tt></pre></div></div>
<div class="paragraph"><p>Ale co zrobić, gdy potrzeba uaktualnić <em>cache</em>, bo dane być może zostały zmienione przez inną część aplikacji? Po prostu ustaw <tt>true</tt> dla wywołania asocjacji:</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 2.11
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt>customer<span style="color: #990000">.</span>orders               <span style="font-style: italic"><span style="color: #9A1900"># pobiera zamówienia z bazy danych</span></span>
customer<span style="color: #990000">.</span>orders<span style="color: #990000">.</span>size          <span style="font-style: italic"><span style="color: #9A1900"># używa kopii zamówień z cache</span></span>
customer<span style="color: #990000">.</span>orders<span style="color: #990000">(</span><span style="font-weight: bold"><span style="color: #0000FF">true</span></span><span style="color: #990000">).</span>empty?  <span style="font-style: italic"><span style="color: #9A1900"># odrzuca kopię zamówień będącą w cache i "wraca" do bazy danych</span></span></tt></pre></div></div>
<h3 id="_unikanie_kolizji_nazw">3.2. Unikanie kolizji nazw</h3>
<div class="paragraph"><p>Nazwy twoich asocjacji nie mogą być dowolne. Ponieważ tworzenie asocjacji automatycznie
dodaje do modelu metodę z taką samą nazwą, złym pomysłem jest nazywanie asocjacji tak
samo jak metody instancji ActiveRecord::Base. Metoda asocjacji w takim przypadku
przesłoni metodę bazy, a to nie jest pożądane. Przykładem złych nazw asocjacji są
<tt>attributes</tt> albo <tt>connection</tt>.</p></div>
<h3 id="_aktualizacja_schematu">3.3. Aktualizacja schematu</h3>
<div class="paragraph"><p>Asocjacje są bardzo przydatne, ale nie są magiczne. Jesteś odpowiedzialny za
utrzymanie schematu  bazy danych w dopasowaniu do swoich asocjacji. W praktyce
oznacza to dwie rzeczy, w zależności od tego, którego rodzaju asocjacji użyłeś
w swoim modelu. Dla asocjacji <tt>belongs_to</tt> porzebujesz stworzyć klucze obce, a
dla <tt>has_and_belongs_to_many</tt> - stosowną tabelę wiążącą (w bazie danych).</p></div>
<h4 id="_tworzenie_kluczy_obcych_dla_asocjacji_tt_belongs_to_tt">3.3.1. Tworzenie kluczy obcych dla asocjacji <tt>belongs_to</tt></h4>
<div class="paragraph"><p>Kiedy deklarujesz asocjację <tt>belongs_to</tt>, powinieneś stworzyć odpowiednie klucze obce. Na przykład, rozważ taki model:</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 2.11
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="font-weight: bold"><span style="color: #0000FF">class</span></span> Order <span style="color: #990000">&lt;</span> ActiveRecord<span style="color: #990000">::</span>Base
  belongs_to <span style="color: #990000">:</span>customer
<span style="font-weight: bold"><span style="color: #0000FF">end</span></span></tt></pre></div></div>
<div class="paragraph"><p>Taka deklaracja  powinna być uwzględniona i "wsparta" odpowiednią deklaracją klucza obcego w tabeli zamówień:</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 2.11
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="font-weight: bold"><span style="color: #0000FF">class</span></span> CreateOrders <span style="color: #990000">&lt;</span> ActiveRecord<span style="color: #990000">::</span>Migration
  <span style="font-weight: bold"><span style="color: #0000FF">def</span></span> <span style="font-weight: bold"><span style="color: #0000FF">self</span></span><span style="color: #990000">.</span>up
    create_table <span style="color: #990000">:</span>orders <span style="font-weight: bold"><span style="color: #0000FF">do</span></span> <span style="color: #990000">|</span>t<span style="color: #990000">|</span>
      t<span style="color: #990000">.</span>datetime   <span style="color: #990000">:</span>order_date
      t<span style="color: #990000">.</span>string     <span style="color: #990000">:</span>order_number
      t<span style="color: #990000">.</span>integer    <span style="color: #990000">:</span>customer_id
    <span style="font-weight: bold"><span style="color: #0000FF">end</span></span>
  <span style="font-weight: bold"><span style="color: #0000FF">end</span></span>

  <span style="font-weight: bold"><span style="color: #0000FF">def</span></span> <span style="font-weight: bold"><span style="color: #0000FF">self</span></span><span style="color: #990000">.</span>down
    drop_table <span style="color: #990000">:</span>orders
  <span style="font-weight: bold"><span style="color: #0000FF">end</span></span>
<span style="font-weight: bold"><span style="color: #0000FF">end</span></span></tt></pre></div></div>
<div class="paragraph"><p>Jeśli tworzysz asocjację po jakimś czasie od stworzenia modelu bazowego, musisz pamiętać o stworzeniu migracji <tt>add_column</tt> (dodaj kolumnę) by zapewnić modelowi odpowiedni klucz obcy.</p></div>
<h4 id="_tworzenie_tabeli_wi_cych_dla_asocjacji_tt_has_and_belongs_to_many_tt">3.3.2. Tworzenie tabeli wiążących dla asocjacji <tt>has_and_belongs_to_many</tt></h4>
<div class="paragraph"><p>Jeśli tworzysz asocjację <tt>has_and_belongs_to_many</tt> potrzebujesz stworzyć wiążącą tabelę.
Dopóki nazwa dołączanej tabeli nie jest wyraźnie określona poprzez użycie opcji
<tt>:join_table</tt>, moduł Active Record utworzy nazwę używając leksykalnego (alfabetycznego)
porządku tworzenia nazw. Zatem: połączenie między modelem  klienta (customer) a
zamówieniem (order) otrzyma domyślną nazwę tabeli "customers_orders" (zamówienia
klientów), bo "c" jest w alfabecie przed "o".</p></div>
<div class="admonitionblock">
<table><tr>
<td class="icon">
<img src="./images/icons/warning.png" alt="Warning" />
</td>
<td class="content">Pierwszeństwo między nazwami modeli jest "obliczane" przy użyciu operatora "&lt;"
(mniejszości) dla stringów (łańcuchów znaków). To znaczy, ze jeśli słowa są różnej
długości, ale początkowy łańcuch jest jednakowy – wtedy wyżej w tym porządku jest słowo
dłuższe. Na przykład, można by oczekiwać, że dla tabeli paper_boxes i papers wygenerowana
nazwa wiążącej tabeli będzie brzmiała "papers_paper_boxes", ze względu na długość
łańcucha "paper_boxes". Jednak w rzeczywistości wygenerowana zostanie nazwa "paper_boxes_papers".</td>
</tr></table>
</div>
<div class="paragraph"><p>Niezależnie od nazwy, musisz "ręcznie" wygenerować wiążącą tabelę za pomocą odpowiedniej migracji. Na przykład, rozważ takie asocjacje:</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 2.11
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="font-weight: bold"><span style="color: #0000FF">class</span></span> Assembly <span style="color: #990000">&lt;</span> ActiveRecord<span style="color: #990000">::</span>Base
  has_and_belongs_to_many <span style="color: #990000">:</span>parts
<span style="font-weight: bold"><span style="color: #0000FF">end</span></span>

<span style="font-weight: bold"><span style="color: #0000FF">class</span></span> Part <span style="color: #990000">&lt;</span> ActiveRecord<span style="color: #990000">::</span>Base
  has_and_belongs_to_many <span style="color: #990000">:</span>assemblies
<span style="font-weight: bold"><span style="color: #0000FF">end</span></span></tt></pre></div></div>
<div class="paragraph"><p>Powinny one zostać zaktualizowane za pomocą migracji, która wygeneruje tabelę <tt>assemblies_parts</tt>. Taka tabela powinna być stworzona bez klucza podstawowego:</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 2.11
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="font-weight: bold"><span style="color: #0000FF">class</span></span> CreateAssemblyPartJoinTable <span style="color: #990000">&lt;</span> ActiveRecord<span style="color: #990000">::</span>Migration
  <span style="font-weight: bold"><span style="color: #0000FF">def</span></span> <span style="font-weight: bold"><span style="color: #0000FF">self</span></span><span style="color: #990000">.</span>up
    create_table <span style="color: #990000">:</span>assemblies_parts<span style="color: #990000">,</span> <span style="color: #990000">:</span>id <span style="color: #990000">=&gt;</span> <span style="font-weight: bold"><span style="color: #0000FF">false</span></span> <span style="font-weight: bold"><span style="color: #0000FF">do</span></span> <span style="color: #990000">|</span>t<span style="color: #990000">|</span>
      t<span style="color: #990000">.</span>integer <span style="color: #990000">:</span>assembly_id
      t<span style="color: #990000">.</span>integer <span style="color: #990000">:</span>part_id
    <span style="font-weight: bold"><span style="color: #0000FF">end</span></span>
  <span style="font-weight: bold"><span style="color: #0000FF">end</span></span>

  <span style="font-weight: bold"><span style="color: #0000FF">def</span></span> <span style="font-weight: bold"><span style="color: #0000FF">self</span></span><span style="color: #990000">.</span>down
    drop_table <span style="color: #990000">:</span>assemblies_parts
  <span style="font-weight: bold"><span style="color: #0000FF">end</span></span>
<span style="font-weight: bold"><span style="color: #0000FF">end</span></span></tt></pre></div></div>
<h3 id="_kontrolowanie_zakresu_widoczno_ci_asocjacji">3.4. Kontrolowanie zakresu widoczności asocjacji</h3>
<div class="paragraph"><p>Domyślnie asocjacje "szukają" obiektów tylko w ramach bieżącego zakresu widoczności modułów. To może być ważne, gdy deklarujesz modele wykorzystujące ActiveRecord wewnątrz modułu, na przykład:</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 2.11
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="font-weight: bold"><span style="color: #0000FF">module</span></span> MyApplication
  <span style="font-weight: bold"><span style="color: #0000FF">module</span></span> Business
    <span style="font-weight: bold"><span style="color: #0000FF">class</span></span> Supplier <span style="color: #990000">&lt;</span> ActiveRecord<span style="color: #990000">::</span>Base
       has_one <span style="color: #990000">:</span>account
    <span style="font-weight: bold"><span style="color: #0000FF">end</span></span>

    <span style="font-weight: bold"><span style="color: #0000FF">class</span></span> Account <span style="color: #990000">&lt;</span> ActiveRecord<span style="color: #990000">::</span>Base
       belongs_to <span style="color: #990000">:</span>supplier
    <span style="font-weight: bold"><span style="color: #0000FF">end</span></span>
  <span style="font-weight: bold"><span style="color: #0000FF">end</span></span>
<span style="font-weight: bold"><span style="color: #0000FF">end</span></span></tt></pre></div></div>
<div class="paragraph"><p>Powyższy kod będzie działał dobrze, bo zarówno klasa dostawcy, jak i klasa konta są zdefiniowane w ramach tego samego zakresu (zakresu widoczności modelu). Ale już poniższy przykład nie będzie działać, bo dostawca i konto są zdefiniowane w różnych zakresach widoczności:</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 2.11
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="font-weight: bold"><span style="color: #0000FF">module</span></span> MyApplication
  <span style="font-weight: bold"><span style="color: #0000FF">module</span></span> Business
    <span style="font-weight: bold"><span style="color: #0000FF">class</span></span> Supplier <span style="color: #990000">&lt;</span> ActiveRecord<span style="color: #990000">::</span>Base
       has_one <span style="color: #990000">:</span>account
    <span style="font-weight: bold"><span style="color: #0000FF">end</span></span>
  <span style="font-weight: bold"><span style="color: #0000FF">end</span></span>

  <span style="font-weight: bold"><span style="color: #0000FF">module</span></span> Billing
    <span style="font-weight: bold"><span style="color: #0000FF">class</span></span> Account <span style="color: #990000">&lt;</span> ActiveRecord<span style="color: #990000">::</span>Base
       belongs_to <span style="color: #990000">:</span>supplier
    <span style="font-weight: bold"><span style="color: #0000FF">end</span></span>
  <span style="font-weight: bold"><span style="color: #0000FF">end</span></span>
<span style="font-weight: bold"><span style="color: #0000FF">end</span></span></tt></pre></div></div>
<div class="paragraph"><p>By powiązać dwa modele istniejące w ramach różnych zakresów – musisz podać pełną nazwę klasy w deklaracji asocjacji:</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 2.11
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="font-weight: bold"><span style="color: #0000FF">module</span></span> MyApplication
  <span style="font-weight: bold"><span style="color: #0000FF">module</span></span> Business
    <span style="font-weight: bold"><span style="color: #0000FF">class</span></span> Supplier <span style="color: #990000">&lt;</span> ActiveRecord<span style="color: #990000">::</span>Base
       has_one <span style="color: #990000">:</span>account<span style="color: #990000">,</span> <span style="color: #990000">:</span>class_name <span style="color: #990000">=&gt;</span> <span style="color: #FF0000">"MyApplication::Billing::Account"</span>
    <span style="font-weight: bold"><span style="color: #0000FF">end</span></span>
  <span style="font-weight: bold"><span style="color: #0000FF">end</span></span>

  <span style="font-weight: bold"><span style="color: #0000FF">module</span></span> Billing
    <span style="font-weight: bold"><span style="color: #0000FF">class</span></span> Account <span style="color: #990000">&lt;</span> ActiveRecord<span style="color: #990000">::</span>Base
       belongs_to <span style="color: #990000">:</span>supplier<span style="color: #990000">,</span> <span style="color: #990000">:</span>class_name <span style="color: #990000">=&gt;</span> <span style="color: #FF0000">"MyApplication::Business::Supplier"</span>
    <span style="font-weight: bold"><span style="color: #0000FF">end</span></span>
  <span style="font-weight: bold"><span style="color: #0000FF">end</span></span>
<span style="font-weight: bold"><span style="color: #0000FF">end</span></span></tt></pre></div></div>
</div>
<h2 id="_szczeg_owy_spis_asocjacji">4. Szczegółowy spis asocjacji</h2>
<div class="sectionbody">
<div class="paragraph"><p>Niniejszy rozdział ukaże ci szczegóły każdego typu asocjacji, w tym informacje o metodach, które dzięki nim zyskujesz oraz opcji, których możesz używać dzięki zadeklarowaniu asocjacji.</p></div>
<h3 id="_asocjacja_belongs_to">4.1. Asocjacja belongs_to</h3>
<div class="paragraph"><p>Asocjacja <tt>belongs_to</tt> tworzy relację typu jeden-do-jeden z innym modelem. W języku baz danych, oznacza to że dana klasa zawiera klucz obcy. Jeśli inna klasa zawiera klucz obcy, powinieneś raczej użyć asocjacji <tt>has_one</tt></p></div>
<h4 id="_metody_dodane_dzi_ki_tt_belongs_to_tt">4.1.1. Metody dodane dzięki <tt>belongs_to</tt></h4>
<div class="paragraph"><p>Kiedy zadeklarujesz asocjację belongs_to, deklarowana klasa automatycznie zyskuje pięć metod odnoszących się do asocjacji:</p></div>
<div class="ulist"><ul>
<li>
<p>
<tt><em>association</em>(force_reload = false)</tt>
</p>
</li>
<li>
<p>
<tt><em>association</em>=(associate)</tt>
</p>
</li>
<li>
<p>
<tt><em>association</em>.nil?</tt>
</p>
</li>
<li>
<p>
<tt>build<em>_association</em>(attributes = {})</tt>
</p>
</li>
<li>
<p>
<tt>create<em>_association</em>(attributes = {})</tt>
</p>
</li>
</ul></div>
<div class="paragraph"><p>We wszystkich tych metodach <tt><em>association</em></tt> zastępuje się symbolem przekazanym jako pierwszy argument do <tt>belongs_to</tt>. Na przykład gdy mamy deklarację:</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 2.11
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="font-weight: bold"><span style="color: #0000FF">class</span></span> Order <span style="color: #990000">&lt;</span> ActiveRecord<span style="color: #990000">::</span>Base
  belongs_to <span style="color: #990000">:</span>customer
<span style="font-weight: bold"><span style="color: #0000FF">end</span></span></tt></pre></div></div>
<div class="paragraph"><p>Każda instancja wybranego modelu będzie posiadała poniższe metody:</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 2.11
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt>customer
customer<span style="color: #990000">=</span>
customer<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #0000FF">nil</span></span><span style="color: #990000">?</span>
build_customer
create_customer</tt></pre></div></div>
<h5 id="_tt_em_association_em_force_reload_false_tt"><tt><em>association</em>(force_reload = false)</tt></h5>
<div class="paragraph"><p>Metoda <tt><em>association</em></tt> zwraca wiązany obiekt, jeśli tylko taki istnieje. Jeśli wiązany
obiekt nie został znaleziony, metoda zwraca <tt>nil</tt>.</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 2.11
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="color: #009900">@customer</span> <span style="color: #990000">=</span> <span style="color: #009900">@order</span><span style="color: #990000">.</span>customer</tt></pre></div></div>
<div class="paragraph"><p>Jeśli wiązany obiekt został już pobrany z bazy danych, zwrócona będzie jego wersja
przechowywana w <em>cache</em>. Aby to zmienić  (i wymusić czytanie z bazy), ustaw <tt>true</tt> przy argumencie <tt>force_reload</tt></p></div>
<h5 id="_tt_em_association_em_associate_tt"><tt><em>association</em>=(associate)</tt></h5>
<div class="paragraph"><p>Metoda <tt><em>association</em>=</tt> przydziela wiązany obiekt do naszego obiektu. Od środka
wygląda to tak, że wydobywa ona z wiązanego obiektu klucz podstawowy i ustawia naszemu
obiektowi klucz obcy na tę samą wartość.</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 2.11
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="color: #009900">@order</span><span style="color: #990000">.</span>customer <span style="color: #990000">=</span> <span style="color: #009900">@customer</span></tt></pre></div></div>
<h5 id="_tt_em_association_em_nil_tt"><tt><em>association</em>.nil?</tt></h5>
<div class="paragraph"><p>metoda <tt><em>association</em>.nil?</tt> zwraca wartość <tt>true</tt> jeśli nie znaleziono wiązanego obiektu.</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 2.11
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="font-weight: bold"><span style="color: #0000FF">if</span></span> <span style="color: #009900">@order</span><span style="color: #990000">.</span>customer<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #0000FF">nil</span></span><span style="color: #990000">?</span>
  <span style="color: #009900">@msg</span> <span style="color: #990000">=</span> <span style="color: #FF0000">"No customer found for this order"</span>
<span style="font-weight: bold"><span style="color: #0000FF">end</span></span></tt></pre></div></div>
<h5 id="_tt_build_em_association_em_attributes_tt"><tt>build<em>_association</em>(attributes = {})</tt></h5>
<div class="paragraph"><p>Metoda <tt>build<em><em>_association</em></em></tt> zwraca nowy obiekt wiązanego typu. Ten obiekt zostanie
natychmiast utworzony z ustawionych atrybutów,  będzie ustawiony odnośnik do obcego
klucza tego obiektu, ale wiązany obiekt <em>nie zostanie</em> zapisany.</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 2.11
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="color: #009900">@customer</span> <span style="color: #990000">=</span> <span style="color: #009900">@order</span><span style="color: #990000">.</span>build_customer<span style="color: #990000">(</span><span style="color: #FF0000">{</span><span style="color: #990000">:</span>customer_number <span style="color: #990000">=&gt;</span> <span style="color: #993399">123</span><span style="color: #990000">,</span> <span style="color: #990000">:</span>customer_name <span style="color: #990000">=&gt;</span> <span style="color: #FF0000">"John Doe"</span><span style="color: #FF0000">}</span><span style="color: #990000">)</span></tt></pre></div></div>
<h5 id="_tt_create_em_association_em_attributes_tt"><tt>create<em>_association</em>(attributes = {})</tt></h5>
<div class="paragraph"><p>Metoda <tt>create<em>_association</em></tt> zwraca nowy obiekt wiązanego typu. Ten obiekt zostanie
natychmiast utworzony z ustawionych atrybutów i będzie ustawiony odnośnik do obcego
klucza tego obiektu. Ponadto wiązany obiekt zostanie zapisany (zakładając, że przejdzie pomyślnie przez walidację).</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 2.11
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="color: #009900">@customer</span> <span style="color: #990000">=</span> <span style="color: #009900">@order</span><span style="color: #990000">.</span>create_customer<span style="color: #990000">(</span><span style="color: #FF0000">{</span><span style="color: #990000">:</span>customer_number <span style="color: #990000">=&gt;</span> <span style="color: #993399">123</span><span style="color: #990000">,</span> <span style="color: #990000">:</span>customer_name <span style="color: #990000">=&gt;</span> <span style="color: #FF0000">"John Doe"</span><span style="color: #FF0000">}</span><span style="color: #990000">)</span></tt></pre></div></div>
<h4 id="_opcje_dla_tt_belongs_to_tt">4.1.2. Opcje dla <tt>belongs_to</tt></h4>
<div class="paragraph"><p>W wielu sytuacjach możesz użyć asocjacji <tt>belongs_to</tt> bez potrzeby jej dostosowywania. Ale pomimo Ralisowego nacisku na górowanie konwencji nad dostosowaniem do własnych potrzeb, możesz zmieniać domyślne ustawienia na kilka sposobów. Ten rozdział przedstawi ci opcje, których możesz używać, kiedy zadeklarujesz asocjację <tt>belongs_to</tt>. Na przykład asocjacja z kilkoma opcjami może wyglądać tak:</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 2.11
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="font-weight: bold"><span style="color: #0000FF">class</span></span> Order <span style="color: #990000">&lt;</span> ActiveRecord<span style="color: #990000">::</span>Base
  belongs_to <span style="color: #990000">:</span>customer<span style="color: #990000">,</span> <span style="color: #990000">:</span>counter_cache <span style="color: #990000">=&gt;</span> <span style="font-weight: bold"><span style="color: #0000FF">true</span></span><span style="color: #990000">,</span> <span style="color: #990000">:</span>conditions <span style="color: #990000">=&gt;</span> <span style="color: #FF0000">"active = 1"</span>
<span style="font-weight: bold"><span style="color: #0000FF">end</span></span></tt></pre></div></div>
<div class="paragraph"><p>Asocjacja <tt>belongs_to</tt> wspiera następujące opcje</p></div>
<div class="ulist"><ul>
<li>
<p>
<tt>:class_name</tt>
</p>
</li>
<li>
<p>
<tt>:conditions</tt>
</p>
</li>
<li>
<p>
<tt>:counter_cache</tt>
</p>
</li>
<li>
<p>
<tt>:dependent</tt>
</p>
</li>
<li>
<p>
<tt>:foreign_key</tt>
</p>
</li>
<li>
<p>
<tt>:include</tt>
</p>
</li>
<li>
<p>
<tt>:polymorphic</tt>
</p>
</li>
<li>
<p>
<tt>:readonly</tt>
</p>
</li>
<li>
<p>
<tt>:select</tt>
</p>
</li>
<li>
<p>
<tt>:validate</tt>
</p>
</li>
</ul></div>
<h5 id="_tt_class_name_tt"><tt>:class_name</tt></h5>
<div class="paragraph"><p>Jeśli nazwa innego modelu nie może zostać utworzona z nazwy asocjacji, możesz użyć opcji
<tt>:class_name</tt>, by dostarczyć własną nazwę modelu. Na przykład, jeśli zamówienie należy
[<em>belongs to</em>] do klienta, ale aktualna nazwa zawierająca klientów to <tt>Patron</tt>, możesz
to ustawić w ten sposób:</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 2.11
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="font-weight: bold"><span style="color: #0000FF">class</span></span> Order <span style="color: #990000">&lt;</span> ActiveRecord<span style="color: #990000">::</span>Base
  belongs_to <span style="color: #990000">:</span>customer<span style="color: #990000">,</span> <span style="color: #990000">:</span>class_name <span style="color: #990000">=&gt;</span> <span style="color: #FF0000">"Patron"</span>
<span style="font-weight: bold"><span style="color: #0000FF">end</span></span></tt></pre></div></div>
<h5 id="_tt_conditions_tt"><tt>:conditions</tt></h5>
<div class="paragraph"><p>Opcja <tt>:conditions</tt> pozwala określić warunki, jakie wiązany obiekt musi spełniać (W składni SQL użyłbyś klauzuli WHERE).</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 2.11
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="font-weight: bold"><span style="color: #0000FF">class</span></span> Order <span style="color: #990000">&lt;</span> ActiveRecord<span style="color: #990000">::</span>Base
  belongs_to <span style="color: #990000">:</span>customer<span style="color: #990000">,</span> <span style="color: #990000">:</span>conditions <span style="color: #990000">=&gt;</span> <span style="color: #FF0000">"active = 1"</span>
<span style="font-weight: bold"><span style="color: #0000FF">end</span></span></tt></pre></div></div>
<h5 id="_tt_counter_cache_tt"><tt>:counter_cache</tt></h5>
<div class="paragraph"><p>Opcja <tt>:counter_cache</tt> może sprawić, że znajdowanie liczby powiązanych obiektów będzie bardziej wydajne (szybsze). Rozważ te modele:</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 2.11
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="font-weight: bold"><span style="color: #0000FF">class</span></span> Order <span style="color: #990000">&lt;</span> ActiveRecord<span style="color: #990000">::</span>Base
  belongs_to <span style="color: #990000">:</span>customer
<span style="font-weight: bold"><span style="color: #0000FF">end</span></span>
<span style="font-weight: bold"><span style="color: #0000FF">class</span></span> Customer <span style="color: #990000">&lt;</span> ActiveRecord<span style="color: #990000">::</span>Base
  has_many <span style="color: #990000">:</span>orders
<span style="font-weight: bold"><span style="color: #0000FF">end</span></span></tt></pre></div></div>
<div class="paragraph"><p>Z powyższymi deklaracjami, znalezienie wartości <tt>@customer.orders.size</tt>
(wielkość [ilość] zamówień klientów) wymaga zapytania do bazy wykorzystującego
<tt>COUNT(*)</tt>. Aby uniknąć tego połączenia możesz dodać :counter_cache ("cache
dla licznika") do modelu:</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 2.11
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="font-weight: bold"><span style="color: #0000FF">class</span></span> Order <span style="color: #990000">&lt;</span> ActiveRecord<span style="color: #990000">::</span>Base
  belongs_to <span style="color: #990000">:</span>customer<span style="color: #990000">,</span> <span style="color: #990000">:</span>counter_cache <span style="color: #990000">=&gt;</span> <span style="font-weight: bold"><span style="color: #0000FF">true</span></span>
<span style="font-weight: bold"><span style="color: #0000FF">end</span></span>
<span style="font-weight: bold"><span style="color: #0000FF">class</span></span> Customer <span style="color: #990000">&lt;</span> ActiveRecord<span style="color: #990000">::</span>Base
  has_many <span style="color: #990000">:</span>orders
<span style="font-weight: bold"><span style="color: #0000FF">end</span></span></tt></pre></div></div>
<div class="paragraph"><p>Dzięki tej deklaracji Railsy będą pobierały bieżącą wartość cache i zwrócą ją w odpowiedzi na metodę <tt>.size</tt>.</p></div>
<div class="paragraph"><p>Pomimo, że opcja <tt>:counter_cache</tt> jest określona dla modelu zawierającego deklarację
<tt>belongs_to</tt>, bieżąca kolumna musi być dodana do wiązanego modelu. W powyższym przypadku
musisz dodać kolumnę o nazwie <tt>orders_count</tt> do modelu klienta [<tt>Customer</tt>]. Możesz
zamienić domyślną nazwę kolumny, jeśli tylko chcesz:</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 2.11
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="font-weight: bold"><span style="color: #0000FF">class</span></span> Order <span style="color: #990000">&lt;</span> ActiveRecord<span style="color: #990000">::</span>Base
  belongs_to <span style="color: #990000">:</span>customer<span style="color: #990000">,</span> <span style="color: #990000">:</span>counter_cache <span style="color: #990000">=&gt;</span> <span style="color: #990000">:</span>count_of_orders
<span style="font-weight: bold"><span style="color: #0000FF">end</span></span>
<span style="font-weight: bold"><span style="color: #0000FF">class</span></span> Customer <span style="color: #990000">&lt;</span> ActiveRecord<span style="color: #990000">::</span>Base
  has_many <span style="color: #990000">:</span>orders
<span style="font-weight: bold"><span style="color: #0000FF">end</span></span></tt></pre></div></div>
<div class="paragraph"><p>Kolumny <em>licznika</em> są dodawane do listy atrybutów tylko-do-odczytu wiązanego modelu (poprzez <tt>attr_readonly</tt>)</p></div>
<h5 id="_tt_dependent_tt"><tt>:dependent</tt></h5>
<div class="paragraph"><p>Jeśli ustawisz opcję <tt>:dependent</tt> na <tt>:destroy</tt>, wtedy usunięcie tego obiektu wywoła
metodę <tt>destroy</tt> na wiązanym obiekcie, by usunąć ten obiekt. Jeżeli ustawisz opcję
<tt>:dependent</tt> na <tt>:delete</tt>, wtedy usunięcie tego obiektu spowoduje usunięcie obiektu
wiązanego <em>bez</em> wywoływania dla niego metody <tt>destroy</tt>.</p></div>
<div class="admonitionblock">
<table><tr>
<td class="icon">
<img src="./images/icons/warning.png" alt="Warning" />
</td>
<td class="content">Nie używaj tej opcji w asocjacji <tt>belongs_to</tt>, która jest połączona z asocjacją <tt>has_many</tt> w innej klasie. W przeciwnym wypadku w twojej bazie pojawią się rekordy osierocone.</td>
</tr></table>
</div>
<h5 id="_tt_foreign_key_tt"><tt>:foreign_key</tt></h5>
<div class="paragraph"><p>Zgodnie z konwencją, Railsy "domyślają się", że kolumna używana do przechowywania klucza obcego to nazwa asocjacji z dodanym przyrostkiem <tt>_id</tt>. Opcja <tt>:foreign_key</tt> umożliwia ustawienie nazwy klucza obcego bezpośrednio:</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 2.11
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="font-weight: bold"><span style="color: #0000FF">class</span></span> Order <span style="color: #990000">&lt;</span> ActiveRecord<span style="color: #990000">::</span>Base
  belongs_to <span style="color: #990000">:</span>customer<span style="color: #990000">,</span> <span style="color: #990000">:</span>class_name <span style="color: #990000">=&gt;</span> <span style="color: #FF0000">"Patron"</span><span style="color: #990000">,</span> <span style="color: #990000">:</span>foreign_key <span style="color: #990000">=&gt;</span> <span style="color: #FF0000">"patron_id"</span>
<span style="font-weight: bold"><span style="color: #0000FF">end</span></span></tt></pre></div></div>
<div class="admonitionblock">
<table><tr>
<td class="icon">
<img src="./images/icons/tip.png" alt="Tip" />
</td>
<td class="content">W żadnym z wypadków Railsy nie będą same tworzyły dla ciebie kolumn klucza obcego. Musisz zdefiniować te klucze w swoich migracjach.</td>
</tr></table>
</div>
<h5 id="_tt_include_tt"><tt>:include</tt></h5>
<div class="paragraph"><p>Możesz użyć opcji <tt>:include</tt> do podania drugorzędnych asocjacji, które zostaną załadowane wtedy, gdy zostanie użyta dana asocjacja. Na przykład, rozważmy takie modele:</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 2.11
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="font-weight: bold"><span style="color: #0000FF">class</span></span> LineItem <span style="color: #990000">&lt;</span> ActiveRecord<span style="color: #990000">::</span>Base
  belongs_to <span style="color: #990000">:</span>order
<span style="font-weight: bold"><span style="color: #0000FF">end</span></span>
<span style="font-weight: bold"><span style="color: #0000FF">class</span></span> Order <span style="color: #990000">&lt;</span> ActiveRecord<span style="color: #990000">::</span>Base
  belongs_to <span style="color: #990000">:</span>customer
  has_many <span style="color: #990000">:</span>line_items
<span style="font-weight: bold"><span style="color: #0000FF">end</span></span>
<span style="font-weight: bold"><span style="color: #0000FF">class</span></span> Customer <span style="color: #990000">&lt;</span> ActiveRecord<span style="color: #990000">::</span>Base
  has_many <span style="color: #990000">:</span>orders
<span style="font-weight: bold"><span style="color: #0000FF">end</span></span></tt></pre></div></div>
<div class="paragraph"><p>Jeśli często pobierasz klienta bezpośrednio z pozycji w jego zamówieniu [<em>line item</em>] (<tt>@line_item.order.customer</tt>), możesz sprawić, że twój kod będzie wydajniejszy, włączając klienta w asocjacji z pozycją w zamówieniu do zamówienia:</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 2.11
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="font-weight: bold"><span style="color: #0000FF">class</span></span> LineItem <span style="color: #990000">&lt;</span> ActiveRecord<span style="color: #990000">::</span>Base
  belongs_to <span style="color: #990000">:</span>order<span style="color: #990000">,</span> <span style="color: #990000">:</span><span style="font-weight: bold"><span style="color: #0000FF">include</span></span> <span style="color: #990000">=&gt;</span> <span style="color: #990000">:</span>customer
<span style="font-weight: bold"><span style="color: #0000FF">end</span></span>
<span style="font-weight: bold"><span style="color: #0000FF">class</span></span> Order <span style="color: #990000">&lt;</span> ActiveRecord<span style="color: #990000">::</span>Base
  belongs_to <span style="color: #990000">:</span>customer
  has_many <span style="color: #990000">:</span>line_items
<span style="font-weight: bold"><span style="color: #0000FF">end</span></span>
<span style="font-weight: bold"><span style="color: #0000FF">class</span></span> Customer <span style="color: #990000">&lt;</span> ActiveRecord<span style="color: #990000">::</span>Base
  has_many <span style="color: #990000">:</span>orders
<span style="font-weight: bold"><span style="color: #0000FF">end</span></span></tt></pre></div></div>
<div class="admonitionblock">
<table><tr>
<td class="icon">
<img src="./images/icons/note.png" alt="Note" />
</td>
<td class="content">Nie ma potrzeby stosowania <tt>:include</tt> do bezpośrednich asocjacji, to znaczy: jeśli masz zdefiniowaną w modelu relację zamówień należących do  (<em>belongs to</em>) klientów, wtedy "klient" jest przygotowany do wczytania zawsze, kiedy tylko jest potrzebny.</td>
</tr></table>
</div>
<h5 id="_tt_polymorphic_tt"><tt>:polymorphic</tt></h5>
<div class="paragraph"><p>Ustawienie <tt>true</tt> dla opcji <tt>:polymorphic</tt> wskazuje, że asocjacja jest polimorficzna. Asocjacje polimorficzne zostały omówione wcześniej w tym przewodniku.</p></div>
<h5 id="_tt_readonly_tt"><tt>:readonly</tt></h5>
<div class="paragraph"><p>Jeśli ustawisz <tt>true</tt> dla opcji <tt>:readonly</tt>, asocjowany obiekt będzie tylko do odczytu, gdy wywoływana jest asocjacja.</p></div>
<h5 id="_tt_select_tt"><tt>:select</tt></h5>
<div class="paragraph"><p>Użyj opcji <tt>:select</tt> by zastąpić klauzulę SQL <tt>SELECT</tt>, która służy do wyszukiwania danych w wiązanym obiekcie. Domyślnie Railsy pobierają wszystkie kolumny.</p></div>
<div class="admonitionblock">
<table><tr>
<td class="icon">
<img src="./images/icons/tip.png" alt="Tip" />
</td>
<td class="content">Po ustawieniu opcji <tt>:select</tt> dla asocjacji <tt>belongs_to</tt>, powinieneś też ustawić opcję <tt>:foreign_key</tt>, by mieć pewność, że uzyskasz poprawny wynik zapytania</td>
</tr></table>
</div>
<h5 id="_tt_validate_tt"><tt>:validate</tt></h5>
<div class="paragraph"><p>Kiedy ustawisz na <tt>true</tt> opcję <tt>:validate</tt>,  wiązane obiekty będą walidowane zawsze, kiedy będziesz je zapisywać. Domyślne ustawienie to <tt>false</tt>: wiązane obiekty nie są walidowane kiedy je zapisujesz.</p></div>
<h4 id="_kiedy_obiekty_s_zapisywane">4.1.3. Kiedy obiekty są zapisywane?</h4>
<div class="paragraph"><p>Przypisywanie obiektu do asocjacji <tt>belongs_to</tt> nie zapisuje go automatycznie. Nie zapisuje to także wiązanego obiektu.</p></div>
<h3 id="_asocjacja_tt_has_one_tt_2">4.2. Asocjacja <tt>has_one</tt></h3>
<div class="paragraph"><p>Asocjacja has_one tworzy relację typu jeden-do-jeden pomiędzy modelami. W języku baz danych oznacza to, że inna klasa zawiera klucz obcy. Jeżeli to rozpatrywana aktualnie klasa zawiera klucz obcy, należy użyć asocjacji <tt>belongs_to</tt> zamiast <tt>has_one</tt>.</p></div>
<h4 id="_metody_dodane_dzi_ki_tt_has_one_tt">4.2.1. Metody dodane dzięki <tt>has_one</tt></h4>
<div class="paragraph"><p>Kiedy zadeklarujesz asocjację <tt>has_one</tt>, deklarowana klasa automatycznie zyskuje pięć metod odnoszących się do asocjacji:</p></div>
<div class="ulist"><ul>
<li>
<p>
<tt><em>association</em>(force_reload = false)</tt>
</p>
</li>
<li>
<p>
<tt><em>association</em>=(associate)</tt>
</p>
</li>
<li>
<p>
<tt><em>association</em>.nil?</tt>
</p>
</li>
<li>
<p>
<tt>build<em>_association</em>(attributes = {})</tt>
</p>
</li>
<li>
<p>
<tt>create<em>_association</em>(attributes = {})</tt>
</p>
</li>
</ul></div>
<div class="paragraph"><p>We wszystkich tych metodach <tt><em>association</em></tt> zastępuje się symbolem przekazanym jako pierwszy argument do <tt>has_one</tt>. Na przykład gdy mamy deklarację:</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 2.11
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="font-weight: bold"><span style="color: #0000FF">class</span></span> Supplier <span style="color: #990000">&lt;</span> ActiveRecord<span style="color: #990000">::</span>Base
  has_one <span style="color: #990000">:</span>account
<span style="font-weight: bold"><span style="color: #0000FF">end</span></span></tt></pre></div></div>
<div class="paragraph"><p>Każda instancja modelu dostawcy (<tt>Supplier</tt>) będzie posiadała poniższe metody:</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 2.11
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt>account
account<span style="color: #990000">=</span>
account<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #0000FF">nil</span></span><span style="color: #990000">?</span>
build_account
create_account</tt></pre></div></div>
<h5 id="_tt_em_association_em_force_reload_false_tt_2"><tt><em>association</em>(force_reload = false)</tt></h5>
<div class="paragraph"><p>Metoda <tt><em>association</em></tt> zwraca wiązany obiekt, jeśli tylko taki istnieje. Jeśli wiązany obiekt nie został znaleziony, metoda zwraca <tt>nil</tt>.</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 2.11
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="color: #009900">@account</span> <span style="color: #990000">=</span> <span style="color: #009900">@supplier</span><span style="color: #990000">.</span>account</tt></pre></div></div>
<div class="paragraph"><p>Jeśli wiązany obiekt został już pobrany z bazy danych, zwrócona będzie jego wersja przechowywana w <em>cache</em>. Aby to zmienić (i wymusić czytanie z bazy), ustaw <tt>true</tt> przy argumencie <tt>force_reload</tt></p></div>
<h5 id="_tt_em_association_em_associate_tt_2"><tt><em>association</em>=(associate)</tt></h5>
<div class="paragraph"><p>Metoda <tt><em>association</em>=</tt> przydziela wiązanemu obiekt do naszego obiektu. Od środka wygląda to tak, że wydobywa ona z naszego obiektu klucz podstawowy i ustawia wiązanemu obiektowi klucz obcy na tę samą wartość.</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 2.11
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="color: #009900">@suppler</span><span style="color: #990000">.</span>account <span style="color: #990000">=</span> <span style="color: #009900">@account</span></tt></pre></div></div>
<h5 id="_tt_em_association_em_nil_tt_2"><tt><em>association</em>.nil?</tt></h5>
<div class="paragraph"><p>Metoda <tt><em>association</em>.nil?</tt> zwraca wartość <tt>true</tt> jeśli nie znaleziono wiązanego obiektu.</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 2.11
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="font-weight: bold"><span style="color: #0000FF">if</span></span> <span style="color: #009900">@supplier</span><span style="color: #990000">.</span>account<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #0000FF">nil</span></span><span style="color: #990000">?</span>
  <span style="color: #009900">@msg</span> <span style="color: #990000">=</span> <span style="color: #FF0000">"No account found for this supplier"</span>
<span style="font-weight: bold"><span style="color: #0000FF">end</span></span></tt></pre></div></div>
<h5 id="_tt_build_em_association_em_attributes_tt_2"><tt>build<em>_association</em>(attributes = {})</tt></h5>
<div class="paragraph"><p>Metoda <tt>build<em><em>_association</em></em></tt> zwraca nowy obiekt wiązanego typu. Ten obiekt zostanie
natychmiast utworzony z ustawionych atrybutów, będzie ustawiony odnośnik do jego obcego
klucza tego obiektu, ale wiązany obiekt <em>nie zostanie</em> zapisany.</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 2.11
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="color: #009900">@account</span> <span style="color: #990000">=</span> <span style="color: #009900">@supplier</span><span style="color: #990000">.</span>build_account<span style="color: #990000">(</span><span style="color: #FF0000">{</span><span style="color: #990000">:</span>terms <span style="color: #990000">=&gt;</span> <span style="color: #FF0000">"Net 30"</span><span style="color: #FF0000">}</span><span style="color: #990000">)</span></tt></pre></div></div>
<h5 id="_tt_create_em_association_em_attributes_tt_2"><tt>create<em>_association</em>(attributes = {})</tt></h5>
<div class="paragraph"><p>Metoda <tt>create<em>_association</em></tt> zwraca nowy obiekt wiązanego typu, Ten obiekt zostanie
natychmiast utworzony z ustawionych atrybutów i będzie ustawiony odnośnik do jego obcego
klucza. Ponadto wiązany obiekt zostanie zapisany (zakładając, że przejdzie pomyślnie przez walidację).</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 2.11
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="color: #009900">@account</span> <span style="color: #990000">=</span> <span style="color: #009900">@supplier</span><span style="color: #990000">.</span>create_account<span style="color: #990000">(</span><span style="color: #FF0000">{</span><span style="color: #990000">:</span>terms <span style="color: #990000">=&gt;</span> <span style="color: #FF0000">"Net 30"</span><span style="color: #FF0000">}</span><span style="color: #990000">)</span></tt></pre></div></div>
<h4 id="_opcje_dla_tt_has_one_tt">4.2.2. Opcje dla <tt>has_one</tt></h4>
<div class="paragraph"><p>W wielu sytuacjach możesz użyć asocjacji <tt>has_one</tt> bez potrzeby jej dostosowywania. Ale pomimo Ralisowego nacisku na górowanie konwencji nad dostosowaniem do własnych potrzeb, możesz zmieniać domyślne ustawienia na kilka sposobów. Ten rozdział przedstawi ci opcje, których możesz używać, kiedy zadeklarujesz asocjację <tt>has_one</tt>. Na przykład asocjacja z kilkoma opcjami może wyglądać tak:</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 2.11
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="font-weight: bold"><span style="color: #0000FF">class</span></span> Supplier <span style="color: #990000">&lt;</span> ActiveRecord<span style="color: #990000">::</span>Base
  has_one <span style="color: #990000">:</span>account<span style="color: #990000">,</span> <span style="color: #990000">:</span>class_name <span style="color: #990000">=&gt;</span> <span style="color: #FF0000">"Billing"</span><span style="color: #990000">,</span> <span style="color: #990000">:</span>dependent <span style="color: #990000">=&gt;</span> <span style="color: #990000">:</span>nullify
<span style="font-weight: bold"><span style="color: #0000FF">end</span></span></tt></pre></div></div>
<div class="paragraph"><p>Asocjacja <tt>has_one</tt> wspiera następujące opcje</p></div>
<div class="ulist"><ul>
<li>
<p>
<tt>:as</tt>
</p>
</li>
<li>
<p>
<tt>:class_name</tt>
</p>
</li>
<li>
<p>
<tt>:conditions</tt>
</p>
</li>
<li>
<p>
<tt>:dependent</tt>
</p>
</li>
<li>
<p>
<tt>:foreign_key</tt>
</p>
</li>
<li>
<p>
<tt>:include</tt>
</p>
</li>
<li>
<p>
<tt>:order</tt>
</p>
</li>
<li>
<p>
<tt>:primary_key</tt>
</p>
</li>
<li>
<p>
<tt>:readonly</tt>
</p>
</li>
<li>
<p>
<tt>:select</tt>
</p>
</li>
<li>
<p>
<tt>:source</tt>
</p>
</li>
<li>
<p>
<tt>:source_type</tt>
</p>
</li>
<li>
<p>
<tt>:through</tt>
</p>
</li>
<li>
<p>
<tt>:validate</tt>
</p>
</li>
</ul></div>
<h5 id="_tt_as_tt"><tt>:as</tt></h5>
<div class="paragraph"><p>Użycie opcji <tt>:as</tt>  wskazuje, że mamy do czynienia z asocjacją polimorficzną.
Polimorficzne asocjacje zostały omówione szczegółowo we wcześniejszej części podręcznika.</p></div>
<h5 id="_tt_class_name_tt_2"><tt>:class_name</tt></h5>
<div class="paragraph"><p>Jeśli nazwa innego modelu nie może zostać utworzona z nazwy asocjacji, możesz użyć opcji <tt>:class_name</tt>, by dostarczyć własną nazwę modelu. Na przykład, jeśli dostawca posiada konto, ale aktualna nazwa zawierająca konta to <tt>Billing</tt>, możesz to ustawić w ten sposób:</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 2.11
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="font-weight: bold"><span style="color: #0000FF">class</span></span> Supplier <span style="color: #990000">&lt;</span> ActiveRecord<span style="color: #990000">::</span>Base
  has_one <span style="color: #990000">:</span>account<span style="color: #990000">,</span> <span style="color: #990000">:</span>class_name <span style="color: #990000">=&gt;</span> <span style="color: #FF0000">"Billing"</span>
<span style="font-weight: bold"><span style="color: #0000FF">end</span></span></tt></pre></div></div>
<h5 id="_tt_conditions_tt_2"><tt>:conditions</tt></h5>
<div class="paragraph"><p>Opcja <tt>:conditions</tt> pozwala określić warunki, jakie wiązany obiekt musi spełniać (W składni SQL użyłbyś klauzuli WHERE).</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 2.11
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="font-weight: bold"><span style="color: #0000FF">class</span></span> Supplier <span style="color: #990000">&lt;</span> ActiveRecord<span style="color: #990000">::</span>Base
  has_one <span style="color: #990000">:</span>account<span style="color: #990000">,</span> <span style="color: #990000">:</span>conditions <span style="color: #990000">=&gt;</span> <span style="color: #FF0000">"confirmed = 1"</span>
<span style="font-weight: bold"><span style="color: #0000FF">end</span></span></tt></pre></div></div>
<h5 id="_tt_dependent_tt_2"><tt>:dependent</tt></h5>
<div class="paragraph"><p>Jeśli ustawisz opcję <tt>:dependent</tt> na <tt>:destroy</tt>, wtedy usunięcie tego obiektu wywoła
metodę destroy na wiązanym obiekcie, by usunąć ten obiekt. Jeżeli ustawisz opcję
<tt>:dependent</tt> na <tt>:delete</tt>, wtedy usunięcie tego obiektu spowoduje usunięcie obiektu
wiązanego <em>bez</em> wywoływania dla niego metody <tt>destroy</tt>. Jeśli ustawisz opcję
<tt>:dependent</tt> na <tt>:nullify</tt>, usunięcie tego obiektu sprawi, że klucz obcy w wiązanym
obiekcie zostanie zastąpiony przez <tt>NULL</tt>.</p></div>
<h5 id="_tt_foreign_key_tt_2"><tt>:foreign_key</tt></h5>
<div class="paragraph"><p>Zgodnie z konwencją, Railsy "domyślają się", że kolumna używana do przechowywania klucza obcego w innym modelu to nazwa pierwszego modelu z przyrostkiem _id. Opcja <tt>:foreign_key</tt> umożliwia ustawienie nazwy klucza obcego bezpośrednio:</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 2.11
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="font-weight: bold"><span style="color: #0000FF">class</span></span> Supplier <span style="color: #990000">&lt;</span> ActiveRecord<span style="color: #990000">::</span>Base
  has_one <span style="color: #990000">:</span>account<span style="color: #990000">,</span> <span style="color: #990000">:</span>foreign_key <span style="color: #990000">=&gt;</span> <span style="color: #FF0000">"supp_id"</span>
<span style="font-weight: bold"><span style="color: #0000FF">end</span></span></tt></pre></div></div>
<div class="admonitionblock">
<table><tr>
<td class="icon">
<img src="./images/icons/tip.png" alt="Tip" />
</td>
<td class="content">W żadnym z wypadków Railsy nie będą same tworzyły dla ciebie kolumn klucza obcego. Musisz zdefiniować te klucze w swoich migracjach.</td>
</tr></table>
</div>
<h5 id="_tt_include_tt_2"><tt>:include</tt></h5>
<div class="paragraph"><p>Możesz użyć opcji <tt>:include</tt> do podania drugorzędnych asocjacji, które zostaną załadowane wtedy, gdy zostanie użyta dana asocjacja. Na przykład, rozważmy takie modele:</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 2.11
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="font-weight: bold"><span style="color: #0000FF">class</span></span> Supplier <span style="color: #990000">&lt;</span> ActiveRecord<span style="color: #990000">::</span>Base
  has_one <span style="color: #990000">:</span>account
<span style="font-weight: bold"><span style="color: #0000FF">end</span></span>
<span style="font-weight: bold"><span style="color: #0000FF">class</span></span> Account <span style="color: #990000">&lt;</span> ActiveRecord<span style="color: #990000">::</span>Base
  belongs_to <span style="color: #990000">:</span>supplier
  belongs_to <span style="color: #990000">:</span>representative
<span style="font-weight: bold"><span style="color: #0000FF">end</span></span>
<span style="font-weight: bold"><span style="color: #0000FF">class</span></span> Representative <span style="color: #990000">&lt;</span> ActiveRecord<span style="color: #990000">::</span>Base
  has_many <span style="color: #990000">:</span>accounts
<span style="font-weight: bold"><span style="color: #0000FF">end</span></span></tt></pre></div></div>
<div class="paragraph"><p>Jeśli często pobierasz przedstawicieli bezpośrednio od dostawców (<tt>@supplier.account.representative</tt>), możesz sprawić, że twój kod będzie wydajniejszy, załączając przedstawicieli w asocjacji poszczególnych dostawców do kont:</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 2.11
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="font-weight: bold"><span style="color: #0000FF">class</span></span> Supplier <span style="color: #990000">&lt;</span> ActiveRecord<span style="color: #990000">::</span>Base
  has_one <span style="color: #990000">:</span>account<span style="color: #990000">,</span> <span style="color: #990000">:</span><span style="font-weight: bold"><span style="color: #0000FF">include</span></span> <span style="color: #990000">=&gt;</span> <span style="color: #990000">:</span>representative
<span style="font-weight: bold"><span style="color: #0000FF">end</span></span>
<span style="font-weight: bold"><span style="color: #0000FF">class</span></span> Account <span style="color: #990000">&lt;</span> ActiveRecord<span style="color: #990000">::</span>Base
  belongs_to <span style="color: #990000">:</span>supplier
  belongs_to <span style="color: #990000">:</span>representative
<span style="font-weight: bold"><span style="color: #0000FF">end</span></span>
<span style="font-weight: bold"><span style="color: #0000FF">class</span></span> Representative <span style="color: #990000">&lt;</span> ActiveRecord<span style="color: #990000">::</span>Base
  has_many <span style="color: #990000">:</span>accounts
<span style="font-weight: bold"><span style="color: #0000FF">end</span></span></tt></pre></div></div>
<h5 id="_tt_order_tt"><tt>:order</tt></h5>
<div class="paragraph"><p>Opcja <tt>:order</tt> (<em>uporządkuj</em>) ustawia porządek w jakim powiązane obiekty będą "wyciągane" z bazy (w składni SQL użyłbyś klauzuli <tt>ORDER BY</tt>). Ponieważ <tt>has_one</tt> pobierać będzie tylko jeden wiązany obiekt, opcja ta nie będzie potrzebna.</p></div>
<h5 id="_tt_primary_key_tt"><tt>:primary_key</tt></h5>
<div class="paragraph"><p>Zgodnie z konwencją Railsy "domyślają się" że kolumna z kluczem podstawowym w modelu to "id". Możesz to zmienić i samodzielnie określić klucz podstawowy dzięki opcji <tt>:primary_key</tt>.</p></div>
<h5 id="_tt_readonly_tt_2"><tt>:readonly</tt></h5>
<div class="paragraph"><p>Jeśli ustawisz <tt>true</tt> dla opcji <tt>:readonly</tt>, asocjowany obiekt będzie tylko do odczytu, gdy wywoływana jest asocjacja.</p></div>
<h5 id="_tt_select_tt_2"><tt>:select</tt></h5>
<div class="paragraph"><p>Użyj opcji <tt>:select</tt> by zastąpić klauzuję SQL <tt>SELECT</tt>, która służy do wyszukiwania danych w wiązanym obiekcie. Domyślnie Railsy pobierają wszystkie kolumny.</p></div>
<h5 id="_tt_source_tt"><tt>:source</tt></h5>
<div class="paragraph"><p>Opcja source określa źródło asocjacji dla asocjacji typu  <tt>has_one :through</tt>.</p></div>
<h5 id="_tt_source_type_tt"><tt>:source_type</tt></h5>
<div class="paragraph"><p>Opcja <tt>:source_type</tt> określa typ źródła asocjacji dla asocjacji <tt>has_one :through</tt>; związane jest to z asocjacją polimorficzną.</p></div>
<h5 id="_tt_through_tt"><tt>:through</tt></h5>
<div class="paragraph"><p>Opcja <tt>:through</tt> (<em>poprzez</em>) określa wiążący model, poprzez który wykonywane są
zapytania. Asocjacje <tt>has_one :through</tt> są omówione w dalszej części przewodnika.</p></div>
<h5 id="_tt_validate_tt_2"><tt>:validate</tt></h5>
<div class="paragraph"><p>Kiedy ustawisz na <tt>true</tt> opcję <tt>:validate</tt>, wiązane obiekty będą walidowane zawsze, kiedy będziesz je zapisywać. Domyślne ustawienie to <tt>false</tt>: wiązane obiekty nie są walidowane kiedy je zapisujesz.</p></div>
<h4 id="_kiedy_obiekty_s_zapisywane_2">4.2.3. Kiedy obiekty są zapisywane?</h4>
<div class="paragraph"><p>Kiedy przypisujesz obiekt do asocjacji <tt>has_one</tt>, jest on zapisywany automatycznie (by zaktualizować jego klucz obcy). Ponadto każdy obiekt, który został zmieniony jest również automatycznie zapisywany, ponieważ jego klucz obcy także się zmienił.</p></div>
<div class="paragraph"><p>Jeśli którykolwiek z tych zapisów nie powiedzie się z winy błędu walidacji, wtedy rozkaz przypisania zwróci <tt>false</tt>, a samo przypisanie jest anulowane.</p></div>
<div class="paragraph"><p>Jeśli obiekt-rodzic (ten, w którym zadeklarowałeś asocjację <tt>has_one</tt>) nie został zapisany (to jest, gdy <tt>new_record?</tt> zwraca wartość <tt>true</tt>), wtedy obiekt-dziecko nie jest zapisywany.</p></div>
<div class="paragraph"><p>Jeśli chcesz przypisać obiekt do asocjacji has_one bez zapisywania obiektu, użyj metody <tt>association.build</tt>.</p></div>
<h3 id="_asocjacja_has_many">4.3. Asocjacja has_many</h3>
<div class="paragraph"><p>Asocjacja <tt>has_many</tt> tworzy relację typu jeden-do-wiele z innym modelem. W języku baz danych oznacza to, że inna klasa zawiera klucz obcy, który odnosi się do instancji rozpatrywanej klasy.</p></div>
<h4 id="_dodane_metody">4.3.1. Dodane metody</h4>
<div class="paragraph"><p>Kiedy zadeklarujesz asocjację <tt>has_many</tt>, deklarowana klasa automatycznie zyskuje 13 metod odnoszących się do tej asocjacji:</p></div>
<div class="ulist"><ul>
<li>
<p>
<tt><em>collection</em>(force_reload = false)</tt>
</p>
</li>
<li>
<p>
<tt><em>collection</em>&lt;&lt;(object, ...)</tt>
</p>
</li>
<li>
<p>
<tt><em>collection</em>.delete(object, ...)</tt>
</p>
</li>
<li>
<p>
<tt><em>collection</em>=objects</tt>
</p>
</li>
<li>
<p>
<tt><em>collection_singular</em>_ids</tt>
</p>
</li>
<li>
<p>
<tt><em>collection_singular</em>_ids=ids</tt>
</p>
</li>
<li>
<p>
<tt><em>collection</em>.clear</tt>
</p>
</li>
<li>
<p>
<tt><em>collection</em>.empty?</tt>
</p>
</li>
<li>
<p>
<tt><em>collection</em>.size</tt>
</p>
</li>
<li>
<p>
<tt><em>collection</em>.find(...)</tt>
</p>
</li>
<li>
<p>
<tt><em>collection</em>.exist?(...)</tt>
</p>
</li>
<li>
<p>
<tt><em>collection</em>.build(attributes = {}, ...)</tt>
</p>
</li>
<li>
<p>
<tt><em>collection</em>.create(attributes = {})</tt>
</p>
</li>
</ul></div>
<div class="paragraph"><p>We wszystkich wymienionych metodach <tt><em>collection</em></tt> zastępuje się symbolem przekazanym
jako pierwszy argument do <tt>has_many</tt> oraz <tt><em>collection_singular</em></tt> zastępowany jest
nazwą tegoż symbolu w liczbie pojedynczej (w języku angielskim). Na przykład, biorąc pod uwagę deklarację:</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 2.11
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="font-weight: bold"><span style="color: #0000FF">class</span></span> Customer <span style="color: #990000">&lt;</span> ActiveRecord<span style="color: #990000">::</span>Base
  has_many <span style="color: #990000">:</span>orders
<span style="font-weight: bold"><span style="color: #0000FF">end</span></span></tt></pre></div></div>
<div class="paragraph"><p>Każda instancja modelu klienta będzie posiadała poniższe metody:</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 2.11
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt>orders<span style="color: #990000">(</span>force_reload <span style="color: #990000">=</span> <span style="font-weight: bold"><span style="color: #0000FF">false</span></span><span style="color: #990000">)</span>
orders<span style="color: #990000">&lt;&lt;(</span>object<span style="color: #990000">,</span> <span style="color: #990000">...)</span>
orders<span style="color: #990000">.</span>delete<span style="color: #990000">(</span>object<span style="color: #990000">,</span> <span style="color: #990000">...)</span>
orders<span style="color: #990000">=</span>objects
order_ids
order_ids<span style="color: #990000">=</span>ids
orders<span style="color: #990000">.</span>clear
orders<span style="color: #990000">.</span>empty?
orders<span style="color: #990000">.</span>size
orders<span style="color: #990000">.</span>find<span style="color: #990000">(...)</span>
orders<span style="color: #990000">.</span>exist?<span style="color: #990000">(...)</span>
orders<span style="color: #990000">.</span>build<span style="color: #990000">(</span>attributes <span style="color: #990000">=</span> <span style="color: #FF0000">{}</span><span style="color: #990000">,</span> <span style="color: #990000">...)</span>
orders<span style="color: #990000">.</span>create<span style="color: #990000">(</span>attributes <span style="color: #990000">=</span> <span style="color: #FF0000">{}</span><span style="color: #990000">)</span></tt></pre></div></div>
<h5 id="_tt_em_collection_em_force_reload_false_tt"><tt><em>collection</em>(force_reload = false)</tt></h5>
<div class="paragraph"><p>Metoda <tt><em>collection</em></tt> zwraca tablicę [<em>array</em>] wszystkich wiązanych obiektów. Jeśli nie istnieją żadne wiązane obiekty, zwraca pustą tablicę.</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 2.11
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="color: #009900">@orders</span> <span style="color: #990000">=</span> <span style="color: #009900">@customer</span><span style="color: #990000">.</span>orders</tt></pre></div></div>
<h5 id="_tt_em_collection_em_lt_lt_object_tt"><tt><em>collection</em>&lt;&lt;(object, ...)</tt></h5>
<div class="paragraph"><p>Metoda <tt><em>collection</em>&lt;&lt;</tt> dodaje jeden lub więcej obiektów do zbioru poprzez ustawienie ich kluczy obcych na wartość klucza podstawowego wywoływanego modelu</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 2.11
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="color: #009900">@customer</span><span style="color: #990000">.</span>orders <span style="color: #990000">&lt;&lt;</span> <span style="color: #009900">@order1</span></tt></pre></div></div>
<h5 id="_tt_em_collection_em_delete_object_tt"><tt><em>collection</em>.delete(object, ...)</tt></h5>
<div class="paragraph"><p>Metoda <tt><em>collection</em>.delete</tt> usuwa jeden lub więcej obiektów ze zbioru, poprzez ustawienie ich kluczy obcych na <tt>NULL</tt>.</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 2.11
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="color: #009900">@customer</span><span style="color: #990000">.</span>orders<span style="color: #990000">.</span>delete<span style="color: #990000">(</span><span style="color: #009900">@order1</span><span style="color: #990000">)</span></tt></pre></div></div>
<div class="admonitionblock">
<table><tr>
<td class="icon">
<img src="./images/icons/warning.png" alt="Warning" />
</td>
<td class="content">Obiekty będą dodatkowo niszczone, jeśli są powiązane przez  <tt>:dependent =&gt; :destroy</tt> lub usuwane, jeśli są powiązane z <tt>:dependent =&gt; :delete_all</tt>.</td>
</tr></table>
</div>
<h5 id="_tt_em_collection_em_objects_tt"><tt><em>collection</em>=objects</tt></h5>
<div class="paragraph"><p>Metoda <tt><em>collection</em>=</tt> usuwa i dodaje odpowiednie obiekty tak, żeby dana kolekcja zawierała tylko podane (wymienione) obiekty.</p></div>
<h5 id="_tt_em_collection_singular_em_ids_tt"><tt><em>collection_singular</em>_ids</tt></h5>
<div class="paragraph"><p>Metoda <tt><em>collection_singular</em>_ids</tt> zwraca tablicę identyfikatorów obiektów w zbiorze.</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 2.11
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="color: #009900">@order_ids</span> <span style="color: #990000">=</span> <span style="color: #009900">@customer</span><span style="color: #990000">.</span>order_ids</tt></pre></div></div>
<h5 id="_tt_em_collection_singular_em_ids_ids_tt"><tt><em>collection_singular</em>_ids=ids</tt></h5>
<div class="paragraph"><p>Metoda <tt><em>collection_singular</em>_ids=</tt> sprawia, że w zbiorze znajdują się tylko te
obiekty, których wartość podstawowego klucza równa jest wartościom dostarczonym do metody.</p></div>
<h5 id="_tt_em_collection_em_clear_tt"><tt><em>collection</em>.clear</tt></h5>
<div class="paragraph"><p>Metoda <tt><em>collection</em>.clear</tt> usuwa wszystkie elementy zbioru. Niszczy ona też wiązane obiekty jeśli zostały związane poprzez <tt>:dependent =&gt; :destroy</tt>, usuwa te wiązane poprzez <tt>:dependent =&gt; :delete_all</tt> lub (w przeciwnym przypadku do dwóch wymienionych) ustawia klucze obce obiektów na <tt>NULL</tt>.</p></div>
<h5 id="_tt_em_collection_em_empty_tt"><tt><em>collection</em>.empty?</tt></h5>
<div class="paragraph"><p>Metoda <tt><em>collection</em>.empty?</tt> zwraca wartośc <tt>true</tt>, jeśli zbiór nie posiada żadnych związanych obiektów.</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 2.11
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="color: #FF0000">&lt;% if @customer.orders.empty? %&gt;</span>
  Nie znaleziono zamówień
<span style="color: #FF0000">&lt;% end %&gt;</span></tt></pre></div></div>
<h5 id="_tt_em_collection_em_size_tt"><tt><em>collection</em>.size</tt></h5>
<div class="paragraph"><p>Metoda <tt><em>collection</em>.size</tt> zwraca liczbę obiektów w zbiorze.</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 2.11
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="color: #009900">@order_count</span> <span style="color: #990000">=</span> <span style="color: #009900">@customer</span><span style="color: #990000">.</span>orders<span style="color: #990000">.</span>size</tt></pre></div></div>
<h5 id="_tt_em_collection_em_find_tt"><tt><em>collection</em>.find(...)</tt></h5>
<div class="paragraph"><p>Metoda <tt><em>collection</em>.find</tt> służy do wyszukiwania obiektów w zbiorze. Korzysta ona z tej samej składni i tych samych opcji, co ActiveRecord::Base.find.</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 2.11
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="color: #009900">@open_orders</span> <span style="color: #990000">=</span> <span style="color: #009900">@customer</span><span style="color: #990000">.</span>orders<span style="color: #990000">.</span>find<span style="color: #990000">(:</span>all<span style="color: #990000">,</span> <span style="color: #990000">:</span>conditions <span style="color: #990000">=&gt;</span> <span style="color: #FF0000">"open = 1"</span><span style="color: #990000">)</span></tt></pre></div></div>
<h5 id="_tt_em_collection_em_exist_tt"><tt><em>collection</em>.exist?(...)</tt></h5>
<div class="paragraph"><p>Metoda <tt><em>collection</em>.exist?</tt> sprawdza, czy obiekt spełniający podane warunki istnieje w danej kolekcji. Metoda ta używa takiej samej składni i tych samych opcji, co ActiveRecord::Base.exists?.</p></div>
<h5 id="_tt_em_collection_em_build_attributes_tt"><tt><em>collection</em>.build(attributes = {}, ...)</tt></h5>
<div class="paragraph"><p>Metoda <tt><em>collection</em>.build</tt> zwraca jeden lub więcej nowych obiektów wiązanego typu.
Obiekty te będą konstruowane na podstawie podanych atrybutów. Połączenie poprzez ich
klucz obcy zostanie stworzone, ale powiązane obiekty <em>nie będą zapisane</em>.</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 2.11
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="color: #009900">@order</span> <span style="color: #990000">=</span> <span style="color: #009900">@customer</span><span style="color: #990000">.</span>orders<span style="color: #990000">.</span>build<span style="color: #990000">(</span><span style="color: #FF0000">{</span><span style="color: #990000">:</span>order_date <span style="color: #990000">=&gt;</span> Time<span style="color: #990000">.</span>now<span style="color: #990000">,</span> <span style="color: #990000">:</span>order_number <span style="color: #990000">=&gt;</span> <span style="color: #FF0000">"A12345"</span><span style="color: #FF0000">}</span><span style="color: #990000">)</span></tt></pre></div></div>
<h5 id="_tt_em_collection_em_create_attributes_tt"><tt><em>collection</em>.create(attributes = {})</tt></h5>
<div class="paragraph"><p>Metoda <tt><em>collection</em>.create</tt> zwraca nowy obiekt wiązanego typu. Te obiekty będą
konstruowane na podstawie podanych atrybutów. Połączenie poprzez ich klucz obcy zostanie
stworzone, a powiązane obiekty <em>zostaną zapisane</em> (zakładając że przejdą przez wszystkie
walidacje)</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 2.11
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="color: #009900">@order</span> <span style="color: #990000">=</span> <span style="color: #009900">@customer</span><span style="color: #990000">.</span>orders<span style="color: #990000">.</span>create<span style="color: #990000">(</span><span style="color: #FF0000">{</span><span style="color: #990000">:</span>order_date <span style="color: #990000">=&gt;</span> Time<span style="color: #990000">.</span>now<span style="color: #990000">,</span> <span style="color: #990000">:</span>order_number <span style="color: #990000">=&gt;</span> <span style="color: #FF0000">"A12345"</span><span style="color: #FF0000">}</span><span style="color: #990000">)</span></tt></pre></div></div>
<h4 id="_opcje_dla_has_many">4.3.2. Opcje dla has_many</h4>
<div class="paragraph"><p>W wielu sytuacjach możesz użyć domyślnych ustawień asocjacji <tt>has_many</tt> bez potrzeby jej dostosowywania. Pamiętaj jednak, że możesz zmieniać domyślne ustawienia według swoich potrzeb. Ten rozdział przedstawi ci opcje, których możesz używać kiedy zadeklarujesz asocjację <tt>has_many</tt>. Na przykład asocjacja z kilkoma opcjami może wyglądać tak:</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 2.11
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="font-weight: bold"><span style="color: #0000FF">class</span></span> Customer <span style="color: #990000">&lt;</span> ActiveRecord<span style="color: #990000">::</span>Base
  has_many <span style="color: #990000">:</span>orders<span style="color: #990000">,</span> <span style="color: #990000">:</span>dependent <span style="color: #990000">=&gt;</span> <span style="color: #990000">:</span>delete_all<span style="color: #990000">,</span> <span style="color: #990000">:</span>validate <span style="color: #990000">=&gt;</span> <span style="color: #990000">:</span><span style="font-weight: bold"><span style="color: #0000FF">false</span></span>
<span style="font-weight: bold"><span style="color: #0000FF">end</span></span></tt></pre></div></div>
<div class="paragraph"><p>Asocjacja <tt>has_many</tt> wspiera następujące opcje:</p></div>
<div class="ulist"><ul>
<li>
<p>
<tt>:as</tt>
</p>
</li>
<li>
<p>
<tt>:class_name</tt>
</p>
</li>
<li>
<p>
<tt>:conditions</tt>
</p>
</li>
<li>
<p>
<tt>:counter_sql</tt>
</p>
</li>
<li>
<p>
<tt>:dependent</tt>
</p>
</li>
<li>
<p>
<tt>:extend</tt>
</p>
</li>
<li>
<p>
<tt>:finder_sql</tt>
</p>
</li>
<li>
<p>
<tt>:foreign_key</tt>
</p>
</li>
<li>
<p>
<tt>:group</tt>
</p>
</li>
<li>
<p>
<tt>:include</tt>
</p>
</li>
<li>
<p>
<tt>:limit</tt>
</p>
</li>
<li>
<p>
<tt>:offset</tt>
</p>
</li>
<li>
<p>
<tt>:order</tt>
</p>
</li>
<li>
<p>
<tt>:primary_key</tt>
</p>
</li>
<li>
<p>
<tt>:readonly</tt>
</p>
</li>
<li>
<p>
<tt>:select</tt>
</p>
</li>
<li>
<p>
<tt>:source</tt>
</p>
</li>
<li>
<p>
<tt>:source_type</tt>
</p>
</li>
<li>
<p>
<tt>:through</tt>
</p>
</li>
<li>
<p>
<tt>:uniq</tt>
</p>
</li>
<li>
<p>
<tt>:validate</tt>
</p>
</li>
</ul></div>
<h5 id="_tt_as_tt_2"><tt>:as</tt></h5>
<div class="paragraph"><p>Użycie opcji <tt>:as</tt> wskazuje, że mamy do czynienia z asocjacją polimorficzną. Polimorficzne asocjacje zostały omówione we wcześniejszej części podręcznika.</p></div>
<h5 id="_tt_class_name_tt_3"><tt>:class_name</tt></h5>
<div class="paragraph"><p>Jeśli nazwa wiązanego modelu nie może zostać utworzona z nazwy asocjacji, możesz użyć
opcji <tt>:class_name</tt>, by dostarczyć własną nazwę modelu. Na przykład jeśli klient ma
wiele zamówień, ale aktualna nazwa modelu zawierającego zamówienia to "Transaction",
możesz to ustawić w ten sposób:</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 2.11
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="font-weight: bold"><span style="color: #0000FF">class</span></span> Customer <span style="color: #990000">&lt;</span> ActiveRecord<span style="color: #990000">::</span>Base
  has_many <span style="color: #990000">:</span>orders<span style="color: #990000">,</span> <span style="color: #990000">:</span>class_name <span style="color: #990000">=&gt;</span> <span style="color: #FF0000">"Transaction"</span>
<span style="font-weight: bold"><span style="color: #0000FF">end</span></span></tt></pre></div></div>
<h5 id="_tt_conditions_tt_3"><tt>:conditions</tt></h5>
<div class="paragraph"><p>Opcja :conditions pozwala określić warunki, jakie wiązany obiekt musi spełniać (W składni SQL użyłbyś klauzuli WHERE).</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 2.11
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="font-weight: bold"><span style="color: #0000FF">class</span></span> Customer <span style="color: #990000">&lt;</span> ActiveRecord<span style="color: #990000">::</span>Base
  has_many <span style="color: #990000">:</span>confirmed_orders<span style="color: #990000">,</span> <span style="color: #990000">:</span>class_name <span style="color: #990000">=&gt;</span> <span style="color: #FF0000">"Order"</span><span style="color: #990000">,</span> <span style="color: #990000">:</span>conditions <span style="color: #990000">=&gt;</span> <span style="color: #FF0000">"confirmed = 1"</span>
<span style="font-weight: bold"><span style="color: #0000FF">end</span></span></tt></pre></div></div>
<div class="paragraph"><p>możesz także określać warunki używając hash-a:</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 2.11
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="font-weight: bold"><span style="color: #0000FF">class</span></span> Customer <span style="color: #990000">&lt;</span> ActiveRecord<span style="color: #990000">::</span>Base
  has_many <span style="color: #990000">:</span>confirmed_orders<span style="color: #990000">,</span> <span style="color: #990000">:</span>class_name <span style="color: #990000">=&gt;</span> <span style="color: #FF0000">"Order"</span><span style="color: #990000">,</span> <span style="color: #990000">:</span>conditions <span style="color: #990000">=&gt;</span> <span style="color: #FF0000">{</span> <span style="color: #990000">:</span>confirmed <span style="color: #990000">=&gt;</span> <span style="font-weight: bold"><span style="color: #0000FF">true</span></span> <span style="color: #FF0000">}</span>
<span style="font-weight: bold"><span style="color: #0000FF">end</span></span></tt></pre></div></div>
<div class="paragraph"><p>Jeżeli użyjesz opcji <tt>:conditions</tt> (w notacji z hashem), tworzenie rekordów
przez tą asocjację zostanie zautomatyzowane według zawartości hasha. W tym
przypadku, używając <tt>@customer.confirmed_orders.create</tt> albo
<tt>@customer.confirmed_orders.build</tt>, tworzy się zamówienia tam, gdzie kolumna
<tt>confirmed</tt> ma wartość <tt>true</tt>.</p></div>
<h5 id="_tt_counter_sql_tt"><tt>:counter_sql</tt></h5>
<div class="paragraph"><p>Zwykle Railsy automatycznie tworzą odpowiednie zapytanie SQL do liczenia uczestników asocjacji. Z opcją <tt>:counter_sql</tt> możesz zdefiniować własne zapytanie sql do policzenia ich.</p></div>
<div class="admonitionblock">
<table><tr>
<td class="icon">
<img src="./images/icons/note.png" alt="Note" />
</td>
<td class="content">Jeśli określisz <tt>:finder_sql</tt>, ale nie stworzysz <tt>:counter_sql</tt> , wtedy funkcja
licząca sql <tt>SELECT COUNT(*) FROM</tt> zostanie zastąpiona klauzulą <tt>SELECT ... FROM</tt>,
wykorzystującą deklaracje z <tt>:finder_sql</tt>.</td>
</tr></table>
</div>
<h5 id="_tt_dependent_tt_3"><tt>:dependent</tt></h5>
<div class="paragraph"><p>Jeśli ustawisz opcję <tt>:dependent</tt> na <tt>:destroy</tt>, wtedy usunięcie tego obiektu wywoła metodę <tt>:destroy</tt> dla obiektów powiązanych, żeby je usunąć. Jeśli ustawisz opcję <tt>:dependent</tt> na <tt>:delete_all</tt>, wtedy usunięcie tego obiektu usunie obiekty powiązane bez wywoływania ich metody <tt>:destroy</tt>. Jeśli ustawisz opcję <tt>:dependent</tt> na <tt>:nullify</tt>, wtedy usunięcie tego obiektu ustawi klucz obcy w powiązanych obiektach na NULL.</p></div>
<div class="admonitionblock">
<table><tr>
<td class="icon">
<img src="./images/icons/note.png" alt="Note" />
</td>
<td class="content">Ta opcja jest ignorowana, jeśli używasz w asocjacji opcji <tt>:through</tt>.</td>
</tr></table>
</div>
<h5 id="_tt_extend_tt"><tt>:extend</tt></h5>
<div class="paragraph"><p>Opcja <tt>:extend</tt> sprawia, że wskazany moduł rozszerza proxy asocjacji. Rozszerzenia
asocjacji są opisane dalej w tym podręczniku.</p></div>
<h5 id="_tt_finder_sql_tt"><tt>:finder_sql</tt></h5>
<div class="paragraph"><p>Zwykle Railsy automatycznie tworzą odpowiednie zapytanie SQL do pobrania <em>uczestników</em> asocjacji. Z opcją <tt>:finder_sql</tt> możesz zdefiniować takie zapytanie samodzielnie. Jeśli pobieranie obiektów wymaga wielu skomplikowanych operacji na wielu tabelach, może to być konieczne.</p></div>
<h5 id="_tt_foreign_key_tt_3"><tt>:foreign_key</tt></h5>
<div class="paragraph"><p>Zgodnie z konwencją, Railsy "domyślają się", że kolumna używana do przechowywania klucza obcego w innym modelu to nazwa pierwszego modelu z przyrostkiem <tt>_id</tt>. Opcja <tt>:foreign_key</tt> umożliwia ustawienie nazwy klucza obcego bezpośrednio:</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 2.11
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="font-weight: bold"><span style="color: #0000FF">class</span></span> Customer <span style="color: #990000">&lt;</span> ActiveRecord<span style="color: #990000">::</span>Base
  has_many <span style="color: #990000">:</span>orders<span style="color: #990000">,</span> <span style="color: #990000">:</span>foreign_key <span style="color: #990000">=&gt;</span> <span style="color: #FF0000">"cust_id"</span>
<span style="font-weight: bold"><span style="color: #0000FF">end</span></span></tt></pre></div></div>
<div class="admonitionblock">
<table><tr>
<td class="icon">
<img src="./images/icons/tip.png" alt="Tip" />
</td>
<td class="content">W żadnym z wypadków Railsy nie będą same tworzyły dla ciebie kolumn klucza obcego. Musisz zdefiniować teklucze w swoich migracjach.</td>
</tr></table>
</div>
<h5 id="_tt_group_tt"><tt>:group</tt></h5>
<div class="paragraph"><p>Opcja <tt>:group</tt> dostarcza nazwę atrybutu według której wyniki mają być pogrupowane. W SQL użyłbyś klauzuli <tt>GROUP BY</tt>.</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 2.11
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="font-weight: bold"><span style="color: #0000FF">class</span></span> Customer <span style="color: #990000">&lt;</span> ActiveRecord<span style="color: #990000">::</span>Base
  has_many <span style="color: #990000">:</span>line_items<span style="color: #990000">,</span> <span style="color: #990000">:</span>through <span style="color: #990000">=&gt;</span> <span style="color: #990000">:</span>orders<span style="color: #990000">,</span> <span style="color: #990000">:</span>group <span style="color: #990000">=&gt;</span> <span style="color: #FF0000">"orders.id"</span>
<span style="font-weight: bold"><span style="color: #0000FF">end</span></span></tt></pre></div></div>
<h5 id="_tt_include_tt_3"><tt>:include</tt></h5>
<div class="paragraph"><p>Możesz użyć opcji <tt>:include</tt> do podania drugorzędnych asocjacji, które zostaną załadowane wtedy, gdy zostanie użyta dana asocjacja. Na przykład, rozważmy takie modele:</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 2.11
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="font-weight: bold"><span style="color: #0000FF">class</span></span> Customer <span style="color: #990000">&lt;</span> ActiveRecord<span style="color: #990000">::</span>Base
  has_many <span style="color: #990000">:</span>orders
<span style="font-weight: bold"><span style="color: #0000FF">end</span></span>
<span style="font-weight: bold"><span style="color: #0000FF">class</span></span> Order <span style="color: #990000">&lt;</span> ActiveRecord<span style="color: #990000">::</span>Base
  belongs_to <span style="color: #990000">:</span>customer
  has_many <span style="color: #990000">:</span>line_items
<span style="font-weight: bold"><span style="color: #0000FF">end</span></span>
<span style="font-weight: bold"><span style="color: #0000FF">class</span></span> LineItem <span style="color: #990000">&lt;</span> ActiveRecord<span style="color: #990000">::</span>Base
  belongs_to <span style="color: #990000">:</span>order
<span style="font-weight: bold"><span style="color: #0000FF">end</span></span></tt></pre></div></div>
<div class="paragraph"><p>Jeśli często pobierasz pojedyncze pozycje zamówień bezpośrednio od klientów (<tt>@customer.orders.line_items</tt>), możesz sprawić, by wój kod był wydajniejszy, załączając pozycje w zamówieniu w asocjacji z zamówieniami do klientów:</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 2.11
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="font-weight: bold"><span style="color: #0000FF">class</span></span> Customer <span style="color: #990000">&lt;</span> ActiveRecord<span style="color: #990000">::</span>Base
  has_many <span style="color: #990000">:</span>orders<span style="color: #990000">,</span> <span style="color: #990000">:</span><span style="font-weight: bold"><span style="color: #0000FF">include</span></span> <span style="color: #990000">=&gt;</span> <span style="color: #990000">:</span>line_items
<span style="font-weight: bold"><span style="color: #0000FF">end</span></span>
<span style="font-weight: bold"><span style="color: #0000FF">class</span></span> Order <span style="color: #990000">&lt;</span> ActiveRecord<span style="color: #990000">::</span>Base
  belongs_to <span style="color: #990000">:</span>customer
  has_many <span style="color: #990000">:</span>line_items
<span style="font-weight: bold"><span style="color: #0000FF">end</span></span>
<span style="font-weight: bold"><span style="color: #0000FF">class</span></span> LineItem <span style="color: #990000">&lt;</span> ActiveRecord<span style="color: #990000">::</span>Base
  belongs_to <span style="color: #990000">:</span>order
<span style="font-weight: bold"><span style="color: #0000FF">end</span></span></tt></pre></div></div>
<h5 id="_tt_limit_tt"><tt>:limit</tt></h5>
<div class="paragraph"><p>Opcja <tt>:limit</tt>  pozwala ograniczyć liczbę obiektów, które będą pobierane dzięki asocjacji.</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 2.11
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="font-weight: bold"><span style="color: #0000FF">class</span></span> Customer <span style="color: #990000">&lt;</span> ActiveRecord<span style="color: #990000">::</span>Base
  has_many <span style="color: #990000">:</span>recent_orders<span style="color: #990000">,</span> <span style="color: #990000">:</span>class_name <span style="color: #990000">=&gt;</span> <span style="color: #FF0000">"Order"</span><span style="color: #990000">,</span> <span style="color: #990000">:</span>order <span style="color: #990000">=&gt;</span> <span style="color: #FF0000">"order_date DESC"</span><span style="color: #990000">,</span> <span style="color: #990000">:</span>limit <span style="color: #990000">=&gt;</span> <span style="color: #993399">100</span>
<span style="font-weight: bold"><span style="color: #0000FF">end</span></span></tt></pre></div></div>
<h5 id="_tt_offset_tt"><tt>:offset</tt></h5>
<div class="paragraph"><p>Opcja <tt>:offset</tt> pozwala zdefiniować <em>offset</em> dla obiektów pobieranych w asocjacji. Na przykład, jeśli ustawisz <tt>:offset =&gt; 11</tt>, zostanie pominiętych pierwszych 11 rekordów (por. z klauzulą SQL <tt>LIMIT 0,1</tt>. Offset jest tą pierwszą liczbą – przyp.tłum)</p></div>
<h5 id="_tt_order_tt_2"><tt>:order</tt></h5>
<div class="paragraph"><p>Opcja <tt>:order</tt> ustawia porządek w jakim powiązane obiekty będą "wyciągane" (w składni SQL użyłbyś klauzuli <tt>ORDER BY</tt>).</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 2.11
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="font-weight: bold"><span style="color: #0000FF">class</span></span> Customer <span style="color: #990000">&lt;</span> ActiveRecord<span style="color: #990000">::</span>Base
  has_many <span style="color: #990000">:</span>orders<span style="color: #990000">,</span> <span style="color: #990000">:</span>order <span style="color: #990000">=&gt;</span> <span style="color: #FF0000">"date_confirmed DESC"</span>
<span style="font-weight: bold"><span style="color: #0000FF">end</span></span></tt></pre></div></div>
<h5 id="_tt_primary_key_tt_2"><tt>:primary_key</tt></h5>
<div class="paragraph"><p>Zgodnie z konwencją Railsy "domyślają się" że kolumna z kluczem podstawowym w modelu to
"id". Możesz to zmienić i samodzielnie określić klucz podstawowy dzięki opcji <tt>:primary_key</tt></p></div>
<h5 id="_tt_readonly_tt_3"><tt>:readonly</tt></h5>
<div class="paragraph"><p>Jeśli ustawisz <tt>true</tt> dla opcji <tt>:readonly</tt>, asocjowany obiekt będzie tylko do odczytu, gdy wywoływana jest asocjacja.</p></div>
<h5 id="_tt_select_tt_3"><tt>:select</tt></h5>
<div class="paragraph"><p>Użyj opcji <tt>:select</tt> by zastąpić klauzulę SQL <tt>SELECT</tt>, która służy do wyszukiwania
danych w wiązanym obiekcie. Domyślnie Railsy pobierają wszystkie kolumny.</p></div>
<div class="paragraph"><p>Jeśli określisz opcję <tt>:select</tt>, musisz być pewien, że zawarłeś w nim kolumnę klucza podstawowego (lub klucza obcego) asocjowanego modelu. Jeśli tego nie zrobisz, możesz spowodować błąd Railsów.</p></div>
<h5 id="_tt_source_tt_2"><tt>:source</tt></h5>
<div class="paragraph"><p>Opcja <tt>:source</tt> określa źródło asocjacji dla asocjacji typu  <tt>has_many :through</tt>. Tylko
wtedy potrzebujesz korzystać z tej opcji, kiedy nazwa źródła asocjacji nie może być
automatycznie wygenerowana (stworzona) z nazwy asocjacji.</p></div>
<h5 id="_tt_source_type_tt_2"><tt>:source_type</tt></h5>
<div class="paragraph"><p>Opcja <tt>:source_type</tt> określa typ źródła asocjacji dla asocjacji <tt>has_one :through</tt>; związane jest to z asocjacją polimorficzną.</p></div>
<h5 id="_tt_through_tt_2"><tt>:through</tt></h5>
<div class="paragraph"><p>Opcja <tt>:through</tt>  określa model, za pośrednictwem którego wykonywane są zapytania. Asocjacje <tt>has_many :through</tt> umożliwiają implementację relacji wiele-do-wiele jak to opisano wcześniej w tej instrukcji.</p></div>
<h5 id="_tt_uniq_tt"><tt>:uniq</tt></h5>
<div class="paragraph"><p>Ustaw opcję  <tt>:uniq =&gt; true</tt> aby usunąć ze zbiorów duplikaty. Ta opcja jest najbardziej użyteczna w połączeniu z opcją <tt>:through</tt>.</p></div>
<h5 id="_tt_validate_tt_3"><tt>:validate</tt></h5>
<div class="paragraph"><p>Kiedy ustawisz na <tt>false</tt> opcję <tt>:validate</tt>, wiązane obiekty nie będą nigdy walidowane,
kiedy będziesz zapisywać obiekt. Domyślne ustawienie to <tt>true</tt>: wiązane obiekty są
walidowane kiedy je zapisujesz.</p></div>
<h4 id="_kiedy_obiekty_s_zapisywane_3">4.3.3. Kiedy obiekty są zapisywane?</h4>
<div class="paragraph"><p>Kiedy przypisujesz obiekt do asocjacji <tt>has_many</tt>, obiekt jest automatycznie zapisywani
(żeby zaktualizować jego klucz obcy). Jeśli wiążesz wiele obiektów w jednym
zapytaniu, wszystkie zostaną zapisane.</p></div>
<div class="paragraph"><p>Jeśli którykolwiek z tych zapisów nie powiedzie się z winy błędu walidacji, wtedy rozkaz
przypisania zwróci <tt>false</tt>, a samo przypisanie jest anulowane.</p></div>
<div class="paragraph"><p>Jeśli obiekt-rodzic (ten, w którym jest deklaracja <tt>has_many</tt>) nie został zapisany (czyli <tt>new_record?</tt> zwróci <tt>true</tt>), wtedy dodane obiekty-dzieci również nie zostaną zapisane. Wszyscy niezapisani uczestnicy asocjacji będą automatycznie zapisani, kiedy rodzic zostanie zapisany.</p></div>
<div class="paragraph"><p>Jeśli chcesz przypisać obiekt do asocjacji <tt>has_many</tt> bez jego zapisywania, użyj metody <tt><em>collection</em>.build</tt></p></div>
<h3 id="_asocjacja_tt_has_and_belongs_to_many_tt_2">4.4. Asocjacja <tt>has_and_belongs_to_many</tt></h3>
<div class="paragraph"><p>Asocjacja <tt>has_and_belongs_to_many</tt> tworzy relację wiele-do-wiele z innym modelem. W języku baz danych wiąże się się dwie klasy poprzez załączenie pośredniej tabeli, która zawiera klucze obce odnoszące się do każdej z klas.</p></div>
<h4 id="_dodane_metody_2">4.4.1. Dodane metody</h4>
<div class="paragraph"><p>Kiedy zadeklarujesz asocjację <tt>has_and_belongs_to_many</tt>, zyskujesz automatycznie 13 metod  powiązanych z tą asocjacją:</p></div>
<div class="ulist"><ul>
<li>
<p>
<tt><em>collection</em>(force_reload = false)</tt>
</p>
</li>
<li>
<p>
<tt><em>collection</em>&lt;&lt;(object, ...)</tt>
</p>
</li>
<li>
<p>
<tt><em>collection</em>.delete(object, ...)</tt>
</p>
</li>
<li>
<p>
<tt><em>collection</em>=objects</tt>
</p>
</li>
<li>
<p>
<tt><em>collection_singular</em>_ids</tt>
</p>
</li>
<li>
<p>
<tt><em>collection_singular</em>_ids=ids</tt>
</p>
</li>
<li>
<p>
<tt><em>collection</em>.clear</tt>
</p>
</li>
<li>
<p>
<tt><em>collection</em>.empty?</tt>
</p>
</li>
<li>
<p>
<tt><em>collection</em>.size</tt>
</p>
</li>
<li>
<p>
<tt><em>collection</em>.find(...)</tt>
</p>
</li>
<li>
<p>
<tt><em>collection</em>.exist?(...)</tt>
</p>
</li>
<li>
<p>
<tt><em>collection</em>.build(attributes = {})</tt>
</p>
</li>
<li>
<p>
<tt><em>collection</em>.create(attributes = {})</tt>
</p>
</li>
</ul></div>
<div class="paragraph"><p>We wszystkich wymienionych metodach  <tt><em>collection</em></tt> zastępuje się symbolem przekazanym
jako pierwszy argument do has_many, a także <tt><em>collection_singular</em></tt> zastępuje się nazwą
tegoż symbolu w liczbie pojedynczej (w języku angielskim). Na przykład, w takiej deklaracji:</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 2.11
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="font-weight: bold"><span style="color: #0000FF">class</span></span> Part <span style="color: #990000">&lt;</span> ActiveRecord<span style="color: #990000">::</span>Base
  has_and_belongs_to_many <span style="color: #990000">:</span>assemblies
<span style="font-weight: bold"><span style="color: #0000FF">end</span></span></tt></pre></div></div>
<div class="paragraph"><p>Każda instancja modelu <em>part</em> będzie posiadała poniższe metody</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 2.11
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt>assemblies<span style="color: #990000">(</span>force_reload <span style="color: #990000">=</span> <span style="font-weight: bold"><span style="color: #0000FF">false</span></span><span style="color: #990000">)</span>
assemblies<span style="color: #990000">&lt;&lt;(</span>object<span style="color: #990000">,</span> <span style="color: #990000">...)</span>
assemblies<span style="color: #990000">.</span>delete<span style="color: #990000">(</span>object<span style="color: #990000">,</span> <span style="color: #990000">...)</span>
assemblies<span style="color: #990000">=</span>objects
assembly_ids
assembly_ids<span style="color: #990000">=</span>ids
assemblies<span style="color: #990000">.</span>clear
assemblies<span style="color: #990000">.</span>empty?
assemblies<span style="color: #990000">.</span>size
assemblies<span style="color: #990000">.</span>find<span style="color: #990000">(...)</span>
assemblies<span style="color: #990000">.</span>exist?<span style="color: #990000">(...)</span>
assemblies<span style="color: #990000">.</span>build<span style="color: #990000">(</span>attributes <span style="color: #990000">=</span> <span style="color: #FF0000">{}</span><span style="color: #990000">,</span> <span style="color: #990000">...)</span>
assemblies<span style="color: #990000">.</span>create<span style="color: #990000">(</span>attributes <span style="color: #990000">=</span> <span style="color: #FF0000">{}</span><span style="color: #990000">)</span></tt></pre></div></div>
<h5 id="_metody_dla_dodatkowych_kolumn">Metody dla dodatkowych kolumn</h5>
<div class="paragraph"><p>Jeżeli tabela dołączana do asocjacji <tt>has_and_belongs_to_many</tt> posiada dodatkowe kolumny
poza dwoma kluczami obcymi, kolumny te powinny zostać dodane jako atrybuty do rekordów
pobieranych za pomocą tej asocjacji. Rekordy zwrócone z dodatkowymi atrybutami będą
zawsze tylko do odczytu, ponieważ Railsy nie potrafią zapisywać zmian dla tych atrybutów</p></div>
<div class="admonitionblock">
<table><tr>
<td class="icon">
<img src="./images/icons/warning.png" alt="Warning" />
</td>
<td class="content">Użycie dodatkowych atrybutów w dołączanej tabeli w asocjacji <tt>has_and_belongs_to_many</tt> jest dawną tendencją i nie wspiera się jej. Jeśli potrzebujesz tego rodzaju skomplikowanych zachowań w tabeli łączącej dwa modele w relacji wiele-do-wiele, powinieneś użyć asocjacji <tt>has_many :through</tt> zamiast <tt>has_and_belongs_to_many</tt>.</td>
</tr></table>
</div>
<h5 id="_tt_em_collection_em_force_reload_false_tt_2"><tt><em>collection</em>(force_reload = false)</tt></h5>
<div class="paragraph"><p>Metoda <tt><em>collection</em></tt> zwraca tablicę [<em>array</em>] wszystkich wiązanych obiektów. Jeśli nie istnieją żadne wiązane obiekty, zwraca pustą tablicę.</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 2.11
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="color: #009900">@assemblies</span> <span style="color: #990000">=</span> <span style="color: #009900">@part</span><span style="color: #990000">.</span>assemblies</tt></pre></div></div>
<h5 id="_tt_em_collection_em_lt_lt_object_tt_2"><tt><em>collection</em>&lt;&lt;(object, ...)</tt></h5>
<div class="paragraph"><p>Metoda <tt><em>collection</em>&lt;&lt;</tt> dodaje jeden lub więcej obiektów do zbioru poprzez dodanie rekordów w tabeli łączącej (pośredniej).</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 2.11
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="color: #009900">@part</span><span style="color: #990000">.</span>assemblies <span style="color: #990000">&lt;&lt;</span> <span style="color: #009900">@assembly1</span></tt></pre></div></div>
<div class="admonitionblock">
<table><tr>
<td class="icon">
<img src="./images/icons/note.png" alt="Note" />
</td>
<td class="content">Ta metoda jest aliasowana przez <tt><em>collection</em>.concat</tt> i <tt><em>collection</em>.push</tt>.</td>
</tr></table>
</div>
<h5 id="_tt_em_collection_em_delete_object_tt_2"><tt><em>collection</em>.delete(object, ...)</tt></h5>
<div class="paragraph"><p>Metoda <tt><em>collection</em>.delete</tt> usuwa jeden lub więcej obiektów ze zbioru, poprzez usunięcie rekordów z tabeli łączącej. Ta metoda nie usuwa żadnych innych obiektów poza tymi z tabeli łączącej.</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 2.11
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="color: #009900">@part</span><span style="color: #990000">.</span>assemblies<span style="color: #990000">.</span>delete<span style="color: #990000">(</span><span style="color: #009900">@assembly1</span><span style="color: #990000">)</span></tt></pre></div></div>
<h5 id="_tt_em_collection_em_objects_tt_2"><tt><em>collection</em>=objects</tt></h5>
<div class="paragraph"><p>Metoda <tt><em>collection</em>=</tt> usuwa i dodaje odpowiednie obiekty tak, żeby dana kolekcja zawierała tylko podane (wymienione) obiekty.</p></div>
<h5 id="_tt_em_collection_singular_em_ids_tt_2"><tt><em>collection_singular</em>_ids</tt></h5>
<div class="paragraph"><p>Metoda <tt><em>collection_singular</em>_ids</tt> zwraca tablicę identyfikatorów obiektów w zbiorze.</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 2.11
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="color: #009900">@assembly_ids</span> <span style="color: #990000">=</span> <span style="color: #009900">@part</span><span style="color: #990000">.</span>assembly_ids</tt></pre></div></div>
<h5 id="_tt_em_collection_singular_em_ids_ids_tt_2"><tt><em>collection_singular</em>_ids=ids</tt></h5>
<div class="paragraph"><p>Metoda <tt><em>collection_singular</em>_ids=</tt> sprawia, że w zbiorze znajdują się tylko te
obiekty, których wartość podstawowego klucza równa jest wartościom dostarczonym do metody.</p></div>
<h5 id="_tt_em_collection_em_clear_tt_2"><tt><em>collection</em>.clear</tt></h5>
<div class="paragraph"><p>Metoda <tt><em>collection</em>.clear</tt> usuwa wszystkie elementy zbioru poprzez usunięcie wierszy z dołączanej tabeli. Nie niszczy to żadnych wiązanych obiektów.</p></div>
<h5 id="_tt_em_collection_em_empty_tt_2"><tt><em>collection</em>.empty?</tt></h5>
<div class="paragraph"><p>Metoda <tt><em>collection</em>.empty?</tt> zwraca wartośc <tt>true</tt>, jeśli zbiór nie posiada żadnych związanych obiektów.</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 2.11
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="color: #FF0000">&lt;% if @part.assemblies.empty? %&gt;</span>
  Ta część nie została użyta w żadnym zbiorze
<span style="color: #FF0000">&lt;% end %&gt;</span></tt></pre></div></div>
<h5 id="_tt_em_collection_em_size_tt_2"><tt><em>collection</em>.size</tt></h5>
<div class="paragraph"><p>Metoda <tt><em>collection</em>.size</tt> zwraca liczbę obiektów w zbiorze.</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 2.11
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="color: #009900">@assembly_count</span> <span style="color: #990000">=</span> <span style="color: #009900">@part</span><span style="color: #990000">.</span>assemblies<span style="color: #990000">.</span>size</tt></pre></div></div>
<h5 id="_tt_em_collection_em_find_tt_2"><tt><em>collection</em>.find(...)</tt></h5>
<div class="paragraph"><p>Metoda <tt><em>collection</em>.find</tt> służy do wyszukiwania obiektów w zbiorze. Korzysta ona z tej samej składni i tych samych opcji, co ActiveRecord::Base.find. To także daje nam warunek konieczności istnienia obiektu w zbiorze</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 2.11
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="color: #009900">@new_assemblies</span> <span style="color: #990000">=</span> <span style="color: #009900">@part</span><span style="color: #990000">.</span>assemblies<span style="color: #990000">.</span>find<span style="color: #990000">(:</span>all<span style="color: #990000">,</span> <span style="color: #990000">:</span>conditions <span style="color: #990000">=&gt;</span> <span style="color: #990000">[</span><span style="color: #FF0000">"created_at &gt; ?"</span><span style="color: #990000">,</span> <span style="color: #993399">2</span><span style="color: #990000">.</span>days<span style="color: #990000">.</span>ago<span style="color: #990000">])</span></tt></pre></div></div>
<h5 id="_tt_em_collection_em_exist_tt_2"><tt><em>collection</em>.exist?(...)</tt></h5>
<div class="paragraph"><p>Metoda collection.exist? sprawdza, czy obiekt spełniający podane warunki istnieje w danym zbiorze. Metoda ta używa takiej samej składni i takich samych opcji jak <tt>ActiveRecord::Base.exists?</tt>.</p></div>
<h5 id="_tt_em_collection_em_build_attributes_tt_2"><tt><em>collection</em>.build(attributes = {})</tt></h5>
<div class="paragraph"><p>Metoda <tt><em>collection</em>.build</tt> zwraca jeden lub więcej nowych obiektów wiązanego typu. Obiekty te będą konstruowane na podstawie podanych atrybutów. Połączenie poprzez ich klucz obcy zostanie stworzone, ale powiązane obiekty <em>nie</em> będą zapisane.</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 2.11
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="color: #009900">@assembly</span> <span style="color: #990000">=</span> <span style="color: #009900">@part</span><span style="color: #990000">.</span>assemblies<span style="color: #990000">.</span>build<span style="color: #990000">(</span><span style="color: #FF0000">{</span><span style="color: #990000">:</span>assembly_name <span style="color: #990000">=&gt;</span> <span style="color: #FF0000">"Transmission housing"</span><span style="color: #FF0000">}</span><span style="color: #990000">)</span></tt></pre></div></div>
<h5 id="_tt_em_collection_em_create_attributes_tt_2"><tt><em>collection</em>.create(attributes = {})</tt></h5>
<div class="paragraph"><p>Metoda <tt><em>collection</em>.create</tt> zwraca nowy obiekt wiązanego typu. Ten obiekt będzie
konstruowany z ustawionych atrybutów. Powiązanie z pośrednią tabelą będzie stworzone, a
wiązany obiekt <em>zostanie</em> zapisany (jeśli przejdzie pomyślnie przez walidację).</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 2.11
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="color: #009900">@assembly</span> <span style="color: #990000">=</span> <span style="color: #009900">@part</span><span style="color: #990000">.</span>assemblies<span style="color: #990000">.</span>create<span style="color: #990000">(</span><span style="color: #FF0000">{</span><span style="color: #990000">:</span>assembly_name <span style="color: #990000">=&gt;</span> <span style="color: #FF0000">"Transmission housing"</span><span style="color: #FF0000">}</span><span style="color: #990000">)</span></tt></pre></div></div>
<h4 id="_opcje_dla_tt_has_and_belongs_to_many_tt">4.4.2. Opcje dla <tt>has_and_belongs_to_many</tt></h4>
<div class="paragraph"><p>W wielu sytuacjach możesz użyć asocjacji <tt>has_and_belongs_to_many</tt> bez potrzeby jej dostosowywania. Ale możesz też zmieniać domyślne ustawienia na kilka sposobów. Ten rozdział przedstawi ci opcje, których możesz używać, kiedy zadeklarujesz asocjację <tt>has_and_belongs_to_many</tt>. Na przykład asocjacja z kilkoma opcjami może wyglądać tak:</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 2.11
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="font-weight: bold"><span style="color: #0000FF">class</span></span> Parts <span style="color: #990000">&lt;</span> ActiveRecord<span style="color: #990000">::</span>Base
  has_and_belongs_to_many <span style="color: #990000">:</span>assemblies<span style="color: #990000">,</span> <span style="color: #990000">:</span>uniq <span style="color: #990000">=&gt;</span> <span style="font-weight: bold"><span style="color: #0000FF">true</span></span><span style="color: #990000">,</span> <span style="color: #990000">:</span>read_only <span style="color: #990000">=&gt;</span> <span style="font-weight: bold"><span style="color: #0000FF">true</span></span>
<span style="font-weight: bold"><span style="color: #0000FF">end</span></span></tt></pre></div></div>
<div class="paragraph"><p>Asocjacja <tt>has_and_belongs_to_many</tt> wspiera takie opcje:</p></div>
<div class="ulist"><ul>
<li>
<p>
<tt>:association_foreign_key</tt>
</p>
</li>
<li>
<p>
<tt>:class_name</tt>
</p>
</li>
<li>
<p>
<tt>:conditions</tt>
</p>
</li>
<li>
<p>
<tt>:counter_sql</tt>
</p>
</li>
<li>
<p>
<tt>:delete_sql</tt>
</p>
</li>
<li>
<p>
<tt>:extend</tt>
</p>
</li>
<li>
<p>
<tt>:finder_sql</tt>
</p>
</li>
<li>
<p>
<tt>:foreign_key</tt>
</p>
</li>
<li>
<p>
<tt>:group</tt>
</p>
</li>
<li>
<p>
<tt>:include</tt>
</p>
</li>
<li>
<p>
<tt>:insert_sql</tt>
</p>
</li>
<li>
<p>
<tt>:join_table</tt>
</p>
</li>
<li>
<p>
<tt>:limit</tt>
</p>
</li>
<li>
<p>
<tt>:offset</tt>
</p>
</li>
<li>
<p>
<tt>:order</tt>
</p>
</li>
<li>
<p>
<tt>:readonly</tt>
</p>
</li>
<li>
<p>
<tt>:select</tt>
</p>
</li>
<li>
<p>
<tt>:uniq</tt>
</p>
</li>
<li>
<p>
<tt>:validate</tt>
</p>
</li>
</ul></div>
<h5 id="_tt_association_foreign_key_tt"><tt>:association_foreign_key</tt></h5>
<div class="paragraph"><p>Zgodnie z konwencją Railsy "domyślają się", że kolumna w tabeli łączącej, używana do przechowywania klucza obcego wskazującego na inny model to nazwa tego modelu z przyrostkiem <tt>_id</tt>. Opcja <tt>:association_foreign_key</tt> pozwala Ci ustawić nazwę obcego klucza bezpośrednio.</p></div>
<div class="admonitionblock">
<table><tr>
<td class="icon">
<img src="./images/icons/tip.png" alt="Tip" />
</td>
<td class="content">Opcje <tt>:foreign_key</tt> oraz <tt>:association_foreign_key</tt> są przydatne gdy ustawiasz samodniesienie się tabeli (odwołanie rekurencyjne) dla typu relacji wiele-do wiele. Na przykład:</td>
</tr></table>
</div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 2.11
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="font-weight: bold"><span style="color: #0000FF">class</span></span> User <span style="color: #990000">&lt;</span> ActiveRecord<span style="color: #990000">::</span>Base
  has_and_belongs_to_many <span style="color: #990000">:</span>friends<span style="color: #990000">,</span> <span style="color: #990000">:</span>class_name <span style="color: #990000">=&gt;</span> <span style="color: #FF0000">"User"</span><span style="color: #990000">,</span>
    <span style="color: #990000">:</span>foreign_key <span style="color: #990000">=&gt;</span> <span style="color: #FF0000">"this_user_id"</span><span style="color: #990000">,</span> <span style="color: #990000">:</span>association_foreign_key <span style="color: #990000">=&gt;</span> <span style="color: #FF0000">"other_user_id"</span>
<span style="font-weight: bold"><span style="color: #0000FF">end</span></span></tt></pre></div></div>
<h5 id="_tt_class_name_tt_4"><tt>:class_name</tt></h5>
<div class="paragraph"><p>Jeśli nazwa innego modelu nie może zostać utworzona z nazwy asocjacji, możesz użyć opcji
<tt>:class_name</tt>, by dostarczyć nazwę modelu. Na przykład jeśli <em>part</em> (część) ma wiele
<em>assemblies</em> (zadań), ale aktualna nazwa zawierająca <em>assemblies</em> to "Gadget", możesz to
ustawić w ten sposób:</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 2.11
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="font-weight: bold"><span style="color: #0000FF">class</span></span> Parts <span style="color: #990000">&lt;</span> ActiveRecord<span style="color: #990000">::</span>Base
  has_and_belongs_to_many <span style="color: #990000">:</span>assemblies<span style="color: #990000">,</span> <span style="color: #990000">:</span>class_name <span style="color: #990000">=&gt;</span> <span style="color: #FF0000">"Gadget"</span>
<span style="font-weight: bold"><span style="color: #0000FF">end</span></span></tt></pre></div></div>
<h5 id="_tt_conditions_tt_4"><tt>:conditions</tt></h5>
<div class="paragraph"><p>Opcja <tt>:conditions</tt> pozwala określić warunki, jakie wiązany obiekt musi spełniać (W składni SQL użyłbyś klauzuli WHERE).</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 2.11
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="font-weight: bold"><span style="color: #0000FF">class</span></span> Parts <span style="color: #990000">&lt;</span> ActiveRecord<span style="color: #990000">::</span>Base
  has_and_belongs_to_many <span style="color: #990000">:</span>assemblies<span style="color: #990000">,</span> <span style="color: #990000">:</span>conditions <span style="color: #990000">=&gt;</span> <span style="color: #FF0000">"factory = 'Seattle'"</span>
<span style="font-weight: bold"><span style="color: #0000FF">end</span></span></tt></pre></div></div>
<div class="paragraph"><p>Możesz także określać warunki używając hash-a:</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 2.11
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="font-weight: bold"><span style="color: #0000FF">class</span></span> Parts <span style="color: #990000">&lt;</span> ActiveRecord<span style="color: #990000">::</span>Base
  has_and_belongs_to_many <span style="color: #990000">:</span>assemblies<span style="color: #990000">,</span> <span style="color: #990000">:</span>conditions <span style="color: #990000">=&gt;</span> <span style="color: #FF0000">{</span> <span style="color: #990000">:</span>factory <span style="color: #990000">=&gt;</span> <span style="color: #FF0000">'Seattle'</span> <span style="color: #FF0000">}</span>
<span style="font-weight: bold"><span style="color: #0000FF">end</span></span></tt></pre></div></div>
<div class="paragraph"><p>Jeżeli użyjesz opcji <tt>:conditions</tt> (w notacji z hashem), tworzenie rekordów przez tą asocjację zostanie zautomatyzowane według zawartości hasha. W tym przypadku, używając <tt>@parts.assemblies.create</tt> lub <tt>@parts.assemblies.build</tt>, tworzy się zamówienia tam, gdzie kolumna factory ma wartość "Seattle".</p></div>
<h5 id="_tt_counter_sql_tt_2"><tt>:counter_sql</tt></h5>
<div class="paragraph"><p>Zwykle Railsy automatycznie tworzą odpowiednie zapytanie SQL do liczenia uczestników asocjacji. Z opcją <tt>:counter_sql</tt> możesz zdefiniować własne zapytanie sql do policzenia ich.</p></div>
<div class="admonitionblock">
<table><tr>
<td class="icon">
<img src="./images/icons/note.png" alt="Note" />
</td>
<td class="content">Jeśli określisz <tt>:finder_sql</tt>, ale nie stworzysz <tt>:counter_sql</tt>, wtedy funkcja licząca sql <tt>SELECT COUNT(*) FROM</tt> zostanie zastąpiona klauzulą <tt>SELECT ... FROM</tt>, wykorzystującą deklaracje z <tt>:finder_sql</tt>.</td>
</tr></table>
</div>
<h5 id="_tt_delete_sql_tt"><tt>:delete_sql</tt></h5>
<div class="paragraph"><p>Zwykle Railsy automatycznie generują właściwe zapytanie SQL w celu usunięcia związków pomiędzy związanymi klasami. Dzięki opcji delete_sql możesz zdefiniować własne zapytanie SQL by usunąć je samodzielnie.</p></div>
<h5 id="_tt_extend_tt_2"><tt>:extend</tt></h5>
<div class="paragraph"><p>Opcja <tt>:extend</tt> sprawia, że nazwany moduł rozszerza proxy asocjacji. Rozszerzenia asocjacji są opisane dalej w tym podręczniku.</p></div>
<h5 id="_tt_finder_sql_tt_2"><tt>:finder_sql</tt></h5>
<div class="paragraph"><p>Zwykle Railsy automatycznie tworzą odpowiednie zapytanie SQL do pobrania <em>uczestników</em> asocjacji. Z opcją <tt>:finder_sql</tt> możesz zdefiniować takie zapytanie samodzielnie. Jeśli pobieranie obiektów wymaga wielu skomplikowanych operacji na wielu tabelach, może to być konieczne.</p></div>
<h5 id="_tt_foreign_key_tt_4"><tt>:foreign_key</tt></h5>
<div class="paragraph"><p>Zgodnie z konwencją, Railsy "domyślają się", że kolumna używana do przechowywania klucza obcego w innym modelu to nazwa pierwszego modelu z przyrostkiem <tt>_id</tt>. Opcja <tt>:foreign_key</tt> umożliwia ustawienie nazwy klucza obcego bezpośrednio:</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 2.11
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="font-weight: bold"><span style="color: #0000FF">class</span></span> User <span style="color: #990000">&lt;</span> ActiveRecord<span style="color: #990000">::</span>Base
  has_and_belongs_to_many <span style="color: #990000">:</span>friends<span style="color: #990000">,</span> <span style="color: #990000">:</span>class_name <span style="color: #990000">=&gt;</span> <span style="color: #FF0000">"User"</span><span style="color: #990000">,</span>
    <span style="color: #990000">:</span>foreign_key <span style="color: #990000">=&gt;</span> <span style="color: #FF0000">"this_user_id"</span><span style="color: #990000">,</span> <span style="color: #990000">:</span>association_foreign_key <span style="color: #990000">=&gt;</span> <span style="color: #FF0000">"other_user_id"</span>
<span style="font-weight: bold"><span style="color: #0000FF">end</span></span></tt></pre></div></div>
<h5 id="_tt_group_tt_2"><tt>:group</tt></h5>
<div class="paragraph"><p>Opcja <tt>:group</tt> dostarcza nazwę atrybutu według której wyniki mają być pogrupowane, W SQL użyłbyś klauzuli <tt>GROUP BY</tt>.</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 2.11
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="font-weight: bold"><span style="color: #0000FF">class</span></span> Parts <span style="color: #990000">&lt;</span> ActiveRecord<span style="color: #990000">::</span>Base
  has_and_belongs_to_many <span style="color: #990000">:</span>assemblies<span style="color: #990000">,</span> <span style="color: #990000">:</span>group <span style="color: #990000">=&gt;</span> <span style="color: #FF0000">"factory"</span>
<span style="font-weight: bold"><span style="color: #0000FF">end</span></span></tt></pre></div></div>
<h5 id="_tt_include_tt_4"><tt>:include</tt></h5>
<div class="paragraph"><p>Możesz użyć opcji <tt>:include</tt> do podania drugorzędnych asocjacji, które zostaną załadowane wtedy, gdy zostanie użyta dana asocjacja.</p></div>
<h5 id="_tt_insert_sql_tt"><tt>:insert_sql</tt></h5>
<div class="paragraph"><p>Zwykle Railsy generują automatycznie odpowiednie zapytanie SQL do stworzenia powiązania między asocjowanymi klasami. Jednak z opcją <tt>:insert_sql</tt> możesz sam określić kompletne zapytanie SQL do tworzenia klas.</p></div>
<h5 id="_tt_join_table_tt"><tt>:join_table</tt></h5>
<div class="paragraph"><p>Jeśli domyślna nazwa tabeli łączącej utworzona w oparciu o porządek alfabetyczny nie jest tym, czego oczekujesz, możesz uzyć opcji <tt>:join_table</tt> by nadpisać domyślne ustawienia</p></div>
<h5 id="_tt_limit_tt_2"><tt>:limit</tt></h5>
<div class="paragraph"><p>Opcja <tt>:limit</tt>  pozwala ograniczyć liczbę obiektów, które będą pobierane dzięki asocjacji.</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 2.11
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="font-weight: bold"><span style="color: #0000FF">class</span></span> Parts <span style="color: #990000">&lt;</span> ActiveRecord<span style="color: #990000">::</span>Base
  has_and_belongs_to_many <span style="color: #990000">:</span>assemblies<span style="color: #990000">,</span> <span style="color: #990000">:</span>order <span style="color: #990000">=&gt;</span> <span style="color: #FF0000">"created_at DESC"</span><span style="color: #990000">,</span> <span style="color: #990000">:</span>limit <span style="color: #990000">=&gt;</span> <span style="color: #993399">50</span>
<span style="font-weight: bold"><span style="color: #0000FF">end</span></span></tt></pre></div></div>
<h5 id="_tt_offset_tt_2"><tt>:offset</tt></h5>
<div class="paragraph"><p>Opcja <tt>:offset</tt> pozwala zdefiniować <em>offset</em> dla obiektów pobieranych w asocjacji. Na przykład, jeśli ustawisz <tt>:offset =&gt; 11</tt>, zostanie pominiętych pierwszych 11 rekordów (por. z klauzulą SQL <tt>LIMIT 0,1</tt>. Offset jest tą pierwszą liczbą – przyp.tłum)</p></div>
<h5 id="_tt_order_tt_3"><tt>:order</tt></h5>
<div class="paragraph"><p>Opcja <tt>:order</tt> ustawia porządek w jakim powiązane obiekty będą "wyciągane" (w składni SQL użyłbyś klauzuli <tt>ORDER BY</tt>).</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 2.11
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="font-weight: bold"><span style="color: #0000FF">class</span></span> Parts <span style="color: #990000">&lt;</span> ActiveRecord<span style="color: #990000">::</span>Base
  has_and_belongs_to_many <span style="color: #990000">:</span>assemblies<span style="color: #990000">,</span> <span style="color: #990000">:</span>order <span style="color: #990000">=&gt;</span> <span style="color: #FF0000">"assembly_name ASC"</span>
<span style="font-weight: bold"><span style="color: #0000FF">end</span></span></tt></pre></div></div>
<h5 id="_tt_readonly_tt_4"><tt>:readonly</tt></h5>
<div class="paragraph"><p>Jeśli ustawisz <tt>true</tt> dla opcji <tt>:readonly</tt>, asocjowane obiekty będą tylko do odczytu, gdy wywoływana jest asocjacja.</p></div>
<h5 id="_tt_select_tt_4"><tt>:select</tt></h5>
<div class="paragraph"><p>Użyj opcji <tt>:select</tt> by zastąpić klauzulę SQL <tt>SELECT</tt>, która służy do wyszukiwania
danych w wiązanym obiekcie. Domyślnie Railsy pobierają wszystkie kolumny</p></div>
<h5 id="_tt_uniq_tt_2"><tt>:uniq</tt></h5>
<div class="paragraph"><p>Ustaw opcję <tt>:uniq =&gt; true</tt> aby usunąć ze zbiorów duplikaty.</p></div>
<h5 id="_tt_validate_tt_4"><tt>:validate</tt></h5>
<div class="paragraph"><p>Kiedy ustawisz na <tt>false</tt> opcję <tt>:validate</tt>, wiązane obiekty nie będą nigdy walidowane,
kiedy będziesz zapisywać obiekt. Domyślne ustawienie to <tt>true</tt>: wiązane obiekty są walidowane kiedy je zapisujesz.</p></div>
<h4 id="_kiedy_obiekty_s_zapisywane_4">4.4.3. Kiedy obiekty są zapisywane?</h4>
<div class="paragraph"><p>Kiedy przypisujesz obiekt do asocjacji <tt>has_and_belongs_to_many</tt>, obiekt jest automatycznie zapisywany (żeby zaktualizować tabelę wiążącą). Jeśli wiążesz wiele obiektów w jednym zapytanie, wszystkie zostaną zapisane.</p></div>
<div class="paragraph"><p>Jeśli którykolwiek z tych zapisów nie powiedzie się z winy błędu walidacji, wtedy rozkaz przypisania zwróci <tt>false</tt>, a samo przypisanie będzie anulowane.</p></div>
<div class="paragraph"><p>Jeśli obiekt-rodzic (ten, w którym jest deklaracja <tt>has_and_belongs_to_many</tt>) nie został zapisany (czyli <tt>new_record?</tt> zwróci <tt>true</tt>), wtedy dodane obiekty-dzieci również nie zostaną zapisane. Wszyscy niezapisani uczestnicy asocjacji będą automatycznie zapisani, kiedy rodzic zostanie zapisany.</p></div>
<div class="paragraph"><p>Jeśli chcesz przypisać obiekt do asocjacji <tt>has_many</tt> bez jego zapisywania, użyj metody <tt><em>collection</em>.build</tt>.</p></div>
<h3 id="_callbacki_asocjacji">4.5. Callbacki asocjacji</h3>
<div class="paragraph"><p>Funkcje z callbackiem "zaczepiają się" o cykl życia obiektów Active Record, pozwalając
na pracę z tymi obiektami w różnych momentach. Na przykład, możesz użyć callbacka
<tt>:before_save</tt> i sprawić, by coś się stało tuż przed tym, kiedy obiekt zostanie zapisany.</p></div>
<div class="paragraph"><p>Callbacki w asocjacjach podobne są do zwykłych callbacków, z tym, że (te pierwsze -
przyp.tłum) uruchamiane są przez zdarzenia w cyklu życia zbioru. W asocjacjach dostępne
są cztery callbacki:</p></div>
<div class="ulist"><ul>
<li>
<p>
<tt>before_add</tt>
</p>
</li>
<li>
<p>
<tt>after_add</tt>
</p>
</li>
<li>
<p>
<tt>before_remove</tt>
</p>
</li>
<li>
<p>
<tt>after_remove</tt>
</p>
</li>
</ul></div>
<div class="paragraph"><p>Callback asocjacji definiuje się dodając opcje do deklaracji asocjacji. Na przykład:</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 2.11
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="font-weight: bold"><span style="color: #0000FF">class</span></span> Customer <span style="color: #990000">&lt;</span> ActiveRecord<span style="color: #990000">::</span>Base
  has_many <span style="color: #990000">:</span>orders<span style="color: #990000">,</span> <span style="color: #990000">:</span>before_add <span style="color: #990000">=&gt;</span> <span style="color: #990000">:</span>check_credit_limit

  <span style="font-weight: bold"><span style="color: #0000FF">def</span></span> check_credit_limit<span style="color: #990000">(</span>order<span style="color: #990000">)</span>
    <span style="color: #990000">...</span>
  <span style="font-weight: bold"><span style="color: #0000FF">end</span></span>
<span style="font-weight: bold"><span style="color: #0000FF">end</span></span></tt></pre></div></div>
<div class="paragraph"><p>Railsy przekazują do callbacka obiekt, który ma być dodany lub wymazany.</p></div>
<div class="paragraph"><p>Możesz użyć stosu [<em>stack</em>] wywołań, które będą traktowane jak pojedynczy callback, przekazując wywołania do w tablicy:</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 2.11
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="font-weight: bold"><span style="color: #0000FF">class</span></span> Customer <span style="color: #990000">&lt;</span> ActiveRecord<span style="color: #990000">::</span>Base
  has_many <span style="color: #990000">:</span>orders<span style="color: #990000">,</span> <span style="color: #990000">:</span>before_add <span style="color: #990000">=&gt;</span> <span style="color: #990000">[:</span>check_credit_limit<span style="color: #990000">,</span> <span style="color: #990000">:</span>calculate_shipping_charges<span style="color: #990000">]</span>

  <span style="font-weight: bold"><span style="color: #0000FF">def</span></span> check_credit_limit<span style="color: #990000">(</span>order<span style="color: #990000">)</span>
    <span style="color: #990000">...</span>
  <span style="font-weight: bold"><span style="color: #0000FF">end</span></span>

  <span style="font-weight: bold"><span style="color: #0000FF">def</span></span> calculate_shipping_charges<span style="color: #990000">(</span>order<span style="color: #990000">)</span>
    <span style="color: #990000">...</span>
  <span style="font-weight: bold"><span style="color: #0000FF">end</span></span>
<span style="font-weight: bold"><span style="color: #0000FF">end</span></span></tt></pre></div></div>
<div class="paragraph"><p>Jeśli callback <tt>before_add</tt> rzuci wyjątek, obiekt nie może zostać dodany do zbioru.
Podobnie jeśli <tt>before_remove</tt> rzuci wyjątek, nie można obiektu usunąć ze zbioru.</p></div>
<h3 id="_rozszerzenia_asocjacji">4.6. Rozszerzenia asocjacji</h3>
<div class="paragraph"><p>Nie jesteś ograniczony do funkcjonalności, którą Railsy automatycznie wbudowuje w
obiekty proxy asocjacji. Możesz rozszerzać te obiekty używając anonimowych modułów, dodawanie
nowych finderów, kreatorów i innych metod. Na przykład:</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 2.11
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="font-weight: bold"><span style="color: #0000FF">class</span></span> Customer <span style="color: #990000">&lt;</span> ActiveRecord<span style="color: #990000">::</span>Base
  has_many <span style="color: #990000">:</span>orders <span style="font-weight: bold"><span style="color: #0000FF">do</span></span>
    <span style="font-weight: bold"><span style="color: #0000FF">def</span></span> find_by_order_prefix<span style="color: #990000">(</span>order_number<span style="color: #990000">)</span>
      find_by_region_id<span style="color: #990000">(</span>order_number<span style="color: #990000">[</span><span style="color: #993399">0</span><span style="color: #990000">..</span><span style="color: #993399">2</span><span style="color: #990000">])</span>
    <span style="font-weight: bold"><span style="color: #0000FF">end</span></span>
  <span style="font-weight: bold"><span style="color: #0000FF">end</span></span>
<span style="font-weight: bold"><span style="color: #0000FF">end</span></span></tt></pre></div></div>
<div class="paragraph"><p>Jeśli posiadasz rozszerzenia, które powinny zostać udostępnione dla wielu asocjacji, możesz użyć modułu o nazwie <em>extension</em> (rozszerzenie). Na przykład:</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 2.11
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="font-weight: bold"><span style="color: #0000FF">module</span></span> FindRecentExtension
  <span style="font-weight: bold"><span style="color: #0000FF">def</span></span> find_recent
    find<span style="color: #990000">(:</span>all<span style="color: #990000">,</span> <span style="color: #990000">:</span>conditions <span style="color: #990000">=&gt;</span> <span style="color: #990000">[</span><span style="color: #FF0000">"created_at &gt; ?"</span><span style="color: #990000">,</span> <span style="color: #993399">5</span><span style="color: #990000">.</span>days<span style="color: #990000">.</span>ago<span style="color: #990000">])</span>
  <span style="font-weight: bold"><span style="color: #0000FF">end</span></span>
<span style="font-weight: bold"><span style="color: #0000FF">end</span></span>

<span style="font-weight: bold"><span style="color: #0000FF">class</span></span> Customer <span style="color: #990000">&lt;</span> ActiveRecord<span style="color: #990000">::</span>Base
  has_many <span style="color: #990000">:</span>orders<span style="color: #990000">,</span> <span style="color: #990000">:</span>extend <span style="color: #990000">=&gt;</span> FindRecentExtension
<span style="font-weight: bold"><span style="color: #0000FF">end</span></span>

<span style="font-weight: bold"><span style="color: #0000FF">class</span></span> Supplier <span style="color: #990000">&lt;</span> ActiveRecord<span style="color: #990000">::</span>Base
  has_many <span style="color: #990000">:</span>deliveries<span style="color: #990000">,</span> <span style="color: #990000">:</span>extend <span style="color: #990000">=&gt;</span> FindRecentExtension
<span style="font-weight: bold"><span style="color: #0000FF">end</span></span></tt></pre></div></div>
<div class="paragraph"><p>By załączyć więcej niż jeden moduł rozszerzeń w jednej asocjacji, użyj tablicy nazw:</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 2.11
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="font-weight: bold"><span style="color: #0000FF">class</span></span> Customer <span style="color: #990000">&lt;</span> ActiveRecord<span style="color: #990000">::</span>Base
  has_many <span style="color: #990000">:</span>orders<span style="color: #990000">,</span> <span style="color: #990000">:</span>extend <span style="color: #990000">=&gt;</span> <span style="color: #990000">[</span>FindRecentExtension<span style="color: #990000">,</span> FindActiveExtension<span style="color: #990000">]</span>
<span style="font-weight: bold"><span style="color: #0000FF">end</span></span></tt></pre></div></div>
<div class="paragraph"><p>Rozszerzenia mogą pobierać informacji o asocjacji, dzięki użyciu
trzech akcesorów:</p></div>
<div class="ulist"><ul>
<li>
<p>
<tt>proxy_owner</tt> zwraca obiekt, którego asocjacja jest częścią.
</p>
</li>
<li>
<p>
<tt>proxy_reflection</tt> zwraca "odbicie" obiektu opisywanego przez asocjację.
</p>
</li>
<li>
<p>
<tt>proxy_target</tt> zwraca powiązany element dla <tt>belongs_to</tt> lub <tt>has_one</tt> lub zbiór
  wiązanych obiektów dla <tt>has_many</tt> lub <tt>has_and_belongs_to_many</tt>.
</p>
</li>
</ul></div>
</div>
<h2 id="_changelog">5. Changelog</h2>
<div class="sectionbody">
<div class="paragraph"><p><a href="http://rails.lighthouseapp.com/projects/16213-rails-guides/tickets/11">Lighthouse ticket</a></p></div>
<div class="ulist"><ul>
<li>
<p>
February 11, 2009, Initial version of polish translation.
</p>
</li>
<li>
<p>
September 28, 2008: Corrected <tt>has_many :through</tt> diagram, added polymorphic diagram, some reorganization by <a href="../authors.html#mgunderloy">Mike Gunderloy</a> . First release version.
</p>
</li>
<li>
<p>
September 22, 2008: Added diagrams, misc. cleanup by <a href="../authors.html#mgunderloy">Mike Gunderloy</a> (not yet approved for publication)
</p>
</li>
<li>
<p>
September 14, 2008: initial version by <a href="../authors.html#mgunderloy">Mike Gunderloy</a> (not yet approved for publication)
</p>
</li>
</ul></div>
</div>

    </div>
  </div>
</body>
</html>
