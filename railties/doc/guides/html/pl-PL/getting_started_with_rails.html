<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
  <title>Zaczynamy z Ruby on Rails</title>
  <!--[if lt IE 8]>
  <script src="http://ie7-js.googlecode.com/svn/version/2.0(beta3)/IE8.js" type="text/javascript"></script>
  <![endif]-->
  <link href="stylesheets/base.css" media="screen" rel="Stylesheet" type="text/css" />
  <link href="stylesheets/forms.css" media="screen" rel="Stylesheet" type="text/css" />
  <link href="stylesheets/more.css" media="screen" rel="Stylesheet" type="text/css" />
</head>
<body>
  <div id="header" >
    <div id="logo">
      <a href="index.html" title="Ruby on Rails"><img src="images/rails_logo_remix.gif" alt="Rails" height="140" width="110" /></a>
    </div>

    <h1 id="site_title"><span>Ruby on Rails</span></h1>
    <h2 id="site_title_tagline">Sustainable productivity for web-application development</h2>

    <ul id="navMain">
      <li class="first-child"><a href="http://www.rubyonrails.org/" title="Ruby on Rails" class="ruby_on_rails">Ruby on Rails</a></li>
      <li><a class="manuals" href="index.html" title="Manuals Index">Guides Index</a></li>
    </ul>
  </div>

  <div id="container">
    
    <div id="sidebar">
      <h2>Chapters</h2>
      <ol>
          <li>
          <a href="#_co_obejmuje_przewodnik">Co obejmuje przewodnik?</a>
          </li>
          <li>
          <a href="#_co_to_s_railsy">Co to są Railsy?</a>
            <ul>
            
              <li><a href="#_architektura_mvc">Architektura MVC</a></li>
            
              <li><a href="#_sk_adniki_rails_w">Składniki Railsów</a></li>
            
              <li><a href="#_rest">REST</a></li>
            
            </ul>
          </li>
          <li>
          <a href="#_tworzenie_nowego_projektu_w_railsach">Tworzenie nowego projektu w Railsach</a>
            <ul>
            
              <li><a href="#_instalacja_rodowiska_rails">Instalacja środowiska Rails</a></li>
            
              <li><a href="#_tworzenie_bloga">Tworzenie bloga</a></li>
            
              <li><a href="#_konfiguracja_bazy_danych">Konfiguracja bazy danych</a></li>
            
            </ul>
          </li>
          <li>
          <a href="#_witajcie_railsy">Witajcie Railsy!</a>
            <ul>
            
              <li><a href="#_uruchamianie_serwera_www">Uruchamianie serwera WWW</a></li>
            
              <li><a href="#_konfiguracja_strony_domowej_programu">Konfiguracja strony domowej programu</a></li>
            
            </ul>
          </li>
          <li>
          <a href="#_szybki_start_dzi_ki_rusztowaniu">Szybki start dzięki rusztowaniu.</a>
          </li>
          <li>
          <a href="#_tworzenie_zasobu">Tworzenie zasobu</a>
            <ul>
            
              <li><a href="#_uruchamianie_migracji">Uruchamianie Migracji</a></li>
            
              <li><a href="#_dodawanie_hiper_cza">Dodawanie hiperłącza</a></li>
            
              <li><a href="#_praca_z_postami_w_przegl_darce">Praca z postami w przeglądarce</a></li>
            
              <li><a href="#_model">Model</a></li>
            
              <li><a href="#_sprawdzanie_poprawno_ci_danych">Sprawdzanie poprawności danych</a></li>
            
              <li><a href="#_u_ywanie_konsoli">Używanie konsoli</a></li>
            
              <li><a href="#_wy_wietlanie_post_w">Wyświetlanie postów</a></li>
            
              <li><a href="#_dostosowanie_layoutu">Dostosowanie layoutu</a></li>
            
              <li><a href="#_tworzenie_nowego_posta">Tworzenie nowego posta</a></li>
            
              <li><a href="#_wy_wietlanie_pojedynczego_posta">Wyświetlanie pojedynczego posta</a></li>
            
              <li><a href="#_edytowanie_post_w">Edytowanie postów</a></li>
            
              <li><a href="#_usuwanie_posta">Usuwanie posta</a></li>
            
            </ul>
          </li>
          <li>
          <a href="#_wykorzystanie_zasady_dry">Wykorzystanie zasady DRY</a>
            <ul>
            
              <li><a href="#_u_ywanie_podszablon_w_do_eliminowania_powt_rze_w_widokach">Używanie podszablonów do eliminowania powtórzeń w widokach</a></li>
            
              <li><a href="#_u_ywanie_filtr_w_do_eliminowania_powt_rze_w_kontrolerach">Używanie filtrów do eliminowania powtórzeń w kontrolerach</a></li>
            
            </ul>
          </li>
          <li>
          <a href="#_dodawanie_kolejnego_modelu">Dodawanie kolejnego modelu</a>
            <ul>
            
              <li><a href="#_tworzenie_modelu">Tworzenie modelu</a></li>
            
              <li><a href="#_asocjacje_modeli">Asocjacje modeli</a></li>
            
              <li><a href="#_dodawanie_dr_g">Dodawanie dróg</a></li>
            
              <li><a href="#_generowanie_kontrolera">Generowanie kontrolera</a></li>
            
              <li><a href="#_tworzenie_widok_w">Tworzenie widoków</a></li>
            
              <li><a href="#_dodawanie_komentarzy_do_post_w">Dodawanie komentarzy do postów</a></li>
            
            </ul>
          </li>
          <li>
          <a href="#_co_dalej">Co dalej?</a>
          </li>
          <li>
          <a href="#_changelog">Changelog</a>
          </li>
      </ol>
    </div>
    
    <div id="content">
        <h1>Zaczynamy z Ruby on Rails</h1>
      <div id="preamble">
<div class="sectionbody">
<div class="paragraph"><p>Ten przewodnik jest wprowadzeniem do Ruby on Rails. Po jego przeczytaniu
będziesz zaznajomiony z następującymi zagadnieniami:</p></div>
<div class="ulist"><ul>
<li>
<p>
instalowaniem Railsów, tworzeniem nowej aplikacji oraz zestawianiem połączenia z bazę danych
</p>
</li>
<li>
<p>
ogólnym układem aplikacji
</p>
</li>
<li>
<p>
podstawami wzorca MVC (Model, View, Controller) oraz architektury RESTful
</p>
</li>
<li>
<p>
szybkim generowaniem podstawowych elementów aplikacji
</p>
</li>
</ul></div>
</div>
</div>
<h2 id="_co_obejmuje_przewodnik">1. Co obejmuje przewodnik?</h2>
<div class="sectionbody">
<div class="paragraph"><p>Ten przewodnik jest przeznaczony dla początkujących, którzy chcą rozpocząć
tworzenie aplikacji opartych na Railsach. Nie zakłada, że masz wcześniejsze
doświadczenia z Railsami. Niemniej jednak, do najlepszego wykorzystania
tego przewodnika, konieczna jest instalacja:</p></div>
<div class="ulist"><ul>
<li>
<p>
języka <a href="http://www.ruby-lang.org/en/downloads/">Ruby</a>
</p>
</li>
<li>
<p>
<a href="http://rubyforge.org/frs/?group_id=126">RubyGems</a> - narzędzie do dystrybuowania i instalowania paczek zawierających moduły i rozszerzenia języka Ruby
</p>
</li>
<li>
<p>
systemu zarządzania bazą danych <a href="http://www.sqlite.org/">SQLite</a> (preferowane), <a href="http://www.mysql.com/">MySQL</a> lub <a href="http://www.postgresql.org/">PostgreSQL</a>
</p>
</li>
</ul></div>
<div class="paragraph"><p>Zdecydowanie zaleca się zapoznanie z językiem Ruby przed rozpoczęciem przygody z
Railsami. Znacznie łatwiej jest śledzić, co się dzieje w Railsach, rozumiejąc podstawowy
składni języka Ruby. Railsy nie będą w stanie w magiczny sposób zrewolucjonizować sztuki
pisania aplikacji internetowych, jeżeli nie masz doświadczenia w używaniu tego języka.
W Internecie istnieje kilka dobrych darmowych źródeł pomocnych w nauce języka Ruby, w tym:</p></div>
<div class="ulist"><ul>
<li>
<p>
<a href="http://www.humblelittlerubybook.com/">Mr. Neigborly&#8217;s Humble Little Ruby Book</a>
</p>
</li>
<li>
<p>
<a href="http://www.rubycentral.com/book/">Programming Ruby</a>
</p>
</li>
<li>
<p>
<a href="http://poignantguide.net/ruby/">Why&#8217;s (Poignant) Guide to Ruby</a>
</p>
</li>
<li>
<p>
<a href="http://www.apohllo.pl/dydaktyka/ruby/intro/">Wprowadzenie do języka Ruby (po polsku)</a>
</p>
</li>
</ul></div>
</div>
<h2 id="_co_to_s_railsy">2. Co to są Railsy?</h2>
<div class="sectionbody">
<div class="paragraph"><p>Railsy są frameworkiem służącym do tworzenia aplikacji internetowych napisanym w języku
Ruby. Zostały one tak zaprojektowane, aby ułatwić programowanie aplikacji internetowych,
poprzez przyjęcie kilku założeń, dotyczących tego czego potrzebuje każdy
programista aby rozpocząć pracę. Pozwalają one na
pisanie krótszego kodu, jednocześnie umożliwiając osiąganie lepszych rezultatów niż
ma to miejsce w większości innych języków i
frameworków. Poza tym programiści, którzy od dawna używają Railsów, uważają, że
pisanie aplikacji z ich użyciem sprawia prawdziwą przyjemność.</p></div>
<div class="paragraph"><p>Railsy są "upartym" oprogramowaniem. Oznacza to, że były tworzone z
przekonaniem, że istnieje najlepszy sposób rozwiązywania pewnych problemów i
zostały zaprojektowane tak, by zachęcać do wyboru tego sposobu, a w niektórych przypadkach -
by zniechęcić do wyboru alternatywy. Jeśli nauczysz się "The Rails Way", odkryjesz
ogromny wzrost produktywności. Jeżeli jednak podczas pracy z Railsami pozostaniesz przy
nawykach charakterystycznych dla programowania w innych językach lub będziesz
wykorzystywać wzorce, których już kiedyś się nauczyłeś, efekty mogą nie być aż tak pomyślne.</p></div>
<div class="paragraph"><p>Filozofia Railsów obejmuje kilka zasad:</p></div>
<div class="ulist"><ul>
<li>
<p>
DRY - "Don&#8217;t Repeat Yourself" (Nie powtarzaj się) - sugeruje, że pisanie w
  kółko tego samego kodu jest po prostu złe.
</p>
</li>
<li>
<p>
"Convention over Configuration" (Konwencja Ponad Konfiguracją) - Railsy przyjmują pewne założenia, odnośnie tego,
  co i jak zamierzasz zrobić, dlatego nie zmuszają Cię do samodzielnego ustawiania
  każdej najdrobniejszej opcji w plikach konfiguracyjnych.
</p>
</li>
<li>
<p>
REST (Representational State Transfer) jest najlepszym wzorcem dla
  aplikacji internetowych - organizowanie aplikacji wokół zasobów i
  standardowych zapytań HTTP pozwala szybko kroczyć do przodu.
</p>
</li>
</ul></div>
<h3 id="_architektura_mvc">2.1. Architektura MVC</h3>
<div class="paragraph"><p>Railsy zorganizowane są wokół trzech warstw aplikacji:
modelu (<em>model</em>), widoku (<em>view</em>) oraz kontrolera (<em>controller</em>),
w skrócie nazywanych MVC. Wzorzec MVC obejmuje:</p></div>
<div class="ulist"><ul>
<li>
<p>
odizolowanie logiki biznesowej od interfejsu użytkownika
</p>
</li>
<li>
<p>
łatwość utrzymania kodu zgodnie z zasadą DRY
</p>
</li>
<li>
<p>
wyraźne wskazanie, gdzie powinny znajdować się różne elementy kodu, co
  ułatwia zarządzenie nim
</p>
</li>
</ul></div>
<h4 id="_modele">2.1.1. Modele</h4>
<div class="paragraph"><p>Model reprezentuje dane aplikacji i reguły do manipulowania tymi danymi. W przypadku
Railsów, modele są głównie wykorzystywane do zarządzania zasadami interakcji z
odpowiednią tabelą bazy danych. W większości przypadków jednej tabeli bazy danych
odpowiada jeden model. Większość logiki biznesowej aplikacji
będzie skoncentrowana w modelach.</p></div>
<h4 id="_widoki">2.1.2. Widoki</h4>
<div class="paragraph"><p>Widoki tworzą interfejs użytkownika aplikacji. W Railsach widoki są często plikami HTML
zawierającymi kod w języku Ruby, wykonujący zadania związane wyłącznie z prezentacją
danych. Przede wszystkim są one odpowiedzialne za dostarczanie danych do przeglądarki
internetowej lub innego narzędzia, które jest używane do oglądania efektów działania aplikacji.</p></div>
<h4 id="_kontrolery">2.1.3. Kontrolery</h4>
<div class="paragraph"><p>Kontrolery "sklejają" modele i widoki. W Railsach odpowiadają za przetwarzanie żądań
przychodzących z przeglądarki internetowej, pozyskiwanie danych z modeli i przekazywanie
ich do widoków w celu ich prezentacji.</p></div>
<h3 id="_sk_adniki_rails_w">2.2. Składniki Railsów</h3>
<div class="paragraph"><p>Railsy dostarczają zestaw komponentów do tworzenia aplikacji internetowych. Są to:</p></div>
<div class="ulist"><ul>
<li>
<p>
Action Controller
</p>
</li>
<li>
<p>
Action View
</p>
</li>
<li>
<p>
Active Record
</p>
</li>
<li>
<p>
Action Mailer
</p>
</li>
<li>
<p>
Active Resource
</p>
</li>
<li>
<p>
Railties
</p>
</li>
<li>
<p>
Active Support
</p>
</li>
</ul></div>
<h4 id="_action_controller">2.2.1. Action Controller</h4>
<div class="paragraph"><p>Moduł Action Controller jest komponentem zarządzającym kontrolerami.
Action Controller przetwarza przychodzące zapytania, wydobywa z
nich parametry i wysyła je do odpowiedniej akcji. Usługi świadczone przez Action
Controller obejmują zarządzanie sesją, renderowanie widoków i zarządzanie
przekierowaniami.</p></div>
<h4 id="_action_view">2.2.2. Action View</h4>
<div class="paragraph"><p>Moduł Action View zarządza widokami. Może domyślnie tworzyć zarówno
widok HTML jak i XML. Action View zarządza renderowaniem szablonów (w tym szablonami
zagnieżdżonymi oraz podszablonami) i dostarcza wsparcie dla AJAXa.</p></div>
<h4 id="_active_record">2.2.3. Active Record</h4>
<div class="paragraph"><p>Moduł Active Record jest podstawowym elementem warstwy modelu. Zapewnia
niezależność od bazy danych, dostarcza podstawowe funkcjonalności CRUD (create, read, update and
delete - utwórz, odczytaj, aktualizuj, usuń), zaawansowane możliwości
wyszukiwania i zdolność do wiązania modeli a także wiele innych usług.</p></div>
<h4 id="_action_mailer">2.2.4. Action Mailer</h4>
<div class="paragraph"><p>Moduł Action Mailer służ do tworzenia usług e-mail. Action Mailer może być używany do
wysyłania e-maili w oparciu o elastyczne szablony lub do odbioru i przetwarzania przychodzących wiadomości.</p></div>
<h4 id="_active_resource">2.2.5. Active Resource</h4>
<div class="paragraph"><p>Moduł Active Resource pozwala na zarządzanie powiązaniami pomiędzy obiektami
biznesowymi oraz internetowymi serwisami RESTful. Implementuje mapowanie
zasobów internetowych na obiekty lokalne w oparciu o semantykę CRUD.</p></div>
<h4 id="_railties">2.2.6. Railties</h4>
<div class="paragraph"><p>Moduł Railties jest rdzeniem kodu Rails, służącym do tworzenia nowych aplikacje i
łączenia w nich poszczególnych elementów frameworku.</p></div>
<h4 id="_active_support">2.2.7. Active Support</h4>
<div class="paragraph"><p>Moduł Active Support jest obszernym zbiorem użytecznych klas oraz rozszerzeń
standardowych bibliotek języka Ruby, które są wykorzystywane w Railsach,
zarówno przez rdzeń kodu, jak i Twoją aplikację.</p></div>
<h3 id="_rest">2.3. REST</h3>
<div class="paragraph"><p>Praca doktorska Roya Fieldinga
<a href="http://www.ics.uci.edu/~fielding/pubs/dissertation/top.htm">Architectural Styles and the Design of Network-based Software Architectures</a>
jest powszechnie uznawana za fundament architektury RESTful. Na
szczęście, nie musisz czytać tego dokumentu w całości, aby zrozumieć, jak działa REST w Rails.
REST (Representational State Transfer) jest stylem architektury oprogramowania
sprowadzającym się do dwóch podstawowych zasad:</p></div>
<div class="ulist"><ul>
<li>
<p>
Korzystanie z identyfikatorów zasobów (które na potrzeby tego przewodnika
  możesz traktować jako adresy URL) do reprezentowania zasobów.
</p>
</li>
<li>
<p>
Przesyłanie reprezentacji stanu zasobów pomiędzy elementami systemu.
</p>
</li>
</ul></div>
<div class="paragraph"><p>Na przykład, dla aplikacja Railsowej następujące żądanie:</p></div>
<div class="paragraph"><p><tt>DELETE /photos/17</tt></p></div>
<div class="paragraph"><p>będzie rozumiane jako odnoszące się do zdjęcia o ID 17 oraz jako wskazanie żądanego
działania - usunięcie tego zasoby. REST jest naturalnym stylem architektury aplikacji
internetowych, który Railsy czynią jeszcze bardziej intuicyjnym, poprzez korzystanie z
konwencji, pozwalających na nieprzejmowanie się jego złożonością oraz różnicami pomiędzy przeglądarkami.</p></div>
<div class="paragraph"><p>Jeśli chciałbyś dowiedzieć się czegoś więcej na temat REST jako stylu architektonicznego,
polecam bardziej przystępne źródła od pracy Fieldinga:</p></div>
<div class="ulist"><ul>
<li>
<p>
<a href="http://www.infoq.com/articles/rest-introduction">Krótkie wprowadzenie do REST Stefana Tilkov</a>
</p>
</li>
<li>
<p>
<a href="http://bitworking.org/news/373/An-Introduction-to-REST">Wprowadzenie do REST - Joe Gregorio</a> (video)
</p>
</li>
<li>
<p>
<a href="http://en.wikipedia.org/wiki/Representational_State_Transfer">REST - artykuł w Wikipedii</a>
</p>
</li>
</ul></div>
</div>
<h2 id="_tworzenie_nowego_projektu_w_railsach">3. Tworzenie nowego projektu w Railsach</h2>
<div class="sectionbody">
<div class="paragraph"><p>Z pomocą tego przewodnika, będziesz mógł utworzyć projekt prostego bloga w
Railsach. Zanim przystąpisz do tworzenia aplikacji, upewnij się jednak, że masz zainstalowane Railsy.</p></div>
<h3 id="_instalacja_rodowiska_rails">3.1. Instalacja środowiska Rails</h3>
<div class="paragraph"><p>W większości przypadków, najprostszym sposobem zainstalowania Railsów jest skorzystania z RubyGems:</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 2.11
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt>$ gem install rails</tt></pre></div></div>
<div class="admonitionblock">
<table><tr>
<td class="icon">
<img src="./images/icons/note.png" alt="Note" />
</td>
<td class="content">Istnieją pewne szczególne okoliczności, w których można zastosować alternatywną strategię instalacji:</td>
</tr></table>
</div>
<div class="ulist"><ul>
<li>
<p>
Jeśli pracujesz w systemie Windows, będzie Ci łatwiej zainstalować
  <a href="http://instantrails.rubyforge.org/wiki/wiki.pl">Instant Rails</a>. Pamiętaj jednak, że
  Instant Rails rzadko zawierają aktualną wersją Railsów. Ponadto, Windowsowa wersja Railsów
  jest ogólnie mniej przyjazna w użytkowaniu niż te przeznaczone dla innych
  systemów operacyjnych. Jeśli to możliwe, polecamy korzystanie z Linuksowej maszyny wirtualnej.
</p>
</li>
<li>
<p>
Jeżeli chcesz być na bieżąco z najnowszymi zmianami w środowisku Rails,
  proponujemy skopiowanie kodu źródłowego z
  <a href="http://github.com/rails/rails/tree/master">githuba</a>, aczkolwiek nie jest
  to opcja zalecana dla początkujących.
</p>
</li>
</ul></div>
<h3 id="_tworzenie_bloga">3.2. Tworzenie bloga</h3>
<div class="paragraph"><p>Otwórz terminal i przejdź do folderu, w którym posiadasz odpowiednie uprawnienia do
tworzenia plików, a następnie wpisz polecenie:</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 2.11
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt>$ rails blog</tt></pre></div></div>
<div class="paragraph"><p>To stworzy Railsową aplikację, która korzysta z bazy danych SQLite. Jeśli wolisz
korzystać z MySQL, wywołaj zamiast niego polecenie:</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 2.11
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt>$ rails blog -d mysql</tt></pre></div></div>
<div class="paragraph"><p>A jeśli używasz PostgreSQL do przechowywania danych, zastosuj polecenie:</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 2.11
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt>$ rails blog -d postgresql</tt></pre></div></div>
<div class="admonitionblock">
<table><tr>
<td class="icon">
<img src="./images/icons/note.png" alt="Note" />
</td>
<td class="content">Uruchamiając <tt>rails -h</tt> możesz zobaczyć wszystkie akceptowane opcje.</td>
</tr></table>
</div>
<div class="paragraph"><p>Po utworzeniu aplikacji, aby móc kontynuować pracę, przejdź do odpowiedniego folderu:</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 2.11
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt>$ cd blog</tt></pre></div></div>
<div class="paragraph"><p>Railsy utworzą folder o nazwie <tt>blog</tt> w katalogu roboczym. Otwórz ten
folder i przyjrzyj się jego zawartości. Podczas pracy z tym przewodnikiem, w
większości będziemy korzystać z folderu <tt>app/</tt>, ale poniżej możesz zapoznać
się z podstawowymi funkcjami katalogów i plików, które domyślnie utworzą Railsy.</p></div>
<div class="tableblock">
<table rules="all"
width="100%"
frame="border"
cellspacing="0" cellpadding="4">
<col width="50%" />
<col width="50%" />
<thead valign="top">
<tr>
<th align="left">File/Folder </th>
<th align="left">Purpose</th>
</tr>
</thead>
<tbody valign="top">
<tr>
<td align="left"><p class="table"><tt>README</tt></p></td>
<td align="left"><p class="table">Jest to krótka instrukcja dla danej aplikacji. Za jej pomocą możesz poinformować innych o tym, jak działa Twoja aplikacja i jak ją można uruchomić.</p></td>
</tr>
<tr>
<td align="left"><p class="table"><tt>Rakefile</tt></p></td>
<td align="left"><p class="table">Plik ten zawiera listę zadań, które można uruchomić w linii poleceń.</p></td>
</tr>
<tr>
<td align="left"><p class="table"><tt>app/</tt></p></td>
<td align="left"><p class="table">Folder zawiera kontrolery, modele i widoki dla danej aplikacji. Na tym folderze będziemy koncentrować się w dalszej części tego przewodnika.</p></td>
</tr>
<tr>
<td align="left"><p class="table"><tt>config/</tt></p></td>
<td align="left"><p class="table">Folder zawierający pliki konfiguracyjne aplikacji, obejmujące zmienne czasu uruchomienia, konfigurację bazę danych, ścieżki dostępu etc.</p></td>
</tr>
<tr>
<td align="left"><p class="table"><tt>db/</tt></p></td>
<td align="left"><p class="table">Pokazuje aktualny schemat bazy danych, jak również jego migracje (o których niedługo będziesz się uczyć).</p></td>
</tr>
<tr>
<td align="left"><p class="table"><tt>doc/</tt></p></td>
<td align="left"><p class="table">Dokumentacja aplikacji.</p></td>
</tr>
<tr>
<td align="left"><p class="table"><tt>lib/</tt></p></td>
<td align="left"><p class="table">Dodatkowe moduły aplikacji (nieuwzględnione w tym przewodniku).</p></td>
</tr>
<tr>
<td align="left"><p class="table"><tt>log/</tt></p></td>
<td align="left"><p class="table">Logi aplikacji.</p></td>
</tr>
<tr>
<td align="left"><p class="table"><tt>public/</tt></p></td>
<td align="left"><p class="table">Jedyny całkowicie dostępny publicznie folder. Zawiera wszelkie zdjęcia, JavaScript, arkusze stylów (CSS) i inne statyczne pliki.</p></td>
</tr>
<tr>
<td align="left"><p class="table"><tt>script/</tt></p></td>
<td align="left"><p class="table">Skrypty dostarczone przez Rails w celu uproszczenia powtarzających się zadań, takich jak benchmarking, instalowanie wtyczek (plugin) i uruchamianiu konsoli lub serwera WWW</p></td>
</tr>
<tr>
<td align="left"><p class="table"><tt>test/</tt></p></td>
<td align="left"><p class="table">Testy jednostkowe, tak zwane "fixtures" oraz inne narzędzia służące do przeprowadzania testów.  Są one opisane w: <a href="/testing_rails_applications.html">Testowanie aplikacji Rails</a></p></td>
</tr>
<tr>
<td align="left"><p class="table"><tt>tmp/</tt></p></td>
<td align="left"><p class="table">Pliki tymczasowe</p></td>
</tr>
<tr>
<td align="left"><p class="table"><tt>vendor/</tt></p></td>
<td align="left"><p class="table">Miejsce na kod, którego sami nie napisaliśmy, ale chcemy wykorzystać. W standardowej aplikacji Rails mogą znaleźć się tutaj Ruby Gems, kod źródłowy Railsów (jeśli zainstalujesz go w swoim projekcie) i wszystkie dodatkowe wtyczki z gotowym kodem.</p></td>
</tr>
</tbody>
</table>
</div>
<h3 id="_konfiguracja_bazy_danych">3.3. Konfiguracja bazy danych</h3>
<div class="paragraph"><p>Prawie każda aplikacja Railsowa korzysta z bazy danych. Rodzaj baza danych, której
używamy, jest określony w pliku konfiguracyjnym <tt>config/database.yml</tt>.
Jeśli otworzysz ten plik w nowej aplikacji Railsowej, zostanie wyświetlona
domyślna konfiguracja bazy danych SQLite. Plik zawiera sekcje dla trzech
różnych środowisk, w których Railsy mogą być domyślnie uruchomione:</p></div>
<div class="ulist"><ul>
<li>
<p>
środowisko <tt>development</tt> (rozwojowe) jest używane na komputerze programisty, aby mógł
  oglądać bezpośrednio rezultaty wprowadzanych zmian
</p>
</li>
<li>
<p>
środowisko <tt>test</tt> (testowe) służy do uruchamiania automatycznych testów
</p>
</li>
<li>
<p>
środowisko <tt>production</tt> (produkcyjne) jest używane kiedy aplikacja uruchomiona jest na
  serwerze produkcyjnym
</p>
</li>
</ul></div>
<h4 id="_konfiguracja_bazy_danych_sqlite">3.3.1. Konfiguracja bazy danych SQLite</h4>
<div class="paragraph"><p>Railsy mają wbudowaną obsługę <a href="http://www.sqlite.org/">SQLite</a>, który jest
lekkim, pozbawionym serwera systemem zarządzania bazą danych.
Mimo możliwości przeciążenia SQLite&#8217;a w środowisku produkcyjne, działa on
zadowalająco podczas pisania programu oraz testów. Railsy domyślnie używają SQLite
przy tworzeniu nowego projektu, ale zawsze można to zmienić.</p></div>
<div class="paragraph"><p>Poniżej znajduje się część domyślnej konfiguracji pliku z ustawieniami dla środowiska rozwojowego:</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 2.11
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt>development<span style="color: #990000">:</span>
  adapter<span style="color: #990000">:</span> sqlite3
  database<span style="color: #990000">:</span> db<span style="color: #990000">/</span>development<span style="color: #990000">.</span>sqlite3
  timeout<span style="color: #990000">:</span> <span style="color: #993399">5000</span></tt></pre></div></div>
<div class="paragraph"><p>Jeśli nie masz żadnej zainstalowanej bazy danych, najłatwiej będzie Ci
skorzystać z SQLite&#8217;a, w czym mogą być pomocne Ruby Gems (posiadacze Maca z OS
X w wersji 10.5 lub nowszej mają go zainstalowanego domyślnie):</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 2.11
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt>$ gem install sqlite3-ruby</tt></pre></div></div>
<h4 id="_konfiguracja_bazy_danych_mysql">3.3.2. Konfiguracja bazy danych MySQL</h4>
<div class="paragraph"><p>Jeżeli zdecydujesz się na używanie bazy danych MySQL, Twój plik <tt>config/database.yml</tt> będzie wyglądał trochę inaczej:</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 2.11
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt>development<span style="color: #990000">:</span>
  adapter<span style="color: #990000">:</span> mysql
  encoding<span style="color: #990000">:</span> utf8
  database<span style="color: #990000">:</span> blog_development
  username<span style="color: #990000">:</span> root
  password<span style="color: #990000">:</span>
  socket<span style="color: #990000">:</span> <span style="color: #FF6600">/tmp/</span>mysql<span style="color: #990000">.</span>sock</tt></pre></div></div>
<div class="paragraph"><p>Ta konfiguracja powinna działać bez problemu, jeśli Twoja instalacja MySQLa nie ma wprowadzonego hasła dla super-użytkownika (root user). Jeśli jednak jest inaczej, koniecznie zmień nazwę użytkownika oraz hasło w powyższym kodzie.</p></div>
<h4 id="_konfiguracja_bazy_danych_postgresql">3.3.3. Konfiguracja Bazy Danych PostgreSQL</h4>
<div class="paragraph"><p>Używając PostgreSQL Twój plik <tt>config/database.yml</tt> powinien zostać zmodyfikowany do pracy z tą bazą danych:</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 2.11
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt>development<span style="color: #990000">:</span>
  adapter<span style="color: #990000">:</span> postgresql
  encoding<span style="color: #990000">:</span> unicode
  database<span style="color: #990000">:</span> blog_development
  username<span style="color: #990000">:</span> blog
  password<span style="color: #990000">:</span></tt></pre></div></div>
<div class="paragraph"><p>Konieczna jest zmiana nazwy użytkownika oraz hasła w konfiguracji środowiska
rozwojowego.</p></div>
<h4 id="_tworzenie_bazy_danych">3.3.4. Tworzenie Bazy Danych</h4>
<div class="paragraph"><p>Teraz, gdy masz już skonfigurowaną bazę danych, czas by Railsy stworzyły dla ciebie pustą bazę danych. Możesz to zrobić uruchamiając komendę <tt>rake</tt>:</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 2.11
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt>$ rake db<span style="color: #990000">:</span>create</tt></pre></div></div>
<div class="admonitionblock">
<table><tr>
<td class="icon">
<img src="./images/icons/note.png" alt="Note" />
</td>
<td class="content">Rake jest poleceniem ogólnego zastosowania, które Railsy
używają do wielu rzeczy. By zobaczyć listę dostępnych komend uruchom <tt>rake -T</tt>.</td>
</tr></table>
</div>
</div>
<h2 id="_witajcie_railsy">4. Witajcie Railsy!</h2>
<div class="sectionbody">
<div class="paragraph"><p>Jednym z tradycyjnych sposobów uczenia się nowego języka jest pobieżne przeglądnięcie jego tekstu. By tak zrobić w Railsach, konieczne jest stworzenie przynajmniej kontrolera oraz widoku. Na szczęście możesz to zrobić używając pojedynczej komendy, wpisując ją do terminala:</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 2.11
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt>$ script/generate controller home index</tt></pre></div></div>
<div class="admonitionblock">
<table><tr>
<td class="icon">
<img src="./images/icons/tip.png" alt="Tip" />
</td>
<td class="content">Jeżeli używasz systemu Windows lub gdy twój Ruby jest skonfigurowany w
niestandardowy sposób, możliwe że będziesz musiał przekazać komendę <tt>script</tt>
bezpośrednio do Ruby&#8217;ego: <tt>ruby script/generate controller home index</tt>.</td>
</tr></table>
</div>
<div class="paragraph"><p>Railsy stworzyły dla Ciebie kilka plików, włączając w to <tt>app/views/home/index.html.erb</tt>
- szablon, który będzie używany do pokazywania efektów akcji <tt>index</tt> w
kontrolerze <tt>home</tt>. Otwórz ten plik w edytorze tekstów i dopisz do niego tę
pojedynczą linijkę kodu:</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 2.11
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="font-weight: bold"><span style="color: #0000FF">&lt;h1&gt;</span></span>Hello, Rails!<span style="font-weight: bold"><span style="color: #0000FF">&lt;/h1&gt;</span></span></tt></pre></div></div>
<h3 id="_uruchamianie_serwera_www">4.1. Uruchamianie serwera WWW</h3>
<div class="paragraph"><p>Teraz, za pomocą jedynie dwóch komend, masz gotowy i działający Railsowy program!
Będziesz mógł go zobaczyć w przeglądarce uruchamiając go za pomocą komendy:</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 2.11
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt>$ script/server</tt></pre></div></div>
<div class="paragraph"><p>Domyślnie spowoduje to odpalenie instancji serwera aplikacyjnego Mongrel
(Railsy mogą wykorzystywać kilka innych serwerów aplikacji). By zobaczyć jak działa Twój
program, otwórz okno przeglądarki i przejdź pod adres <tt>http://localhost:3000</tt>. Powinieneś
zobaczyć domyślną stronę informacyjną:</p></div>
<div class="paragraph"><p><span class="image">
<img src="./images/rails_welcome.png" alt="Welcome Aboard screenshot" title="Welcome Aboard screenshot" />
</span></p></div>
<div class="admonitionblock">
<table><tr>
<td class="icon">
<img src="./images/icons/tip.png" alt="Tip" />
</td>
<td class="content">By zatrzymać serwer WWW naciśnij Ctrl+C w oknie terminala podczas jego działania.
Generalnie Railsy działające w trybie rozwojowym, po wprowadzeniu zmian w
Twoich plikach, nie wymagają zatrzymywania serwera - zostaną one automatycznie
zauważone przez serwer.</td>
</tr></table>
</div>
<div class="paragraph"><p>Ekran powitalny jest pierwszym testem dla nowego programu napisanego w Railsach - upewnia
nas, że oprogramowanie którym dysponujemy, jest poprawnie skonfigurowane.
Aby zobaczyć nowoutworzoną stronę, przejdź pod adres <tt>http://localhost:3000/home/index</tt>.</p></div>
<h3 id="_konfiguracja_strony_domowej_programu">4.2. Konfiguracja strony domowej programu</h3>
<div class="paragraph"><p>Prawdopodobnie chcesz zamienić domyślną stronę startową ze stroną Twojego programu.
Pierwszym krokiem jest wykasowanie z katalogu <tt>public</tt> strony domyślnej:</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 2.11
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt>$ rm public/index<span style="color: #990000">.</span>html</tt></pre></div></div>
<div class="paragraph"><p>Powinieneś teraz wskazać Railsom gdzie jest zlokalizowana Twoja strona domowa.
Otwórz plik <tt>config/routes.rb</tt> w edytorze -  jest to plik <em>routingu</em>.
Zawiera wpisy w specjalnym DSLu (Domain Specific Language - specyficzny język
domenowy), które pokazują Railsom w jaki sposób przekształcić adres
wprowadzony w przeglądarce na odpowiednie akcje kontrolerów. Na dole tego pliku
znajdują się dwie domyślne <em>drogi</em>:</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 2.11
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt>map<span style="color: #990000">.</span>connect <span style="color: #FF0000">':controller/:action/:id'</span>
map<span style="color: #990000">.</span>connect <span style="color: #FF0000">':controller/:action/:id.:format'</span></tt></pre></div></div>
<div class="paragraph"><p>Domyślne drogi obsługują proste żądania, takie jak <tt>/home/index</tt>: Railsy
tłumaczą je na wywołanie akcji <tt>index</tt> w kontrolerze <tt>home</tt>. Kolejny przykład,
<tt>/posts/edit/1</tt> uruchomi akcję <tt>edit</tt> w kontrolerze <tt>posts</tt> z parametrem <tt>id</tt> równym 1.</p></div>
<div class="paragraph"><p>By połączyć Twoją stronę domową, musisz dodać jeden wpis do pliku routingu,
powyżej drogi domyślnej:</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 2.11
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt>map<span style="color: #990000">.</span>root <span style="color: #990000">:</span>controller <span style="color: #990000">=&gt;</span> <span style="color: #FF0000">"home"</span></tt></pre></div></div>
<div class="paragraph"><p>Ta linijka ilustruje jeden mały kawałek podejścia "konwencja ponad
konfiguracją": jeżeli nie podasz żadnej akcji, Railsy uruchomią domyślnie akcję <tt>index</tt>.</p></div>
<div class="paragraph"><p>Po przejściu do strony <tt>http://localhost:3000</tt> , zobaczysz widok <tt>home/index</tt> .</p></div>
<div class="admonitionblock">
<table><tr>
<td class="icon">
<img src="./images/icons/note.png" alt="Note" />
</td>
<td class="content">Więcej informacji na temat routingu znajdziesz w przewodniku
<a href="routing_outside_in.html">Routing w Railsach</a>.</td>
</tr></table>
</div>
</div>
<h2 id="_szybki_start_dzi_ki_rusztowaniu">5. Szybki start dzięki rusztowaniu.</h2>
<div class="sectionbody">
<div class="paragraph"><p>Railsowe rusztowanie (<em>scaffolding</em>) jest szybkim sposobem na napisanie znacznej części
programu. Jeśli chcesz stworzyć modele, widoki i kontrolery dla nowych zasobów w
pojedynczej operacji, to jest to odpowiednie narzędzie dla Ciebie.</p></div>
</div>
<h2 id="_tworzenie_zasobu">6. Tworzenie zasobu</h2>
<div class="sectionbody">
<div class="paragraph"><p>W przypadku programów takich jak blog, możesz zacząć od stworzenia zasobu
<tt>Post</tt> z rusztowaniem, który będzie reprezentował pojedynczy wpis w blogu. Aby to zrobić,
wprowadź następującą komendę w terminalu:</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 2.11
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt>$ script/generate scaffold Post name<span style="color: #990000">:</span>string title<span style="color: #990000">:</span>string content<span style="color: #990000">:</span>text</tt></pre></div></div>
<div class="admonitionblock">
<table><tr>
<td class="icon">
<img src="./images/icons/note.png" alt="Note" />
</td>
<td class="content">Chociaż rusztowanie pozwoli Ci szybko rozpocząć pisanie programu, ten uniwersalny
kod raczej nie będzie idealnie pasować do Twojej aplikacji. W większości przypadków
będziesz musiał samodzielnie dokonać w nim zmian. Wielu doświadczonych programistów
Rails unika używania rusztowań na rzecz pisania większości kodu źródłowego od podstaw,
bez używania gotowych wzorców.</td>
</tr></table>
</div>
<div class="paragraph"><p>Generator rusztowania utworzy w Twoim programie 14 plików, wspólnie z paroma folderami
i jeden dodatkowo zmodyfikuje. Oto krótki przegląd tego co tworzy powyższa
komenda:</p></div>
<div class="tableblock">
<table rules="all"
width="100%"
frame="border"
cellspacing="0" cellpadding="4">
<col width="50%" />
<col width="50%" />
<thead valign="top">
<tr>
<th align="left">File                                          </th>
<th align="left">Purpose</th>
</tr>
</thead>
<tbody valign="top">
<tr>
<td align="left"><p class="table">app/models/post.rb</p></td>
<td align="left"><p class="table">Model dla posta</p></td>
</tr>
<tr>
<td align="left"><p class="table">db/migrate/20081013124235_create_posts.rb</p></td>
<td align="left"><p class="table">Migracja do tworzenia tabeli postów w bazie danych (nazwa która pojawi się u Ciebie będzie zawierała inny znacznik czasowy)</p></td>
</tr>
<tr>
<td align="left"><p class="table">app/views/posts/index.html.erb</p></td>
<td align="left"><p class="table">Widok indeksu wszystkich postów</p></td>
</tr>
<tr>
<td align="left"><p class="table">app/views/posts/show.html.erb</p></td>
<td align="left"><p class="table">Widok pojedynczego posta</p></td>
</tr>
<tr>
<td align="left"><p class="table">app/views/posts/new.html.erb</p></td>
<td align="left"><p class="table">Widok tworzenia nowego posta</p></td>
</tr>
<tr>
<td align="left"><p class="table">app/views/posts/edit.html.erb</p></td>
<td align="left"><p class="table">Widok edycji posta</p></td>
</tr>
<tr>
<td align="left"><p class="table">app/views/layouts/posts.html.erb</p></td>
<td align="left"><p class="table">Widok określający całościowy wygląd i działanie innych widoków dla postów</p></td>
</tr>
<tr>
<td align="left"><p class="table">public/stylesheets/scaffold.css</p></td>
<td align="left"><p class="table">Arkusz stylów poprawiający wygląd widoków w rusztowaniu</p></td>
</tr>
<tr>
<td align="left"><p class="table">app/controllers/posts_controller.rb</p></td>
<td align="left"><p class="table">Kontroler postów</p></td>
</tr>
<tr>
<td align="left"><p class="table">test/functional/posts_controller_test.rb</p></td>
<td align="left"><p class="table">Testy funkcjonalności dla kontrolera postów</p></td>
</tr>
<tr>
<td align="left"><p class="table">app/helpers/posts_helper.rb</p></td>
<td align="left"><p class="table">Helpery używane w widokach postów</p></td>
</tr>
<tr>
<td align="left"><p class="table">config/routes.rb</p></td>
<td align="left"><p class="table">Modyfikacja polegająca na uwzględnieniu postów w routingu</p></td>
</tr>
<tr>
<td align="left"><p class="table">test/fixtures/posts.yml</p></td>
<td align="left"><p class="table">Posty testowe</p></td>
</tr>
<tr>
<td align="left"><p class="table">test/unit/post_test.rb</p></td>
<td align="left"><p class="table">Testy jednostkowe dla modelu postów</p></td>
</tr>
<tr>
<td align="left"><p class="table">test/unit/helpers/posts_helper_test.rb</p></td>
<td align="left"><p class="table">Testy jednostkowe dla helpera dla postów</p></td>
</tr>
</tbody>
</table>
</div>
<h3 id="_uruchamianie_migracji">6.1. Uruchamianie Migracji</h3>
<div class="paragraph"><p>Jednym z produktów komendy: <tt>script/generate scaffold</tt> jest migracja bazy danych.
Migracje są klasami Rubiego, które upraszczają tworzenie i modyfikowanie tabel baz danych.
Railsy używają komend rake&#8217;a do uruchamiania migracji i pozwalają na
wycofywanie ich po tym, jak zostały zaaplikowane w bazie danych. Nazwy plików migracji
zawierają znaczniki czasowe, by zapewnić ich przetwarzanie w porządku, w jakim zostały utworzone.</p></div>
<div class="paragraph"><p>Gdy zajrzysz do pliku <tt>db/migrate/20090113124235_create_posts.rb</tt> (jego nazwa
może się u Ciebie trochę różnić), zobaczysz następującą zawartość:</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 2.11
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="font-weight: bold"><span style="color: #0000FF">class</span></span> CreatePosts <span style="color: #990000">&lt;</span> ActiveRecord<span style="color: #990000">::</span>Migration
  <span style="font-weight: bold"><span style="color: #0000FF">def</span></span> <span style="font-weight: bold"><span style="color: #0000FF">self</span></span><span style="color: #990000">.</span>up
    create_table <span style="color: #990000">:</span>posts <span style="font-weight: bold"><span style="color: #0000FF">do</span></span> <span style="color: #990000">|</span>t<span style="color: #990000">|</span>
      t<span style="color: #990000">.</span>string <span style="color: #990000">:</span>name
      t<span style="color: #990000">.</span>string <span style="color: #990000">:</span>title
      t<span style="color: #990000">.</span>text <span style="color: #990000">:</span>content

      t<span style="color: #990000">.</span>timestamps
    <span style="font-weight: bold"><span style="color: #0000FF">end</span></span>
  <span style="font-weight: bold"><span style="color: #0000FF">end</span></span>

  <span style="font-weight: bold"><span style="color: #0000FF">def</span></span> <span style="font-weight: bold"><span style="color: #0000FF">self</span></span><span style="color: #990000">.</span>down
    drop_table <span style="color: #990000">:</span>posts
  <span style="font-weight: bold"><span style="color: #0000FF">end</span></span>
<span style="font-weight: bold"><span style="color: #0000FF">end</span></span></tt></pre></div></div>
<div class="paragraph"><p>Gdybyś chciał ująć ten kod w słowa, brzmiałby on mniej więcej tak: gdy migracja
jest uruchomiona, tworzy tabelę o nazwie <tt>posts</tt> z dwoma kolumnami
zawierającymi łańcuchy znaków (<tt>name</tt> i <tt>title</tt>) i jedną kolumną tekstową (<tt>content</tt>), a wraz z nimi
kolumny znaczników czasu, by śledzić czas jej utworzenia oraz ostatniej
aktualizacji. Więcej szczegółów na temat sposobu pisania migracji
znajdziesz w przewodniku <a href="migrations.html">Migracje</a>.</p></div>
<div class="paragraph"><p>Teraz możesz użyć komendy <tt>rake</tt> by wprowadzić migracje do bazy danych:</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 2.11
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt>$ rake db<span style="color: #990000">:</span>create
$ rake db<span style="color: #990000">:</span>migrate</tt></pre></div></div>
<div class="admonitionblock">
<table><tr>
<td class="icon">
<img src="./images/icons/note.png" alt="Note" />
</td>
<td class="content">Ponieważ domyślnie pracujesz w środowisku rozwojowym, ta komenda wykona się na bazie danych zdefiniowanej w sekcji <tt>development</tt> pliku: <tt>config/database.yml</tt>.</td>
</tr></table>
</div>
<h3 id="_dodawanie_hiper_cza">6.2. Dodawanie hiperłącza</h3>
<div class="paragraph"><p>By połączyć posty ze stroną domową, którą już stworzyłeś, możesz dodać do niej hiperłącze.
Otwórz plik <tt>/app/views/home/index.html.erb</tt> i dopisz do niego:</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 2.11
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="color: #FF0000">&lt;h1&gt;</span>Hello<span style="color: #990000">,</span> Rails!<span style="color: #FF0000">&lt;/h1&gt;</span>

<span style="color: #FF0000">&lt;%= link_to "My Blog", posts_path %&gt;</span></tt></pre></div></div>
<div class="paragraph"><p>Metoda <tt>link_to</tt> jest jednym z wbudowanych helperów dla widoków. Tworzy
ona link z tekstem do wyświetlenia oraz informacją, gdzie prowadzi – w tym wypadku
ze ścieżką do posta.</p></div>
<h3 id="_praca_z_postami_w_przegl_darce">6.3. Praca z postami w przeglądarce</h3>
<div class="paragraph"><p>Teraz jesteś już gotowy do pracy z postami. Na początek przejdź do:
<tt>http://localhost:3000</tt> i kliknij w link <tt>My Blog</tt>.</p></div>
<div class="paragraph"><p><span class="image">
<img src="./images/posts_index.png" alt="Posts Index screenshot" title="Posts Index screenshot" />
</span></p></div>
<div class="paragraph"><p>Jest to rezultat renderowania  Twoich postów z użyciem widoku <tt>index</tt>. Aktualnie nie ma żadnych
wpisów w bazie danych, ale zawsze możesz je utworzyć klikając w link <tt>New Post</tt>.
Możesz również przeglądać i edytować posty, a nawet je wykasować. Cały logika i
HTML stworzone były za pomocą pojedynczego polecenia <tt>script/generate scaffold</tt>.</p></div>
<div class="admonitionblock">
<table><tr>
<td class="icon">
<img src="./images/icons/tip.png" alt="Tip" />
</td>
<td class="content">W  środowisku rozwojowym (na nim domyślnie pracujesz) z każdym żądaniem
przeglądarki Railsy wgrywają od nowa program, dzięki czemu nie jest konieczne
restartowanie serwera WWW.</td>
</tr></table>
</div>
<div class="paragraph"><p>Gratulacje! Napisałeś swoją pierwszą aplikację w Railsach! Nadszedł czas, aby przyjrzeć się efektom pracy.</p></div>
<h3 id="_model">6.4. Model</h3>
<div class="paragraph"><p>Zawartość pliku modelu <tt>app/models/post.rb</tt> jest niemal tak samo prosta jak
jego utworzenie:</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 2.11
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="font-weight: bold"><span style="color: #0000FF">class</span></span> Post <span style="color: #990000">&lt;</span> ActiveRecord<span style="color: #990000">::</span>Base
<span style="font-weight: bold"><span style="color: #0000FF">end</span></span></tt></pre></div></div>
<div class="paragraph"><p>Nie zawiera on zbyt wiele treści – zauważ jednak że klasa <tt>Post</tt>
dziedziczy z <tt>ActiveRecord::Base</tt>. Moduł Active Record za darmo dostarcza wielu funkcji dla
Twoich modeli, włączając w to podstawowe operacje na danych CRUD (create, read,
update, delete) czy weryfikowanie danych, jak również wsparcie dla
zaawansowanego wyszukiwania i zdolność do wiązania  ze sobą wielu różnych
modeli.</p></div>
<h3 id="_sprawdzanie_poprawno_ci_danych">6.5. Sprawdzanie poprawności danych</h3>
<div class="paragraph"><p>Railsy są wyposażone w metody, które pomogą Ci sprawdzić poprawność danych wysyłanych do
modeli. Wprowadź poniższe zmiany do pliku: <tt>app/models/post.rb</tt></p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 2.11
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="font-weight: bold"><span style="color: #0000FF">class</span></span> Post <span style="color: #990000">&lt;</span> ActiveRecord<span style="color: #990000">::</span>Base
  validates_presence_of <span style="color: #990000">:</span>name<span style="color: #990000">,</span> <span style="color: #990000">:</span>title
  validates_length_of <span style="color: #990000">:</span>title<span style="color: #990000">,</span> <span style="color: #990000">:</span>minimum <span style="color: #990000">=&gt;</span> <span style="color: #993399">5</span>
<span style="font-weight: bold"><span style="color: #0000FF">end</span></span></tt></pre></div></div>
<div class="paragraph"><p>Dzięki nim mamy pewność, że każdy post będzie mieć nazwę oraz tytuł, a ten ostatni nie
będzie miał mniej niż 5 znaków. Railsy mogą sprawdzać różne warunki w modelu, włączając
w to obecność lub unikalność kolumn, ich format i istnienie związanych z nimi obiektów.</p></div>
<h3 id="_u_ywanie_konsoli">6.6. Używanie konsoli</h3>
<div class="paragraph"><p>By zobaczyć, jak sprawdzanie poprawności danych działa w praktyce, użyjemy konsoli.
Konsola, będąca narzędziem linii poleceń, umożliwia Ci wykonywanie kodu
Rubiego w kontekście Twojej aplikacji:</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 2.11
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt>$ script/console</tt></pre></div></div>
<div class="paragraph"><p>Możesz jej użyć do pracy z modelami:</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 2.11
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="color: #990000">&gt;&gt;</span> p <span style="color: #990000">=</span> Post<span style="color: #990000">.</span>create<span style="color: #990000">(:</span>content <span style="color: #990000">=&gt;</span> <span style="color: #FF0000">"A new post"</span><span style="color: #990000">)</span>
<span style="color: #990000">=&gt;</span> <span style="font-style: italic"><span style="color: #9A1900">#&lt;Post id: nil, name: nil, title: nil, content: "A new post",</span></span>
created_at<span style="color: #990000">:</span> nil<span style="color: #990000">,</span> updated_at<span style="color: #990000">:</span> nil<span style="color: #990000">&gt;</span>
<span style="color: #990000">&gt;&gt;</span> p<span style="color: #990000">.</span>save
<span style="color: #990000">=&gt;</span> <span style="font-weight: bold"><span style="color: #0000FF">false</span></span>
<span style="color: #990000">&gt;&gt;</span> p<span style="color: #990000">.</span>errors
<span style="color: #990000">=&gt;</span> <span style="font-style: italic"><span style="color: #9A1900">#&lt;ActiveRecord::Errors:0x23bcf0c @base=#&lt;Post id: nil, name: nil,</span></span>
title<span style="color: #990000">:</span> nil<span style="color: #990000">,</span> content<span style="color: #990000">:</span> <span style="color: #FF0000">"A new post"</span><span style="color: #990000">,</span> created_at<span style="color: #990000">:</span> nil<span style="color: #990000">,</span> updated_at<span style="color: #990000">:</span> nil<span style="color: #990000">&gt;,</span>
@<span style="color: #009900">errors</span><span style="color: #990000">=</span>{<span style="color: #FF0000">"name"</span><span style="color: #990000">=&gt;[</span><span style="color: #FF0000">"can't be blank"</span><span style="color: #990000">],</span> <span style="color: #FF0000">"title"</span><span style="color: #990000">=&gt;[</span><span style="color: #FF0000">"can't be blank"</span><span style="color: #990000">,</span>
<span style="color: #FF0000">"is too short (minimum is 5 characters)"</span><span style="color: #990000">]</span>}<span style="color: #990000">&gt;</span></tt></pre></div></div>
<div class="paragraph"><p>Powyższy kod przedstawia informację, jaką otrzymasz, gdy chcesz utworzyć nowy, ale
błędny <tt>Post</tt>. Mechanizm jest następujący: przy próbie zapisania pojawia się wartość
zwrotna <tt>false</tt> (oznaczającą, że zapisanie się nie powiodło), a kod wyszczególnia nam
wszystkie znalezione błędy w postaci <tt>errors</tt>.</p></div>
<div class="admonitionblock">
<table><tr>
<td class="icon">
<img src="./images/icons/tip.png" alt="Tip" />
</td>
<td class="content">W przeciwieństwie do serwera WWW, konsola nie wczytuje automatycznie
zmian w Twoim kodzie. By wczytać wprowadzone zmiany z
poziomu konsoli, musisz użyć komendy <tt>reload!</tt></td>
</tr></table>
</div>
<h3 id="_wy_wietlanie_post_w">6.7. Wyświetlanie postów</h3>
<div class="paragraph"><p>Najłatwiejszym sposobem na zapoznanie się z funkcjonalnościami programu jest
przyjrzenie się kodowi, który wyświetla wszystkie posty. Otwórz plik:
<tt>app/controllers/posts_controller.rb</tt> i przyjrzyj się akcji <tt>index</tt></p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 2.11
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="font-weight: bold"><span style="color: #0000FF">def</span></span> index
  <span style="color: #009900">@posts</span> <span style="color: #990000">=</span> Post<span style="color: #990000">.</span>find<span style="color: #990000">(:</span>all<span style="color: #990000">)</span>

  respond_to <span style="font-weight: bold"><span style="color: #0000FF">do</span></span> <span style="color: #990000">|</span>format<span style="color: #990000">|</span>
    format<span style="color: #990000">.</span>html <span style="font-style: italic"><span style="color: #9A1900"># index.html.erb</span></span>
    format<span style="color: #990000">.</span>xml  <span style="color: #FF0000">{</span> render <span style="color: #990000">:</span>xml <span style="color: #990000">=&gt;</span> <span style="color: #009900">@posts</span> <span style="color: #FF0000">}</span>
  <span style="font-weight: bold"><span style="color: #0000FF">end</span></span>
<span style="font-weight: bold"><span style="color: #0000FF">end</span></span></tt></pre></div></div>
<div class="paragraph"><p>Powyższy kod przypisuje do zmiennej instancyjnej <tt>@posts</tt> tablicę wszystkich
postów z bazy danych. <tt>Post.find(:all)</tt> lub <tt>Post.all</tt> wywołuje metodę klasową
w modelu <tt>Post</tt>, która zwraca wszystkie posty z bazy danych, bez nakładania
żadnych warunków.</p></div>
<div class="admonitionblock">
<table><tr>
<td class="icon">
<img src="./images/icons/tip.png" alt="Tip" />
</td>
<td class="content">Więcej informacji na temat znajdowania rekordów za pomocą Active Record znajdziesz
w przewodniku <a href="finders.html">Zapytania w module Active Record</a></td>
</tr></table>
</div>
<div class="paragraph"><p>Blok <tt>respond_to</tt> obsługuje obydwa typy wywołań tej akcji - zarówno HTML jak i XML.
Jeśli przejdziesz pod adres <tt>http://localhost:3000/posts.xml</tt>, to zobaczysz wszystkie posty w
formacie XML. Natomiast format HTML poszukuje widoku w <tt>app/views/posts</tt>,
nazwanego tak samo jak odpowiadająca mu akcja. Railsy zaś przenoszą
wszystkie zmienne instancyjne (zaczynające się od znaku @) zainicjowane w akcji do widoku.
Oto zawartość <tt>app/view/posts/index.html.erb</tt>:</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 2.11
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="font-weight: bold"><span style="color: #0000FF">&lt;h1&gt;</span></span>Listing posts<span style="font-weight: bold"><span style="color: #0000FF">&lt;/h1&gt;</span></span>

<span style="font-weight: bold"><span style="color: #0000FF">&lt;table&gt;</span></span>
  <span style="font-weight: bold"><span style="color: #0000FF">&lt;tr&gt;</span></span>
    <span style="font-weight: bold"><span style="color: #0000FF">&lt;th&gt;</span></span>Name<span style="font-weight: bold"><span style="color: #0000FF">&lt;/th&gt;</span></span>
    <span style="font-weight: bold"><span style="color: #0000FF">&lt;th&gt;</span></span>Title<span style="font-weight: bold"><span style="color: #0000FF">&lt;/th&gt;</span></span>
    <span style="font-weight: bold"><span style="color: #0000FF">&lt;th&gt;</span></span>Content<span style="font-weight: bold"><span style="color: #0000FF">&lt;/th&gt;</span></span>
  <span style="font-weight: bold"><span style="color: #0000FF">&lt;/tr&gt;</span></span>

&lt;% for post in @posts %&gt;
  <span style="font-weight: bold"><span style="color: #0000FF">&lt;tr&gt;</span></span>
    <span style="font-weight: bold"><span style="color: #0000FF">&lt;td&gt;</span></span>&lt;%=h post.name %&gt;<span style="font-weight: bold"><span style="color: #0000FF">&lt;/td&gt;</span></span>
    <span style="font-weight: bold"><span style="color: #0000FF">&lt;td&gt;</span></span>&lt;%=h post.title %&gt;<span style="font-weight: bold"><span style="color: #0000FF">&lt;/td&gt;</span></span>
    <span style="font-weight: bold"><span style="color: #0000FF">&lt;td&gt;</span></span>&lt;%=h post.content %&gt;<span style="font-weight: bold"><span style="color: #0000FF">&lt;/td&gt;</span></span>
    <span style="font-weight: bold"><span style="color: #0000FF">&lt;td&gt;</span></span>&lt;%= link_to 'Show', post %&gt;<span style="font-weight: bold"><span style="color: #0000FF">&lt;/td&gt;</span></span>
    <span style="font-weight: bold"><span style="color: #0000FF">&lt;td&gt;</span></span>&lt;%= link_to 'Edit', edit_post_path(post) %&gt;<span style="font-weight: bold"><span style="color: #0000FF">&lt;/td&gt;</span></span>
    <span style="font-weight: bold"><span style="color: #0000FF">&lt;td&gt;</span></span>&lt;%= link_to 'Destroy', post, :confirm =&gt; 'Are you sure?', :method =&gt; :delete %&gt;<span style="font-weight: bold"><span style="color: #0000FF">&lt;/td&gt;</span></span>
  <span style="font-weight: bold"><span style="color: #0000FF">&lt;/tr&gt;</span></span>
&lt;% end %&gt;
<span style="font-weight: bold"><span style="color: #0000FF">&lt;/table&gt;</span></span>

<span style="font-weight: bold"><span style="color: #0000FF">&lt;br</span></span> <span style="font-weight: bold"><span style="color: #0000FF">/&gt;</span></span>

&lt;%= link_to 'New post', new_post_path %&gt;</tt></pre></div></div>
<div class="paragraph"><p>Widok iteruje po zawartości tablicy <tt>@posts</tt>, pokazując treść postów oraz
linki. Zwróć uwagę na następujące elementy:</p></div>
<div class="ulist"><ul>
<li>
<p>
<tt>h</tt> to helper, który oczyszcza wyświetlane dane, zapobiegający atakom typu "cross-site scripting"
</p>
</li>
<li>
<p>
<tt>link_to</tt> buduje link do określonej lokalizacji
</p>
</li>
<li>
<p>
<tt>edit_post_path</tt> jest helperem, który Railsy udostępniają w ramach routingu RESTful.
  Zobaczysz jeszcze sporo różnych rodzajów takich helperów dla wielu akcji z
  kontrolerów.
</p>
</li>
</ul></div>
<div class="admonitionblock">
<table><tr>
<td class="icon">
<img src="./images/icons/tip.png" alt="Tip" />
</td>
<td class="content">Więcej szczegółów na temat procesu renderowania znajdziesz w przewodniku
<a href="layouts_and_rendering.html">Layouty oraz renderowanie</a>.</td>
</tr></table>
</div>
<h3 id="_dostosowanie_layoutu">6.8. Dostosowanie layoutu</h3>
<div class="paragraph"><p>Przetwarzanie widoku stanowi tylko część złożonego procesu, którego efektem jest
utworzenie wynikowej strony HTML.
Railsy wyposażone są również w layouty, które stanowią pojemniki na widoki.
Renderowanie widoku odbywa się poprzez umieszczanie kodu HTML widoku
wewnątrz kodu HTML layoutu. Komenda <tt>script/generate scaffold</tt> automatycznie
utworzyła domyślny layout  dla postów: <tt>app/views/layouts/posts.html.erb</tt>.
Otwórz go w swoim edytorze i zmodyfikuj tag <tt>body</tt>:</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 2.11
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="font-weight: bold"><span style="color: #000080">&lt;!DOCTYPE</span></span> <span style="color: #009900">html</span> <span style="color: #009900">PUBLIC</span> <span style="color: #FF0000">"-//W3C//DTD XHTML 1.0 Transitional//EN"</span>
       <span style="color: #FF0000">"http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"</span><span style="font-weight: bold"><span style="color: #000080">&gt;</span></span>

<span style="font-weight: bold"><span style="color: #0000FF">&lt;html</span></span> <span style="color: #009900">xmlns</span><span style="color: #990000">=</span><span style="color: #FF0000">"http://www.w3.org/1999/xhtml"</span> <span style="color: #009900">xml:lang</span><span style="color: #990000">=</span><span style="color: #FF0000">"en"</span> <span style="color: #009900">lang</span><span style="color: #990000">=</span><span style="color: #FF0000">"en"</span><span style="font-weight: bold"><span style="color: #0000FF">&gt;</span></span>
<span style="font-weight: bold"><span style="color: #0000FF">&lt;head&gt;</span></span>
  <span style="font-weight: bold"><span style="color: #0000FF">&lt;meta</span></span> <span style="color: #009900">http-equiv</span><span style="color: #990000">=</span><span style="color: #FF0000">"content-type"</span> <span style="color: #009900">content</span><span style="color: #990000">=</span><span style="color: #FF0000">"text/html;charset=UTF-8"</span> <span style="font-weight: bold"><span style="color: #0000FF">/&gt;</span></span>
  <span style="font-weight: bold"><span style="color: #0000FF">&lt;title&gt;</span></span>Posts: &lt;%= controller.action_name %&gt;<span style="font-weight: bold"><span style="color: #0000FF">&lt;/title&gt;</span></span>
  &lt;%= stylesheet_link_tag 'scaffold' %&gt;
<span style="font-weight: bold"><span style="color: #0000FF">&lt;/head&gt;</span></span>
<span style="font-weight: bold"><span style="color: #0000FF">&lt;body</span></span> <span style="color: #009900">style</span><span style="color: #990000">=</span><span style="color: #FF0000">"background: #EEEEEE;"</span><span style="font-weight: bold"><span style="color: #0000FF">&gt;</span></span>

<span style="font-weight: bold"><span style="color: #0000FF">&lt;p</span></span> <span style="color: #009900">style</span><span style="color: #990000">=</span><span style="color: #FF0000">"color: green"</span><span style="font-weight: bold"><span style="color: #0000FF">&gt;</span></span>&lt;%= flash[:notice] %&gt;<span style="font-weight: bold"><span style="color: #0000FF">&lt;/p&gt;</span></span>

&lt;%= yield  %&gt;

<span style="font-weight: bold"><span style="color: #0000FF">&lt;/body&gt;</span></span>
<span style="font-weight: bold"><span style="color: #0000FF">&lt;/html&gt;</span></span></tt></pre></div></div>
<div class="paragraph"><p>Gdy teraz odświeżysz stronę <tt>/posts</tt>, zobaczysz szare tło.
Takie samo będzie używane dla wszystkich widoków postów.</p></div>
<h3 id="_tworzenie_nowego_posta">6.9. Tworzenie nowego posta</h3>
<div class="paragraph"><p>Nowy post tworzony jest za pomocą dwóch akcji. Pierwszą jest <tt>new</tt>,
która tworzy nowy, pusty obiekt <tt>Post</tt>:</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 2.11
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="font-weight: bold"><span style="color: #0000FF">def</span></span> new
  <span style="color: #009900">@post</span> <span style="color: #990000">=</span> Post<span style="color: #990000">.</span>new

  respond_to <span style="font-weight: bold"><span style="color: #0000FF">do</span></span> <span style="color: #990000">|</span>format<span style="color: #990000">|</span>
    format<span style="color: #990000">.</span>html <span style="font-style: italic"><span style="color: #9A1900"># new.html.erb</span></span>
    format<span style="color: #990000">.</span>xml  <span style="color: #FF0000">{</span> render <span style="color: #990000">:</span>xml <span style="color: #990000">=&gt;</span> <span style="color: #009900">@post</span> <span style="color: #FF0000">}</span>
  <span style="font-weight: bold"><span style="color: #0000FF">end</span></span>
<span style="font-weight: bold"><span style="color: #0000FF">end</span></span></tt></pre></div></div>
<div class="paragraph"><p>Widok <tt>new.html.erb</tt> wyświetli dla użytkownika pusty <tt>Post</tt>:</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 2.11
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="font-weight: bold"><span style="color: #0000FF">&lt;h1&gt;</span></span>New post<span style="font-weight: bold"><span style="color: #0000FF">&lt;/h1&gt;</span></span>

&lt;% form_for(@post) do |f| %&gt;
  &lt;%= f.error_messages %&gt;

  <span style="font-weight: bold"><span style="color: #0000FF">&lt;p&gt;</span></span>
    &lt;%= f.label :name %&gt;<span style="font-weight: bold"><span style="color: #0000FF">&lt;br</span></span> <span style="font-weight: bold"><span style="color: #0000FF">/&gt;</span></span>
    &lt;%= f.text_field :name %&gt;
  <span style="font-weight: bold"><span style="color: #0000FF">&lt;/p&gt;</span></span>
  <span style="font-weight: bold"><span style="color: #0000FF">&lt;p&gt;</span></span>
    &lt;%= f.label :title %&gt;<span style="font-weight: bold"><span style="color: #0000FF">&lt;br</span></span> <span style="font-weight: bold"><span style="color: #0000FF">/&gt;</span></span>
    &lt;%= f.text_field :title %&gt;
  <span style="font-weight: bold"><span style="color: #0000FF">&lt;/p&gt;</span></span>
  <span style="font-weight: bold"><span style="color: #0000FF">&lt;p&gt;</span></span>
    &lt;%= f.label :content %&gt;<span style="font-weight: bold"><span style="color: #0000FF">&lt;br</span></span> <span style="font-weight: bold"><span style="color: #0000FF">/&gt;</span></span>
    &lt;%= f.text_area :content %&gt;
  <span style="font-weight: bold"><span style="color: #0000FF">&lt;/p&gt;</span></span>
  <span style="font-weight: bold"><span style="color: #0000FF">&lt;p&gt;</span></span>
    &lt;%= f.submit "Create" %&gt;
  <span style="font-weight: bold"><span style="color: #0000FF">&lt;/p&gt;</span></span>
&lt;% end %&gt;

&lt;%= link_to 'Back', posts_path %&gt;</tt></pre></div></div>
<div class="paragraph"><p>Blok <tt>form_for</tt> jest używany do tworzenia formularzy HTML. Wewnątrz niego masz dostęp do
metod, które umożliwiają tworzenie różnorodnych kontrolek. Przykładowo:
<tt>f.text_field :name</tt> powoduje utworzenie w danym formularzu pola do wprowadzania
tekstu i wiąże je z atrybutem <tt>name</tt> wyświetlanego obiektu. Możesz użyć tej metody
tylko z atrybutami modelu, na podstawie którego tworzony jest formularz (w tym wypadku <tt>name</tt>,
<tt>title</tt> i <tt>content</tt>). Railsy wykorzystują helper <tt>form_for</tt> zamiast surowego kodu
HTML, ponieważ dzięki temu jest on bardziej zwięzły i bezpośrednio widać
związek między instancją modelu a formularzem.</p></div>
<div class="admonitionblock">
<table><tr>
<td class="icon">
<img src="./images/icons/tip.png" alt="Tip" />
</td>
<td class="content">Jeśli potrzebujesz stworzyć formularz HTML, który pokazuje dowolne pole niezwiązane z
modelem, powinieneś użyć metody <tt>form_tag</tt>. Umożliwia ona szybkie zbudowanie
formularzy, których nie trzeba łączyć z konkretnym modelem.</td>
</tr></table>
</div>
<div class="paragraph"><p>Gdy użytkownik kliknie przycisk <tt>create</tt>, przeglądarka wyśle informację zwrotną do
akcji <tt>create</tt> (Railsy wiedzą, że mają posłużyć się metodą <tt>create</tt>,
ponieważ formularz jest wysyłana za pomocą żądania HTTP POST – jest to jedna z
konwencji, o których wspomniałem wcześniej):</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 2.11
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="font-weight: bold"><span style="color: #0000FF">def</span></span> create
  <span style="color: #009900">@post</span> <span style="color: #990000">=</span> Post<span style="color: #990000">.</span>new<span style="color: #990000">(</span>params<span style="color: #990000">[:</span>post<span style="color: #990000">])</span>

  respond_to <span style="font-weight: bold"><span style="color: #0000FF">do</span></span> <span style="color: #990000">|</span>format<span style="color: #990000">|</span>
    <span style="font-weight: bold"><span style="color: #0000FF">if</span></span> <span style="color: #009900">@post</span><span style="color: #990000">.</span>save
      flash<span style="color: #990000">[:</span>notice<span style="color: #990000">]</span> <span style="color: #990000">=</span> <span style="color: #FF0000">'Post was successfully created.'</span>
      format<span style="color: #990000">.</span>html <span style="color: #FF0000">{</span> redirect_to<span style="color: #990000">(</span><span style="color: #009900">@post</span><span style="color: #990000">)</span> <span style="color: #FF0000">}</span>
      format<span style="color: #990000">.</span>xml  <span style="color: #FF0000">{</span> render <span style="color: #990000">:</span>xml <span style="color: #990000">=&gt;</span> <span style="color: #009900">@post</span><span style="color: #990000">,</span> <span style="color: #990000">:</span>status <span style="color: #990000">=&gt;</span> <span style="color: #990000">:</span>created<span style="color: #990000">,</span> <span style="color: #990000">:</span>location <span style="color: #990000">=&gt;</span> <span style="color: #009900">@post</span> <span style="color: #FF0000">}</span>
    <span style="font-weight: bold"><span style="color: #0000FF">else</span></span>
      format<span style="color: #990000">.</span>html <span style="color: #FF0000">{</span> render <span style="color: #990000">:</span>action <span style="color: #990000">=&gt;</span> <span style="color: #FF0000">"new"</span> <span style="color: #FF0000">}</span>
      format<span style="color: #990000">.</span>xml  <span style="color: #FF0000">{</span> render <span style="color: #990000">:</span>xml <span style="color: #990000">=&gt;</span> <span style="color: #009900">@post</span><span style="color: #990000">.</span>errors<span style="color: #990000">,</span> <span style="color: #990000">:</span>status <span style="color: #990000">=&gt;</span> <span style="color: #990000">:</span>unprocessable_entity <span style="color: #FF0000">}</span>
    <span style="font-weight: bold"><span style="color: #0000FF">end</span></span>
  <span style="font-weight: bold"><span style="color: #0000FF">end</span></span>
<span style="font-weight: bold"><span style="color: #0000FF">end</span></span></tt></pre></div></div>
<div class="paragraph"><p>Akcja <tt>create</tt> tworzy nowy obiekt <tt>Post</tt> z danych przekazanych przez użytkownika
w formularzu, które Railsy udostępnią w tablicy asocjacyjnej <tt>params</tt>. Po
zapisaniu nowego posta w bazie danych, używają one
<tt>flash[:notice]</tt> do stworzenia komunikatu informacyjnego oraz
przekierowują do akcji <tt>show</tt>. Jeśli pojawi się jakiś problem, akcja <tt>create</tt> pokaże
po prostu widok <tt>new</tt> po raz drugi, uzupełniając go wiadomością o błędzie.</p></div>
<div class="paragraph"><p>Railsy dostarczają tablicę asocjacyjną <tt>flash</tt> (zwyczajowo nazywany flashem), przez co wiadomość może
być przeniesiona do następnej akcji, dając użytkownikowi przydatne informacje o statusie
jego żądania. W przypadku <tt>create</tt> użytkownik nigdy nie widzi strony renderowanej
w trakcie tworzenia posta, ponieważ jest przekierowywany do nowego posta zaraz
po zapisaniu rekordu. Flash przechowuje informacje do następnej akcji, zatem gdy użytkownik
jest przekierowywany z powrotem do akcji <tt>show</tt>, pokazuje mu się informacja
"Post was successfully created.".</p></div>
<h3 id="_wy_wietlanie_pojedynczego_posta">6.10. Wyświetlanie pojedynczego posta</h3>
<div class="paragraph"><p>Gdy klikniesz link <tt>show</tt> dla posta na stronie głównej, przeniesie Cię on pod
adres typu <tt>http://localhost:3000/posts/1</tt>. Railsy traktują to jako wywołanie
akcji <tt>show</tt> na wybranym zasobie i przekazują <tt>1</tt> jako wartość parametru <tt>:id</tt>.
Akcja <tt>show</tt> wygląda następująco:</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 2.11
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="font-weight: bold"><span style="color: #0000FF">def</span></span> show
  <span style="color: #009900">@post</span> <span style="color: #990000">=</span> Post<span style="color: #990000">.</span>find<span style="color: #990000">(</span>params<span style="color: #990000">[:</span>id<span style="color: #990000">])</span>

  respond_to <span style="font-weight: bold"><span style="color: #0000FF">do</span></span> <span style="color: #990000">|</span>format<span style="color: #990000">|</span>
    format<span style="color: #990000">.</span>html <span style="font-style: italic"><span style="color: #9A1900"># show.html.erb</span></span>
    format<span style="color: #990000">.</span>xml  <span style="color: #FF0000">{</span> render <span style="color: #990000">:</span>xml <span style="color: #990000">=&gt;</span> <span style="color: #009900">@post</span> <span style="color: #FF0000">}</span>
  <span style="font-weight: bold"><span style="color: #0000FF">end</span></span>
<span style="font-weight: bold"><span style="color: #0000FF">end</span></span></tt></pre></div></div>
<div class="paragraph"><p>Akcja <tt>show</tt> używa metody <tt>Post.find</tt>, by znaleźć w bazie danych pojedynczy
rekord poprzez jego atrybut <tt>id</tt>.  Railsy wyświetlają go używając widoku <tt>show.html.erb</tt>:</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 2.11
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="font-weight: bold"><span style="color: #0000FF">&lt;p&gt;</span></span>
  <span style="font-weight: bold"><span style="color: #0000FF">&lt;b&gt;</span></span>Name:<span style="font-weight: bold"><span style="color: #0000FF">&lt;/b&gt;</span></span>
  &lt;%=h @post.name %&gt;
<span style="font-weight: bold"><span style="color: #0000FF">&lt;/p&gt;</span></span>

<span style="font-weight: bold"><span style="color: #0000FF">&lt;p&gt;</span></span>
  <span style="font-weight: bold"><span style="color: #0000FF">&lt;b&gt;</span></span>Title:<span style="font-weight: bold"><span style="color: #0000FF">&lt;/b&gt;</span></span>
  &lt;%=h @post.title %&gt;
<span style="font-weight: bold"><span style="color: #0000FF">&lt;/p&gt;</span></span>

<span style="font-weight: bold"><span style="color: #0000FF">&lt;p&gt;</span></span>
  <span style="font-weight: bold"><span style="color: #0000FF">&lt;b&gt;</span></span>Content:<span style="font-weight: bold"><span style="color: #0000FF">&lt;/b&gt;</span></span>
  &lt;%=h @post.content %&gt;
<span style="font-weight: bold"><span style="color: #0000FF">&lt;/p&gt;</span></span>


&lt;%= link_to 'Edit', edit_post_path(@post) %&gt; |
&lt;%= link_to 'Back', posts_path %&gt;</tt></pre></div></div>
<h3 id="_edytowanie_post_w">6.11. Edytowanie postów</h3>
<div class="paragraph"><p>Edytowanie posta, podobnie jak tworzenie nowego, odbywa się dwustopniowo. Pierwszym
krokiem jest żądanie do <tt>edit_post_path(@post)</tt>, do którego przekazany jest
edytowany post. To żądanie wywołuje akcję <tt>edit</tt>:</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 2.11
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="font-weight: bold"><span style="color: #0000FF">def</span></span> edit
  <span style="color: #009900">@post</span> <span style="color: #990000">=</span> Post<span style="color: #990000">.</span>find<span style="color: #990000">(</span>params<span style="color: #990000">[:</span>id<span style="color: #990000">])</span>
<span style="font-weight: bold"><span style="color: #0000FF">end</span></span></tt></pre></div></div>
<div class="paragraph"><p>Do wyświetlenia znalezionego posta Railsy używają widoku <tt>edit.html.erb</tt> :</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 2.11
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="font-weight: bold"><span style="color: #0000FF">&lt;h1&gt;</span></span>Editing post<span style="font-weight: bold"><span style="color: #0000FF">&lt;/h1&gt;</span></span>

&lt;% form_for(@post) do |f| %&gt;
  &lt;%= f.error_messages %&gt;

  <span style="font-weight: bold"><span style="color: #0000FF">&lt;p&gt;</span></span>
    &lt;%= f.label :name %&gt;<span style="font-weight: bold"><span style="color: #0000FF">&lt;br</span></span> <span style="font-weight: bold"><span style="color: #0000FF">/&gt;</span></span>
    &lt;%= f.text_field :name %&gt;
  <span style="font-weight: bold"><span style="color: #0000FF">&lt;/p&gt;</span></span>
  <span style="font-weight: bold"><span style="color: #0000FF">&lt;p&gt;</span></span>
    &lt;%= f.label :title %&gt;<span style="font-weight: bold"><span style="color: #0000FF">&lt;br</span></span> <span style="font-weight: bold"><span style="color: #0000FF">/&gt;</span></span>
    &lt;%= f.text_field :title %&gt;
  <span style="font-weight: bold"><span style="color: #0000FF">&lt;/p&gt;</span></span>
  <span style="font-weight: bold"><span style="color: #0000FF">&lt;p&gt;</span></span>
    &lt;%= f.label :content %&gt;<span style="font-weight: bold"><span style="color: #0000FF">&lt;br</span></span> <span style="font-weight: bold"><span style="color: #0000FF">/&gt;</span></span>
    &lt;%= f.text_area :content %&gt;
  <span style="font-weight: bold"><span style="color: #0000FF">&lt;/p&gt;</span></span>
  <span style="font-weight: bold"><span style="color: #0000FF">&lt;p&gt;</span></span>
    &lt;%= f.submit "Update" %&gt;
  <span style="font-weight: bold"><span style="color: #0000FF">&lt;/p&gt;</span></span>
&lt;% end %&gt;

&lt;%= link_to 'Show', @post %&gt; |
&lt;%= link_to 'Back', posts_path %&gt;</tt></pre></div></div>
<div class="paragraph"><p>Wysłanie formularza utworzonego przez ten widok powoduje
wywołanie akcji <tt>update</tt> w kontrolerze:</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 2.11
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="font-weight: bold"><span style="color: #0000FF">def</span></span> update
  <span style="color: #009900">@post</span> <span style="color: #990000">=</span> Post<span style="color: #990000">.</span>find<span style="color: #990000">(</span>params<span style="color: #990000">[:</span>id<span style="color: #990000">])</span>

  respond_to <span style="font-weight: bold"><span style="color: #0000FF">do</span></span> <span style="color: #990000">|</span>format<span style="color: #990000">|</span>
    <span style="font-weight: bold"><span style="color: #0000FF">if</span></span> <span style="color: #009900">@post</span><span style="color: #990000">.</span>update_attributes<span style="color: #990000">(</span>params<span style="color: #990000">[:</span>post<span style="color: #990000">])</span>
      flash<span style="color: #990000">[:</span>notice<span style="color: #990000">]</span> <span style="color: #990000">=</span> <span style="color: #FF0000">'Post was successfully updated.'</span>
      format<span style="color: #990000">.</span>html <span style="color: #FF0000">{</span> redirect_to<span style="color: #990000">(</span><span style="color: #009900">@post</span><span style="color: #990000">)</span> <span style="color: #FF0000">}</span>
      format<span style="color: #990000">.</span>xml  <span style="color: #FF0000">{</span> head <span style="color: #990000">:</span>ok <span style="color: #FF0000">}</span>
    <span style="font-weight: bold"><span style="color: #0000FF">else</span></span>
      format<span style="color: #990000">.</span>html <span style="color: #FF0000">{</span> render <span style="color: #990000">:</span>action <span style="color: #990000">=&gt;</span> <span style="color: #FF0000">"edit"</span> <span style="color: #FF0000">}</span>
      format<span style="color: #990000">.</span>xml  <span style="color: #FF0000">{</span> render <span style="color: #990000">:</span>xml <span style="color: #990000">=&gt;</span> <span style="color: #009900">@post</span><span style="color: #990000">.</span>errors<span style="color: #990000">,</span> <span style="color: #990000">:</span>status <span style="color: #990000">=&gt;</span> <span style="color: #990000">:</span>unprocessable_entity <span style="color: #FF0000">}</span>
    <span style="font-weight: bold"><span style="color: #0000FF">end</span></span>
  <span style="font-weight: bold"><span style="color: #0000FF">end</span></span>
<span style="font-weight: bold"><span style="color: #0000FF">end</span></span></tt></pre></div></div>
<div class="paragraph"><p>W akcji <tt>update</tt> Railsy wykorzystują parametr <tt>:id</tt> przekazany z widoku
edycji, aby móc zlokalizować edytowany rekord w bazie danych. Wywołanie <tt>update_attributes</tt>
wykorzystuje zaś pozostałe parametry żądania i aplikuje je do tego rekordu.
Jeśli nie pojawi się żaden błąd, użytkownik zostanie przekierowywany do
akcji <tt>show</tt>. Jeśli jednak wystąpią jakieś problemy, Railsy skierują go z powrotem do
akcji <tt>edit</tt>, aby umożliwić mu poprawienie błędów.</p></div>
<div class="admonitionblock">
<table><tr>
<td class="icon">
<img src="./images/icons/note.png" alt="Note" />
</td>
<td class="content">Uważni czytelnicy zapewne zauważyli, że deklaracja <tt>form_for</tt> jest taka sama dla
widoków <tt>new</tt> i <tt>edit</tt>. Railsy generują inny kod dla każdego z formularzy, ponieważ są
na tyle bystre, żeby zauważyć, że w jednym przypadku otrzymują nowy rekord, który
jeszcze nie był zapisany, natomiast w drugim - istniejący rekord, który już został
zapisany w bazie danych. Podczas pisania programu w Railsach zazwyczaj wyeliminowałbyś
tę duplikację poprzez przeniesienie powtarzającego się kodu do podszablonu, który
następnie byłby włączany w oba nadrzędne szablony. Jednakże generator rusztowań próbuje
nie przyjmować zbyt wielu założeń i generuje kod, który łatwo jest zmodyfikować, gdy chcesz mieć
różne formularze do akcji <tt>create</tt> oraz <tt>edit</tt>.</td>
</tr></table>
</div>
<h3 id="_usuwanie_posta">6.12. Usuwanie posta</h3>
<div class="paragraph"><p>Wreszcie, kliknięcie jednego z linków <tt>destroy</tt> wysyła powiązany identyfikator do akcji <tt>destroy</tt>:</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 2.11
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="font-weight: bold"><span style="color: #0000FF">def</span></span> destroy
  <span style="color: #009900">@post</span> <span style="color: #990000">=</span> Post<span style="color: #990000">.</span>find<span style="color: #990000">(</span>params<span style="color: #990000">[:</span>id<span style="color: #990000">])</span>
  <span style="color: #009900">@post</span><span style="color: #990000">.</span>destroy

  respond_to <span style="font-weight: bold"><span style="color: #0000FF">do</span></span> <span style="color: #990000">|</span>format<span style="color: #990000">|</span>
    format<span style="color: #990000">.</span>html <span style="color: #FF0000">{</span> redirect_to<span style="color: #990000">(</span>posts_url<span style="color: #990000">)</span> <span style="color: #FF0000">}</span>
    format<span style="color: #990000">.</span>xml  <span style="color: #FF0000">{</span> head <span style="color: #990000">:</span>ok <span style="color: #FF0000">}</span>
  <span style="font-weight: bold"><span style="color: #0000FF">end</span></span>
<span style="font-weight: bold"><span style="color: #0000FF">end</span></span></tt></pre></div></div>
<div class="paragraph"><p>Metoda <tt>destroy</tt> modelu Active Record natychmiast usuwa odpowiadający mu rekord z bazy
danych. Po tej operacji nie ma już żadnego rekordu do wyświetlenia, dlatego Railsy
przekierowują przeglądarkę użytkownika prosto do widoku <tt>index</tt> tego modelu.</p></div>
</div>
<h2 id="_wykorzystanie_zasady_dry">7. Wykorzystanie zasady DRY</h2>
<div class="sectionbody">
<div class="paragraph"><p>W tym miejscu warto przyjrzeć się paru narzędziom, które Railsy oferują do usuwania
powtórzeń w Twoim kodzie. Zwrócimy szczególną uwagę na podszablony
(<em>partials</em>), których możesz używać do eliminacji powtórzeń z widoków
oraz filtry (<em>filters</em>), które pomagają się z nimi uporać w kontrolerach.</p></div>
<h3 id="_u_ywanie_podszablon_w_do_eliminowania_powt_rze_w_widokach">7.1. Używanie podszablonów do eliminowania powtórzeń w widokach</h3>
<div class="paragraph"><p>Jak już widziałeś wcześniej, widok wygenerowany dla akcji <tt>new</tt> i <tt>edit</tt> jest
bardzo podobny. Dzięki temu możesz przenieść wspólny kod prosto do podszablonu. Wymaga to
edytowania widoków <tt>new</tt> i <tt>edit</tt> oraz dodania nowego podszablonu. Nowy
podszablon <tt>_form.html.erb</tt> powinien być zapisany w tym samym folderze <tt>app/views/posts</tt>
co plik, z którego został on wyekstrahowany. Zauważ, że nazwa tego pliku
zaczyna się od znaku podkreślenia ' _ ' - jest to przyjęta przez Railsy
konwencja dotycząca podszablonów.</p></div>
<div class="paragraph"><p><tt>new.html.erb</tt>:</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 2.11
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="font-weight: bold"><span style="color: #0000FF">&lt;h1&gt;</span></span>New post<span style="font-weight: bold"><span style="color: #0000FF">&lt;/h1&gt;</span></span>

&lt;%= render :partial =&gt; "form" %&gt;

&lt;%= link_to 'Back', posts_path %&gt;</tt></pre></div></div>
<div class="paragraph"><p><tt>edit.html.erb</tt>:</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 2.11
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="font-weight: bold"><span style="color: #0000FF">&lt;h1&gt;</span></span>Editing post<span style="font-weight: bold"><span style="color: #0000FF">&lt;/h1&gt;</span></span>

&lt;%= render :partial =&gt; "form" %&gt;

&lt;%= link_to 'Show', @post %&gt; |
&lt;%= link_to 'Back', posts_path %&gt;</tt></pre></div></div>
<div class="paragraph"><p><tt>_form.html.erb</tt>:</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 2.11
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt>&lt;% form_for(@post) do |f| %&gt;
  &lt;%= f.error_messages %&gt;

  <span style="font-weight: bold"><span style="color: #0000FF">&lt;p&gt;</span></span>
    &lt;%= f.label :name %&gt;<span style="font-weight: bold"><span style="color: #0000FF">&lt;br</span></span> <span style="font-weight: bold"><span style="color: #0000FF">/&gt;</span></span>
    &lt;%= f.text_field :name %&gt;
  <span style="font-weight: bold"><span style="color: #0000FF">&lt;/p&gt;</span></span>
  <span style="font-weight: bold"><span style="color: #0000FF">&lt;p&gt;</span></span>
    &lt;%= f.label :title, "title" %&gt;<span style="font-weight: bold"><span style="color: #0000FF">&lt;br</span></span> <span style="font-weight: bold"><span style="color: #0000FF">/&gt;</span></span>
    &lt;%= f.text_field :title %&gt;
  <span style="font-weight: bold"><span style="color: #0000FF">&lt;/p&gt;</span></span>
  <span style="font-weight: bold"><span style="color: #0000FF">&lt;p&gt;</span></span>
    &lt;%= f.label :content %&gt;<span style="font-weight: bold"><span style="color: #0000FF">&lt;br</span></span> <span style="font-weight: bold"><span style="color: #0000FF">/&gt;</span></span>
    &lt;%= f.text_area :content %&gt;
  <span style="font-weight: bold"><span style="color: #0000FF">&lt;/p&gt;</span></span>
  <span style="font-weight: bold"><span style="color: #0000FF">&lt;p&gt;</span></span>
    &lt;%= f.submit "Save" %&gt;
  <span style="font-weight: bold"><span style="color: #0000FF">&lt;/p&gt;</span></span>
&lt;% end %&gt;</tt></pre></div></div>
<div class="paragraph"><p>Teraz, gdy Railsy renderują widok <tt>new</tt> lub <tt>edit</tt>,
umieszczają w nich podszablon <tt>_form</tt>. Zwróć uwagę na nazewnictwo dla szablonów: jeśli
wewnątrz widoku odnosisz się do szablonu o nazwie <tt>form</tt>, to odpowiadającym mu
plikiem jest <tt>_form.html.erb</tt> (z podkreśleniem na początku).</p></div>
<div class="paragraph"><p>Więcej informacji na temat szablonów uzyskasz w przewodniku
<a href="layouts_and_rendering.html">Layouty oraz renderowanie</a>.</p></div>
<h3 id="_u_ywanie_filtr_w_do_eliminowania_powt_rze_w_kontrolerach">7.2. Używanie filtrów do eliminowania powtórzeń w kontrolerach</h3>
<div class="paragraph"><p>Gdy teraz popatrzysz na kontroler postów, również zobaczysz kilka powtórzeń:</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 2.11
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="font-weight: bold"><span style="color: #0000FF">class</span></span> PostsController <span style="color: #990000">&lt;</span> ApplicationController
  <span style="font-style: italic"><span style="color: #9A1900"># ...</span></span>
  <span style="font-weight: bold"><span style="color: #0000FF">def</span></span> show
    <span style="color: #009900">@post</span> <span style="color: #990000">=</span> Post<span style="color: #990000">.</span>find<span style="color: #990000">(</span>params<span style="color: #990000">[:</span>id<span style="color: #990000">])</span>
    <span style="font-style: italic"><span style="color: #9A1900"># ...</span></span>
  <span style="font-weight: bold"><span style="color: #0000FF">end</span></span>

  <span style="font-weight: bold"><span style="color: #0000FF">def</span></span> edit
    <span style="color: #009900">@post</span> <span style="color: #990000">=</span> Post<span style="color: #990000">.</span>find<span style="color: #990000">(</span>params<span style="color: #990000">[:</span>id<span style="color: #990000">])</span>
  <span style="font-weight: bold"><span style="color: #0000FF">end</span></span>

  <span style="font-weight: bold"><span style="color: #0000FF">def</span></span> update
    <span style="color: #009900">@post</span> <span style="color: #990000">=</span> Post<span style="color: #990000">.</span>find<span style="color: #990000">(</span>params<span style="color: #990000">[:</span>id<span style="color: #990000">])</span>
    <span style="font-style: italic"><span style="color: #9A1900"># ...</span></span>
  <span style="font-weight: bold"><span style="color: #0000FF">end</span></span>

  <span style="font-weight: bold"><span style="color: #0000FF">def</span></span> destroy
    <span style="color: #009900">@post</span> <span style="color: #990000">=</span> Post<span style="color: #990000">.</span>find<span style="color: #990000">(</span>params<span style="color: #990000">[:</span>id<span style="color: #990000">])</span>
    <span style="font-style: italic"><span style="color: #9A1900"># ...</span></span>
  <span style="font-weight: bold"><span style="color: #0000FF">end</span></span>
<span style="font-weight: bold"><span style="color: #0000FF">end</span></span></tt></pre></div></div>
<div class="paragraph"><p>Cztery wystąpienia tej samej linii kodu są bez wątpienia niezgodne z zasadą
DRY. Railsy dostarczają mechanizm <em>filtrów</em> jako sposób na pozbycie się tego
rodzaju powtórzeń. W tym przypadku możesz poprawić kod używając filtru
czołowego <tt>before_filter</tt>:</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 2.11
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="font-weight: bold"><span style="color: #0000FF">class</span></span> PostsController <span style="color: #990000">&lt;</span> ApplicationController
  before_filter <span style="color: #990000">:</span>find_post<span style="color: #990000">,</span> <span style="color: #990000">:</span>only <span style="color: #990000">=&gt;</span> <span style="color: #990000">[:</span>show<span style="color: #990000">,</span> <span style="color: #990000">:</span>edit<span style="color: #990000">,</span> <span style="color: #990000">:</span>update<span style="color: #990000">,</span> <span style="color: #990000">:</span>destroy<span style="color: #990000">]</span>
  <span style="font-style: italic"><span style="color: #9A1900"># ...</span></span>
  <span style="font-weight: bold"><span style="color: #0000FF">def</span></span> show
    <span style="font-style: italic"><span style="color: #9A1900"># ...</span></span>
  <span style="font-weight: bold"><span style="color: #0000FF">end</span></span>

  <span style="font-weight: bold"><span style="color: #0000FF">def</span></span> edit
  <span style="font-weight: bold"><span style="color: #0000FF">end</span></span>

  <span style="font-weight: bold"><span style="color: #0000FF">def</span></span> update
    <span style="font-style: italic"><span style="color: #9A1900"># ...</span></span>
  <span style="font-weight: bold"><span style="color: #0000FF">end</span></span>

  <span style="font-weight: bold"><span style="color: #0000FF">def</span></span> destroy
    <span style="font-style: italic"><span style="color: #9A1900"># ...</span></span>
  <span style="font-weight: bold"><span style="color: #0000FF">end</span></span>

  private
    <span style="font-weight: bold"><span style="color: #0000FF">def</span></span> find_post
      <span style="color: #009900">@post</span> <span style="color: #990000">=</span> Post<span style="color: #990000">.</span>find<span style="color: #990000">(</span>params<span style="color: #990000">[:</span>id<span style="color: #990000">])</span>
    <span style="font-weight: bold"><span style="color: #0000FF">end</span></span>
<span style="font-weight: bold"><span style="color: #0000FF">end</span></span></tt></pre></div></div>
<div class="paragraph"><p>Railsy uruchamiają filtry czołowe <em>przed</em> każdą akcją w kontrolerze. Możesz użyć
polecenia <tt>:only</tt> by ograniczyć działanie filtrów czołowych tylko do określonych akcji,
lub polecenia <tt>:except</tt>, by wyłączyć ich działanie dla niektórych z nich.
Railsy dają Ci też możliwość skorzystania z filtrów końcowych (<em>after
filters</em>), które uruchamiają się po przetworzeniu akcji oraz filtrów
okalającyh (<em>around filters</em>) otaczających akcje w trakcie ich
przetwarzania. Do tego filtry mogą być także definiowane jako zewnętrzne klasy, by
ułatwić wykorzystanie ich w wielu kontrolerach.</p></div>
<div class="paragraph"><p>Więcej informacji o filtrach znajdziesz w przewodniku
<a href="actioncontroller_basics.html">Podstawowe informacje o module Action Controller</a>.</p></div>
</div>
<h2 id="_dodawanie_kolejnego_modelu">8. Dodawanie kolejnego modelu</h2>
<div class="sectionbody">
<div class="paragraph"><p>Skoro widziałeś już, jak wygląda model zbudowany za pomocą rusztowania, nadszedł czas by
dodać do aplikacji kolejny model. Będzie on odpowiedzialny za obsługę komentarzy.</p></div>
<h3 id="_tworzenie_modelu">8.1. Tworzenie modelu</h3>
<div class="paragraph"><p>Nazwy modeli w Railsach pisane są w liczbie pojedynczej, a odpowiadające im
tabele w bazie danych - w liczbie mnogiej. Przyjęło się, że dla modelu, w którym znajdują się
komentarze używamy nazwy <em>Comment</em> (komentarz). Nawet jeśli nie chcesz używać całej aparatury
opartej na rusztowaniu, pamiętaj, że większość programistów piszących w
Railsach, by stworzyć takie rzeczy jak modele czy kontrolery dalej używa
generatorów. Aby stworzyć nowy model, wprowadź do terminalu następującą komendę:</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 2.11
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt>$ script/generate model Comment commenter<span style="color: #990000">:</span>string body<span style="color: #990000">:</span>text post<span style="color: #990000">:</span>references</tt></pre></div></div>
<div class="paragraph"><p>Wygeneruje ona 4 pliki:</p></div>
<div class="ulist"><ul>
<li>
<p>
<tt>app/models/comment.rb</tt> - model
</p>
</li>
<li>
<p>
<tt>db/migrate/20081013214407_create_comments.rb</tt> - migrację
</p>
</li>
<li>
<p>
<tt>test/unit/comment_test.rb</tt> i <tt>test/fixtures/comments.yml</tt> - testy
</p>
</li>
</ul></div>
<div class="paragraph"><p>Przyjrzyjmy się <tt>comment.rb</tt> (drugą linijkę musisz dopisać sam):</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 2.11
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="font-weight: bold"><span style="color: #0000FF">class</span></span> Comment <span style="color: #990000">&lt;</span> ActiveRecord<span style="color: #990000">::</span>Base
  belongs_to <span style="color: #990000">:</span>post
<span style="font-weight: bold"><span style="color: #0000FF">end</span></span></tt></pre></div></div>
<div class="paragraph"><p>Ten model jest bardzo podobny do <tt>post.rb</tt>, który widziałeś już wcześniej. Różnica znajduję
się w lini  <tt>belongs_to :post</tt>, która ustanawia asocjację Active Record. Nauczysz się
więcej na temat asocjacji w następnej części niniejszego przewodnika.</p></div>
<div class="paragraph"><p>Za pomocą migracji tworzona jest tabela w bazie danych:</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 2.11
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="font-weight: bold"><span style="color: #0000FF">class</span></span> CreateComments <span style="color: #990000">&lt;</span> ActiveRecord<span style="color: #990000">::</span>Migration
  <span style="font-weight: bold"><span style="color: #0000FF">def</span></span> <span style="font-weight: bold"><span style="color: #0000FF">self</span></span><span style="color: #990000">.</span>up
    create_table <span style="color: #990000">:</span>comments <span style="font-weight: bold"><span style="color: #0000FF">do</span></span> <span style="color: #990000">|</span>t<span style="color: #990000">|</span>
      t<span style="color: #990000">.</span>string <span style="color: #990000">:</span>commenter
      t<span style="color: #990000">.</span>text <span style="color: #990000">:</span>body
      t<span style="color: #990000">.</span>references <span style="color: #990000">:</span>post

      t<span style="color: #990000">.</span>timestamps
    <span style="font-weight: bold"><span style="color: #0000FF">end</span></span>
  <span style="font-weight: bold"><span style="color: #0000FF">end</span></span>

  <span style="font-weight: bold"><span style="color: #0000FF">def</span></span> <span style="font-weight: bold"><span style="color: #0000FF">self</span></span><span style="color: #990000">.</span>down
    drop_table <span style="color: #990000">:</span>comments
  <span style="font-weight: bold"><span style="color: #0000FF">end</span></span>
<span style="font-weight: bold"><span style="color: #0000FF">end</span></span></tt></pre></div></div>
<div class="paragraph"><p>Linijka <tt>t.references</tt> tworzy kolumnę z kluczem obcym, łączącym oba modele.
Wprowadź migrację do bazy danych za pomocą komendy:</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 2.11
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt>$ rake db<span style="color: #990000">:</span>migrate</tt></pre></div></div>
<div class="paragraph"><p>Railsy są na tyle sprytne, że wykonują tylko te migracje,
które nie zostały jeszcze wprowadzone do aktualnej wersji bazy danych.</p></div>
<h3 id="_asocjacje_modeli">8.2. Asocjacje modeli</h3>
<div class="paragraph"><p>Asocjacje modułu Active Record pozwalają Ci łatwo zdefiniować związek pomiędzy dwoma
modelami. W przypadku komentarzy oraz postów możesz go opisać w ten sposób:</p></div>
<div class="ulist"><ul>
<li>
<p>
każdy komentarz należy do jednego posta
</p>
</li>
<li>
<p>
jeden post może mieć wiele komentarzy
</p>
</li>
</ul></div>
<div class="paragraph"><p>W istocie te określenia są bardzo podobne do składni, jakiej Railsy używają do deklarowania asocjacji.
Widziałeś już linię kodu umieszczoną w modelu komentarza, która wiąże każdy
komentarz z postem:</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 2.11
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="font-weight: bold"><span style="color: #0000FF">class</span></span> Comment <span style="color: #990000">&lt;</span> ActiveRecord<span style="color: #990000">::</span>Base
  belongs_to <span style="color: #990000">:</span>post
<span style="font-weight: bold"><span style="color: #0000FF">end</span></span></tt></pre></div></div>
<div class="paragraph"><p>Żeby dodać drugą stronę asocjacji konieczna jest edycja pliku <tt>post.rb</tt> :</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 2.11
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="font-weight: bold"><span style="color: #0000FF">class</span></span> Post <span style="color: #990000">&lt;</span> ActiveRecord<span style="color: #990000">::</span>Base
  validates_presence_of <span style="color: #990000">:</span>name<span style="color: #990000">,</span> <span style="color: #990000">:</span>title
  validates_length_of <span style="color: #990000">:</span>title<span style="color: #990000">,</span> <span style="color: #990000">:</span>minimum <span style="color: #990000">=&gt;</span> <span style="color: #993399">5</span>
  has_many <span style="color: #990000">:</span>comments
<span style="font-weight: bold"><span style="color: #0000FF">end</span></span></tt></pre></div></div>
<div class="paragraph"><p>Dzięki tym dwóm deklaracjom w znaczny sposób automatyzujemy sposób zachowania się
naszych modeli. Praktycznie wygląda to tak: jeśli masz przykładową zmienną <tt>@post</tt>
zawierającą post, możesz otrzymać wszystkie komentarze, które do niego należą
przez wywołanie <tt>@post.comments</tt>.</p></div>
<div class="admonitionblock">
<table><tr>
<td class="icon">
<img src="./images/icons/tip.png" alt="Tip" />
</td>
<td class="content">Po więcej informacji na temat asocjacji Active Record zajrzyj do przewodnika:
<a href="association_basics.html">Asocjacje modułu Active Record</a>.</td>
</tr></table>
</div>
<h3 id="_dodawanie_dr_g">8.3. Dodawanie dróg</h3>
<div class="paragraph"><p>Drogi (<em>Routes</em>) to wpisy w pliku <tt>config/routes.rb</tt>, które informują Railsy jak
interpretować nadchodzące żądania HTTP, w celu wykonania odpowiednich akcji. Otwórz ten pliku
i znajdź w nim linię kodu odwołującą się do <tt>posts</tt> (znajduje się ona na samym początku
pliku), a następnie edytuj ją następująco:</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 2.11
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt>map<span style="color: #990000">.</span>resources <span style="color: #990000">:</span>posts<span style="color: #990000">,</span> <span style="color: #990000">:</span>has_many <span style="color: #990000">=&gt;</span> <span style="color: #990000">:</span>comments</tt></pre></div></div>
<div class="paragraph"><p>Ten wpis tworzy <tt>comments</tt> jako zagnieżdżony zasób (<em>nested resource</em>) wewnątrz <tt>posts</tt>. W ten
sposób jesteśmy coraz bliżej uchwycenia hierarchicznych zależności, które
występują między postami i komentarzami.</p></div>
<div class="admonitionblock">
<table><tr>
<td class="icon">
<img src="./images/icons/tip.png" alt="Tip" />
</td>
<td class="content">Po więcej informacji na temat routingu sięgnij do przewodnika:
<a href="routing_outside_in.html">Routing w Ruby on Rails</a>.</td>
</tr></table>
</div>
<h3 id="_generowanie_kontrolera">8.4. Generowanie kontrolera</h3>
<div class="paragraph"><p>Mając już przygotowany  model, czas zacząć tworzyć pasujący do niego kontroler. I znów
posłużymy się generatorem:</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 2.11
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt>$ script/generate controller Comments index show new edit</tt></pre></div></div>
<div class="paragraph"><p>Wywołanie to tworzy siedem plików:</p></div>
<div class="ulist"><ul>
<li>
<p>
<tt>app/controllers/comments_controller.rb</tt> - kontroler
</p>
</li>
<li>
<p>
<tt>app/helpers/comments_helper.rb</tt> - helper dla widoku
</p>
</li>
<li>
<p>
<tt>app/views/comments/index.html.erb</tt> - widok dla akcji <tt>index</tt>
</p>
</li>
<li>
<p>
<tt>app/views/comments/show.html.erb</tt> - widok dla akcji <tt>show</tt>
</p>
</li>
<li>
<p>
<tt>app/views/comments/new.html.erb</tt> - widok dla  akcji <tt>new</tt>
</p>
</li>
<li>
<p>
<tt>app/views/comments/edit.html.erb</tt> - widok dla akcji <tt>edit</tt>
</p>
</li>
<li>
<p>
<tt>test/functional/comments_controller_test.rb</tt> - testy funkcjonalne kontrolera
</p>
</li>
</ul></div>
<div class="paragraph"><p>Kontroler zostanie wygenerowany z pustymi metodami oraz widokami dla każdej akcji, które
zdefiniowałeś w wywołaniu <tt>script/generate controller</tt>:</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 2.11
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="font-weight: bold"><span style="color: #0000FF">class</span></span> CommentsController <span style="color: #990000">&lt;</span> ApplicationController
  <span style="font-weight: bold"><span style="color: #0000FF">def</span></span> index
  <span style="font-weight: bold"><span style="color: #0000FF">end</span></span>

  <span style="font-weight: bold"><span style="color: #0000FF">def</span></span> show
  <span style="font-weight: bold"><span style="color: #0000FF">end</span></span>

  <span style="font-weight: bold"><span style="color: #0000FF">def</span></span> new
  <span style="font-weight: bold"><span style="color: #0000FF">end</span></span>

  <span style="font-weight: bold"><span style="color: #0000FF">def</span></span> edit
  <span style="font-weight: bold"><span style="color: #0000FF">end</span></span>

<span style="font-weight: bold"><span style="color: #0000FF">end</span></span></tt></pre></div></div>
<div class="paragraph"><p>Kod ten należy oczywiście uzupełnić tak, by właściwie obsłużyć nadchodzące
żądania. Poniżej (ze względu na prostotę rozwiązania) przedstawiona jest
wersja, która odpowiada tylko na żądania HTML:</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 2.11
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="font-weight: bold"><span style="color: #0000FF">class</span></span> CommentsController <span style="color: #990000">&lt;</span> ApplicationController
  <span style="font-weight: bold"><span style="color: #0000FF">def</span></span> index
    <span style="color: #009900">@post</span> <span style="color: #990000">=</span> Post<span style="color: #990000">.</span>find<span style="color: #990000">(</span>params<span style="color: #990000">[:</span>post_id<span style="color: #990000">])</span>
    <span style="color: #009900">@comments</span> <span style="color: #990000">=</span> <span style="color: #009900">@post</span><span style="color: #990000">.</span>comments
  <span style="font-weight: bold"><span style="color: #0000FF">end</span></span>

  <span style="font-weight: bold"><span style="color: #0000FF">def</span></span> show
    <span style="color: #009900">@post</span> <span style="color: #990000">=</span> Post<span style="color: #990000">.</span>find<span style="color: #990000">(</span>params<span style="color: #990000">[:</span>post_id<span style="color: #990000">])</span>
    <span style="color: #009900">@comment</span> <span style="color: #990000">=</span> <span style="color: #009900">@post</span><span style="color: #990000">.</span>comments<span style="color: #990000">.</span>find<span style="color: #990000">(</span>params<span style="color: #990000">[:</span>id<span style="color: #990000">])</span>
  <span style="font-weight: bold"><span style="color: #0000FF">end</span></span>

  <span style="font-weight: bold"><span style="color: #0000FF">def</span></span> new
    <span style="color: #009900">@post</span> <span style="color: #990000">=</span> Post<span style="color: #990000">.</span>find<span style="color: #990000">(</span>params<span style="color: #990000">[:</span>post_id<span style="color: #990000">])</span>
    <span style="color: #009900">@comment</span> <span style="color: #990000">=</span> <span style="color: #009900">@post</span><span style="color: #990000">.</span>comments<span style="color: #990000">.</span>build
  <span style="font-weight: bold"><span style="color: #0000FF">end</span></span>

  <span style="font-weight: bold"><span style="color: #0000FF">def</span></span> create
    <span style="color: #009900">@post</span> <span style="color: #990000">=</span> Post<span style="color: #990000">.</span>find<span style="color: #990000">(</span>params<span style="color: #990000">[:</span>post_id<span style="color: #990000">])</span>
    <span style="color: #009900">@comment</span> <span style="color: #990000">=</span> <span style="color: #009900">@post</span><span style="color: #990000">.</span>comments<span style="color: #990000">.</span>build<span style="color: #990000">(</span>params<span style="color: #990000">[:</span>comment<span style="color: #990000">])</span>
    <span style="font-weight: bold"><span style="color: #0000FF">if</span></span> <span style="color: #009900">@comment</span><span style="color: #990000">.</span>save
      redirect_to post_comment_url<span style="color: #990000">(</span><span style="color: #009900">@post</span><span style="color: #990000">,</span> <span style="color: #009900">@comment</span><span style="color: #990000">)</span>
    <span style="font-weight: bold"><span style="color: #0000FF">else</span></span>
      render <span style="color: #990000">:</span>action <span style="color: #990000">=&gt;</span> <span style="color: #FF0000">"new"</span>
    <span style="font-weight: bold"><span style="color: #0000FF">end</span></span>
  <span style="font-weight: bold"><span style="color: #0000FF">end</span></span>

  <span style="font-weight: bold"><span style="color: #0000FF">def</span></span> edit
    <span style="color: #009900">@post</span> <span style="color: #990000">=</span> Post<span style="color: #990000">.</span>find<span style="color: #990000">(</span>params<span style="color: #990000">[:</span>post_id<span style="color: #990000">])</span>
    <span style="color: #009900">@comment</span> <span style="color: #990000">=</span> <span style="color: #009900">@post</span><span style="color: #990000">.</span>comments<span style="color: #990000">.</span>find<span style="color: #990000">(</span>params<span style="color: #990000">[:</span>id<span style="color: #990000">])</span>
  <span style="font-weight: bold"><span style="color: #0000FF">end</span></span>

  <span style="font-weight: bold"><span style="color: #0000FF">def</span></span> update
    <span style="color: #009900">@post</span> <span style="color: #990000">=</span> Post<span style="color: #990000">.</span>find<span style="color: #990000">(</span>params<span style="color: #990000">[:</span>post_id<span style="color: #990000">])</span>
    <span style="color: #009900">@comment</span> <span style="color: #990000">=</span> Comment<span style="color: #990000">.</span>find<span style="color: #990000">(</span>params<span style="color: #990000">[:</span>id<span style="color: #990000">])</span>
    <span style="font-weight: bold"><span style="color: #0000FF">if</span></span> <span style="color: #009900">@comment</span><span style="color: #990000">.</span>update_attributes<span style="color: #990000">(</span>params<span style="color: #990000">[:</span>comment<span style="color: #990000">])</span>
      redirect_to post_comment_url<span style="color: #990000">(</span><span style="color: #009900">@post</span><span style="color: #990000">,</span> <span style="color: #009900">@comment</span><span style="color: #990000">)</span>
    <span style="font-weight: bold"><span style="color: #0000FF">else</span></span>
      render <span style="color: #990000">:</span>action <span style="color: #990000">=&gt;</span> <span style="color: #FF0000">"edit"</span>
    <span style="font-weight: bold"><span style="color: #0000FF">end</span></span>
  <span style="font-weight: bold"><span style="color: #0000FF">end</span></span>

  <span style="font-weight: bold"><span style="color: #0000FF">def</span></span> destroy
    <span style="color: #009900">@post</span> <span style="color: #990000">=</span> Post<span style="color: #990000">.</span>find<span style="color: #990000">(</span>params<span style="color: #990000">[:</span>post_id<span style="color: #990000">])</span>
    <span style="color: #009900">@comment</span> <span style="color: #990000">=</span> Comment<span style="color: #990000">.</span>find<span style="color: #990000">(</span>params<span style="color: #990000">[:</span>id<span style="color: #990000">])</span>
    <span style="color: #009900">@comment</span><span style="color: #990000">.</span>destroy
    redirect_to post_comments_path<span style="color: #990000">(</span><span style="color: #009900">@post</span><span style="color: #990000">)</span>
  <span style="font-weight: bold"><span style="color: #0000FF">end</span></span>

<span style="font-weight: bold"><span style="color: #0000FF">end</span></span></tt></pre></div></div>
<div class="paragraph"><p>Jak widzisz, jest to trochę bardziej skomplikowane niż wcześniejsze operacje w
kontrolerze dla postów. Jest to uboczny efekt powiązania które utworzyłeś; każda
akcja wykonywana na komentarzu musi brać pod uwagę post, dla którego został
on utworzony.</p></div>
<div class="paragraph"><p>Dodatkowo, kod ten korzysta z niektórych metod dostępnych dzięki asocjacjom.
Przykładowo - w metodzie <tt>new</tt> pojawia się wywołanie:</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 2.11
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="color: #009900">@comment</span> <span style="color: #990000">=</span> <span style="color: #009900">@post</span><span style="color: #990000">.</span>comments<span style="color: #990000">.</span>build</tt></pre></div></div>
<div class="paragraph"><p>Ten kod powoduje utworzenie w ramach jednej operacji nowego obiektu klasy <tt>Comment</tt>
<em>oraz</em> ustawienie jego pola <tt>post_id</tt> na wartość równą atrybutowi <tt>id</tt>
powiązanego obiektu klasy <tt>Post</tt>.</p></div>
<h3 id="_tworzenie_widok_w">8.5. Tworzenie widoków</h3>
<div class="paragraph"><p>Ponieważ przestałeś korzystać z rusztowania, konieczne będzie ręczne zbudowanie widoków
dla komentarzy. Wywołanie <tt>script/generate controller</tt> utworzy szkielet widoków, które
jednak będą pozbawione faktycznej zawartości. Oto pierwszy krok do
uzupełnienia widoków komentarzy.</p></div>
<div class="paragraph"><p>Widok <tt>app/views/comments/index.html.erb</tt>:</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 2.11
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="font-weight: bold"><span style="color: #0000FF">&lt;h1&gt;</span></span>Comments for &lt;%= @post.title %&gt;<span style="font-weight: bold"><span style="color: #0000FF">&lt;/h1&gt;</span></span>

<span style="font-weight: bold"><span style="color: #0000FF">&lt;table&gt;</span></span>
  <span style="font-weight: bold"><span style="color: #0000FF">&lt;tr&gt;</span></span>
    <span style="font-weight: bold"><span style="color: #0000FF">&lt;th&gt;</span></span>Commenter<span style="font-weight: bold"><span style="color: #0000FF">&lt;/th&gt;</span></span>
    <span style="font-weight: bold"><span style="color: #0000FF">&lt;th&gt;</span></span>Body<span style="font-weight: bold"><span style="color: #0000FF">&lt;/th&gt;</span></span>
  <span style="font-weight: bold"><span style="color: #0000FF">&lt;/tr&gt;</span></span>

&lt;% for comment in @comments %&gt;
  <span style="font-weight: bold"><span style="color: #0000FF">&lt;tr&gt;</span></span>
    <span style="font-weight: bold"><span style="color: #0000FF">&lt;td&gt;</span></span>&lt;%=h comment.commenter %&gt;<span style="font-weight: bold"><span style="color: #0000FF">&lt;/td&gt;</span></span>
    <span style="font-weight: bold"><span style="color: #0000FF">&lt;td&gt;</span></span>&lt;%=h comment.body %&gt;<span style="font-weight: bold"><span style="color: #0000FF">&lt;/td&gt;</span></span>
    <span style="font-weight: bold"><span style="color: #0000FF">&lt;td&gt;</span></span>&lt;%= link_to 'Show', post_comment_path(@post, comment) %&gt;<span style="font-weight: bold"><span style="color: #0000FF">&lt;/td&gt;</span></span>
    <span style="font-weight: bold"><span style="color: #0000FF">&lt;td&gt;</span></span>&lt;%= link_to 'Edit', edit_post_comment_path(@post, comment) %&gt;<span style="font-weight: bold"><span style="color: #0000FF">&lt;/td&gt;</span></span>
    <span style="font-weight: bold"><span style="color: #0000FF">&lt;td&gt;</span></span>&lt;%= link_to 'Destroy', post_comment_path(@post, comment), :confirm =&gt; 'Are you sure?', :method =&gt; :delete %&gt;<span style="font-weight: bold"><span style="color: #0000FF">&lt;/td&gt;</span></span>
  <span style="font-weight: bold"><span style="color: #0000FF">&lt;/tr&gt;</span></span>
&lt;% end %&gt;
<span style="font-weight: bold"><span style="color: #0000FF">&lt;/table&gt;</span></span>

<span style="font-weight: bold"><span style="color: #0000FF">&lt;br</span></span> <span style="font-weight: bold"><span style="color: #0000FF">/&gt;</span></span>

&lt;%= link_to 'New comment', new_post_comment_path(@post) %&gt;
&lt;%= link_to 'Back to Post', @post %&gt;</tt></pre></div></div>
<div class="paragraph"><p>Widok <tt>app/views/comments/new.html.erb</tt> (zwróć uwagę na tablicę przekazaną do
wywołania <tt>form_for</tt>):</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 2.11
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="font-weight: bold"><span style="color: #0000FF">&lt;h1&gt;</span></span>New comment<span style="font-weight: bold"><span style="color: #0000FF">&lt;/h1&gt;</span></span>

&lt;% form_for([@post, @comment]) do |f| %&gt;
  &lt;%= f.error_messages %&gt;

  <span style="font-weight: bold"><span style="color: #0000FF">&lt;p&gt;</span></span>
    &lt;%= f.label :commenter %&gt;<span style="font-weight: bold"><span style="color: #0000FF">&lt;br</span></span> <span style="font-weight: bold"><span style="color: #0000FF">/&gt;</span></span>
    &lt;%= f.text_field :commenter %&gt;
  <span style="font-weight: bold"><span style="color: #0000FF">&lt;/p&gt;</span></span>
  <span style="font-weight: bold"><span style="color: #0000FF">&lt;p&gt;</span></span>
    &lt;%= f.label :body %&gt;<span style="font-weight: bold"><span style="color: #0000FF">&lt;br</span></span> <span style="font-weight: bold"><span style="color: #0000FF">/&gt;</span></span>
    &lt;%= f.text_area :body %&gt;
  <span style="font-weight: bold"><span style="color: #0000FF">&lt;/p&gt;</span></span>
  <span style="font-weight: bold"><span style="color: #0000FF">&lt;p&gt;</span></span>
    &lt;%= f.submit "Create" %&gt;
  <span style="font-weight: bold"><span style="color: #0000FF">&lt;/p&gt;</span></span>
&lt;% end %&gt;

&lt;%= link_to 'Back', post_comments_path(@post) %&gt;</tt></pre></div></div>
<div class="paragraph"><p>Widok <tt>app/views/comments/show.html.erb</tt>:</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 2.11
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="font-weight: bold"><span style="color: #0000FF">&lt;h1&gt;</span></span>Comment on &lt;%= @post.title %&gt;<span style="font-weight: bold"><span style="color: #0000FF">&lt;/h1&gt;</span></span>

<span style="font-weight: bold"><span style="color: #0000FF">&lt;p&gt;</span></span>
  <span style="font-weight: bold"><span style="color: #0000FF">&lt;b&gt;</span></span>Commenter:<span style="font-weight: bold"><span style="color: #0000FF">&lt;/b&gt;</span></span>
  &lt;%=h @comment.commenter %&gt;
<span style="font-weight: bold"><span style="color: #0000FF">&lt;/p&gt;</span></span>

<span style="font-weight: bold"><span style="color: #0000FF">&lt;p&gt;</span></span>
  <span style="font-weight: bold"><span style="color: #0000FF">&lt;b&gt;</span></span>Comment:<span style="font-weight: bold"><span style="color: #0000FF">&lt;/b&gt;</span></span>
  &lt;%=h @comment.body %&gt;
<span style="font-weight: bold"><span style="color: #0000FF">&lt;/p&gt;</span></span>

&lt;%= link_to 'Edit', edit_post_comment_path(@post, @comment) %&gt; |
&lt;%= link_to 'Back', post_comments_path(@post) %&gt;</tt></pre></div></div>
<div class="paragraph"><p>Widok <tt>app/views/comments/edit.html.erb</tt>:</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 2.11
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="font-weight: bold"><span style="color: #0000FF">&lt;h1&gt;</span></span>Editing comment<span style="font-weight: bold"><span style="color: #0000FF">&lt;/h1&gt;</span></span>

&lt;% form_for([@post, @comment]) do |f| %&gt;
  &lt;%= f.error_messages %&gt;

  <span style="font-weight: bold"><span style="color: #0000FF">&lt;p&gt;</span></span>
    &lt;%= f.label :commenter %&gt;<span style="font-weight: bold"><span style="color: #0000FF">&lt;br</span></span> <span style="font-weight: bold"><span style="color: #0000FF">/&gt;</span></span>
    &lt;%= f.text_field :commenter %&gt;
  <span style="font-weight: bold"><span style="color: #0000FF">&lt;/p&gt;</span></span>
  <span style="font-weight: bold"><span style="color: #0000FF">&lt;p&gt;</span></span>
    &lt;%= f.label :body %&gt;<span style="font-weight: bold"><span style="color: #0000FF">&lt;br</span></span> <span style="font-weight: bold"><span style="color: #0000FF">/&gt;</span></span>
    &lt;%= f.text_area :body %&gt;
  <span style="font-weight: bold"><span style="color: #0000FF">&lt;/p&gt;</span></span>
  <span style="font-weight: bold"><span style="color: #0000FF">&lt;p&gt;</span></span>
    &lt;%= f.submit "Update" %&gt;
  <span style="font-weight: bold"><span style="color: #0000FF">&lt;/p&gt;</span></span>
&lt;% end %&gt;

&lt;%= link_to 'Show', post_comment_path(@post, @comment) %&gt; |
&lt;%= link_to 'Back', post_comments_path(@post) %&gt;</tt></pre></div></div>
<div class="paragraph"><p>Ponownie ta większa komplikacja (w porównaniu do widoków do zarządzania postami,
które widziałeś wcześniej) bierze się z konieczności żonglowania postami i
ich komentarzami w tym samym czasie.</p></div>
<h3 id="_dodawanie_komentarzy_do_post_w">8.6. Dodawanie komentarzy do postów</h3>
<div class="paragraph"><p>W następnym kroku zmodyfikuje widok <tt>app/views/posts/show.html.erb</tt>,
by pokazać jego komentarze oraz umożliwić zarządzanie nimi:</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 2.11
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="font-weight: bold"><span style="color: #0000FF">&lt;p&gt;</span></span>
  <span style="font-weight: bold"><span style="color: #0000FF">&lt;b&gt;</span></span>Name:<span style="font-weight: bold"><span style="color: #0000FF">&lt;/b&gt;</span></span>
  &lt;%=h @post.name %&gt;
<span style="font-weight: bold"><span style="color: #0000FF">&lt;/p&gt;</span></span>

<span style="font-weight: bold"><span style="color: #0000FF">&lt;p&gt;</span></span>
  <span style="font-weight: bold"><span style="color: #0000FF">&lt;b&gt;</span></span>Title:<span style="font-weight: bold"><span style="color: #0000FF">&lt;/b&gt;</span></span>
  &lt;%=h @post.title %&gt;
<span style="font-weight: bold"><span style="color: #0000FF">&lt;/p&gt;</span></span>

<span style="font-weight: bold"><span style="color: #0000FF">&lt;p&gt;</span></span>
  <span style="font-weight: bold"><span style="color: #0000FF">&lt;b&gt;</span></span>Content:<span style="font-weight: bold"><span style="color: #0000FF">&lt;/b&gt;</span></span>
  &lt;%=h @post.content %&gt;
<span style="font-weight: bold"><span style="color: #0000FF">&lt;/p&gt;</span></span>

<span style="font-weight: bold"><span style="color: #0000FF">&lt;h2&gt;</span></span>Comments<span style="font-weight: bold"><span style="color: #0000FF">&lt;/h2&gt;</span></span>
&lt;% @post.comments.each do |c| %&gt;
        <span style="font-weight: bold"><span style="color: #0000FF">&lt;p&gt;</span></span>
          <span style="font-weight: bold"><span style="color: #0000FF">&lt;b&gt;</span></span>Commenter:<span style="font-weight: bold"><span style="color: #0000FF">&lt;/b&gt;</span></span>
          &lt;%=h c.commenter %&gt;
        <span style="font-weight: bold"><span style="color: #0000FF">&lt;/p&gt;</span></span>

        <span style="font-weight: bold"><span style="color: #0000FF">&lt;p&gt;</span></span>
          <span style="font-weight: bold"><span style="color: #0000FF">&lt;b&gt;</span></span>Comment:<span style="font-weight: bold"><span style="color: #0000FF">&lt;/b&gt;</span></span>
          &lt;%=h c.body %&gt;
        <span style="font-weight: bold"><span style="color: #0000FF">&lt;/p&gt;</span></span>
&lt;% end %&gt;

&lt;%= link_to 'Edit Post', edit_post_path(@post) %&gt; |
&lt;%= link_to 'Back to Posts', posts_path %&gt;
&lt;%= link_to 'Manage Comments', post_comments_path(@post) %&gt;</tt></pre></div></div>
<div class="paragraph"><p>Zapamiętaj, że każdy post ma swój osobny zbiór komentarzy, dostępny przez
<tt>@post.comments</tt>. Wynika to z asocjacji zadeklarowanych w modelach. Natomiast
helper taki jak <tt>post_comments_path</tt> pochodzi od definicji zagnieżdżonej drogi z
pliku <tt>config/routes.rb</tt>.</p></div>
</div>
<h2 id="_co_dalej">9. Co dalej?</h2>
<div class="sectionbody">
<div class="paragraph"><p>Teraz, gdy masz przed sobą swój pierwszy program napisany w Railsach, możesz go uatrakcyjniać
według własnych potrzeb. Ale nie musisz do wszystkich rozwiązań dochodzić samodzielnie.
Jeśli potrzebujesz wsparcia przy tworzeniu i uruchamianiu aplikacji możesz
skorzystać z tych zasobów:</p></div>
<div class="ulist"><ul>
<li>
<p>
<a href="./index.html">Przewodniki po Ruby On Rails</a>
</p>
</li>
<li>
<p>
<a href="http://groups.google.com/group/rubyonrails-talk">Lista mejlingowa Ruby on Rails</a>
</p>
</li>
<li>
<p>
Kanał #rubyonrails na irc.freenode.net
</p>
</li>
<li>
<p>
<a href="http://wiki.rubyonrails.org/rails">Rails wiki</a>
</p>
</li>
</ul></div>
<div class="paragraph"><p>Railsy mają równiez wbudowaną pomoc, którą możesz wywołać w linii poleceń przy użyciu komendy
<tt>rake</tt>:</p></div>
<div class="ulist"><ul>
<li>
<p>
Uruchomienie <tt>rake doc:guides</tt> umieści kopię przewodników Rails w
  folderze <tt>/doc/guides</tt>. Znajdujący się tam plik
  <tt>/doc/guides/index.html</tt> możesz przeglądać używając przeglądarki.
</p>
</li>
<li>
<p>
Uruchomienie <tt>rake doc:rails</tt> umieści kopię dokumentacji API dla Rails w folderze
  <tt>/doc/api</tt>. Znajdujący się tam plik <tt>/doc/api/index.html</tt> możesz
  przeglądać używając przeglądarki.
</p>
</li>
</ul></div>
</div>
<h2 id="_changelog">10. Changelog</h2>
<div class="sectionbody">
<div class="paragraph"><p><a href="http://rails.lighthouseapp.com/projects/16213-rails-guides/tickets/2">Lighthouse ticket</a></p></div>
<div class="ulist"><ul>
<li>
<p>
November 3, 2008: Formatting patch from Dave Rothlisberger
</p>
</li>
<li>
<p>
November 1, 2008: First approved version by <a href="authors.html#mgunderloy">Mike Gunderloy</a>
</p>
</li>
<li>
<p>
October 16, 2008: Revised based on feedback from Pratik Naik by <a href="../authors.html#mgunderloy">Mike Gunderloy</a> (not yet approved for publication)
</p>
</li>
<li>
<p>
October 13, 2008: First complete draft by <a href="authors.html#mgunderloy">Mike Gunderloy</a> (not yet approved for publication)
</p>
</li>
<li>
<p>
October 12, 2008: More detail, rearrangement, editing by <a href="authors.html#mgunderloy">Mike Gunderloy</a> (not yet approved for publication)
</p>
</li>
<li>
<p>
September 8, 2008: initial version by James Miller (not yet approved for publication)
</p>
</li>
</ul></div>
</div>

    </div>
  </div>
</body>
</html>
