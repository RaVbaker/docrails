<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
  <title>Debugowanie w Ruby on Rails</title>
  <!--[if lt IE 8]>
  <script src="http://ie7-js.googlecode.com/svn/version/2.0(beta3)/IE8.js" type="text/javascript"></script>
  <![endif]-->
  <link href="stylesheets/base.css" media="screen" rel="Stylesheet" type="text/css" />
  <link href="stylesheets/forms.css" media="screen" rel="Stylesheet" type="text/css" />
  <link href="stylesheets/more.css" media="screen" rel="Stylesheet" type="text/css" />
</head>
<body>
  <div id="header" >
    <div id="logo">
      <a href="index.html" title="Ruby on Rails"><img src="images/rails_logo_remix.gif" alt="Rails" height="140" width="110" /></a>
    </div>

    <h1 id="site_title"><span>Ruby on Rails</span></h1>
    <h2 id="site_title_tagline">Sustainable productivity for web-application development</h2>

    <ul id="navMain">
      <li class="first-child"><a href="http://www.rubyonrails.org/" title="Ruby on Rails" class="ruby_on_rails">Ruby on Rails</a></li>
      <li><a class="manuals" href="index.html" title="Manuals Index">Guides Index</a></li>
    </ul>
  </div>

  <div id="container">
    
    <div id="sidebar">
      <h2>Chapters</h2>
      <ol>
          <li>
          <a href="#_helpery_widoku_dla_debugowania">Helpery widoku dla debugowania</a>
            <ul>
            
              <li><a href="#_debug">debug</a></li>
            
              <li><a href="#_to_yaml">to_yaml</a></li>
            
              <li><a href="#_inspect">inspect</a></li>
            
              <li><a href="#_debugging_javascript">Debugging Javascript</a></li>
            
            </ul>
          </li>
          <li>
          <a href="#_logger">Logger</a>
            <ul>
            
              <li><a href="#_czym_jest_logger">Czym jest Logger?</a></li>
            
              <li><a href="#_poziomy_log_w">Poziomy logów</a></li>
            
              <li><a href="#_wysy_anie_wiadomo_ci">Wysyłanie wiadomości</a></li>
            
            </ul>
          </li>
          <li>
          <a href="#_debugowanie_z_u_yciem_ruby_debug">Debugowanie z użyciem ruby-debug</a>
            <ul>
            
              <li><a href="#_instalacja">Instalacja</a></li>
            
              <li><a href="#_pow_oka">Powłoka</a></li>
            
              <li><a href="#_kontekst">Kontekst</a></li>
            
              <li><a href="#_w_tki">Wątki</a></li>
            
              <li><a href="#_sprawdzanie_zmiennych">Sprawdzanie zmiennych</a></li>
            
              <li><a href="#_krok_po_kroku">Krok po kroku</a></li>
            
              <li><a href="#_breakpointy">Breakpointy</a></li>
            
              <li><a href="#_apanie_wyj_tk_w">Łapanie wyjątków</a></li>
            
              <li><a href="#_przywracanie_wykonywania">Przywracanie wykonywania</a></li>
            
              <li><a href="#_edytowanie">Edytowanie</a></li>
            
              <li><a href="#_wychodzenie">Wychodzenie</a></li>
            
              <li><a href="#_ustawienia">Ustawienia</a></li>
            
            </ul>
          </li>
          <li>
          <a href="#_debugowanie_wyciek_w_pami_ci">Debugowanie Wycieków Pamięci</a>
            <ul>
            
              <li><a href="#_bleakhouse">BleakHouse</a></li>
            
              <li><a href="#_valgrind">Valgrind</a></li>
            
            </ul>
          </li>
          <li>
          <a href="#_pluginy_do_debugowania">Pluginy do Debugowania</a>
          </li>
          <li>
          <a href="#_odno_niki">Odnośniki</a>
          </li>
          <li>
          <a href="#_changelog">Changelog</a>
          </li>
      </ol>
    </div>
    
    <div id="content">
        <h1>Debugowanie w Ruby on Rails</h1>
      <div id="preamble">
<div class="sectionbody">
<div class="paragraph"><p>Ten przewodnik przedstawia techniki debugowania aplikacji Railsowych. Korzystając z tego przewodnika będziesz w stanie:</p></div>
<div class="ulist"><ul>
<li>
<p>
zrozumieć cel debugowania
</p>
</li>
<li>
<p>
wyszukać problemy i kwestie do rozwiązania w twojej aplikacji, których nie identyfikują twoje testy
</p>
</li>
<li>
<p>
poznać różne metody debugowania
</p>
</li>
<li>
<p>
analizować stos wywołań (ang. stack trace)
</p>
</li>
</ul></div>
</div>
</div>
<h2 id="_helpery_widoku_dla_debugowania">1. Helpery widoku dla debugowania</h2>
<div class="sectionbody">
<div class="paragraph"><p>Zwyczajową czynnością jest przy debugowaniu jest oglądanie zawartości
zmiennej. W Railsach może to zrobić za pomocą jednej z trzech metod:</p></div>
<div class="ulist"><ul>
<li>
<p>
<tt>debug</tt>
</p>
</li>
<li>
<p>
<tt>to_yaml</tt>
</p>
</li>
<li>
<p>
<tt>inspect</tt>
</p>
</li>
</ul></div>
<h3 id="_debug">1.1. debug</h3>
<div class="paragraph"><p>Helper <tt>debug</tt> zwróci tag <tt>&lt;pre&gt;</tt> który przedstawi obiekt używając formatu YAML. Wygeneruje to czytelne dla człowieka dane z dowolnego obiektu. Na przykład, wykorzystując taki kod:</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 2.11
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt>&lt;%= debug @post %&gt;
<span style="font-weight: bold"><span style="color: #0000FF">&lt;p&gt;</span></span>
  <span style="font-weight: bold"><span style="color: #0000FF">&lt;b&gt;</span></span>Title:<span style="font-weight: bold"><span style="color: #0000FF">&lt;/b&gt;</span></span>
  &lt;%=h @post.title %&gt;
<span style="font-weight: bold"><span style="color: #0000FF">&lt;/p&gt;</span></span></tt></pre></div></div>
<div class="paragraph"><p>Otrzymasz wynik podobny do poniższego:</p></div>
<div class="listingblock">
<div class="content">
<pre><tt>--- !ruby/object:Post
attributes:
  updated_at: 2008-09-05 22:55:47
  body: It's a very helpful guide for debugging your Rails app.
  title: Rails debugging guide
  published: t
  id: "1"
  created_at: 2008-09-05 22:55:47
attributes_cache: {}


Title: Rails debugging guide</tt></pre>
</div></div>
<h3 id="_to_yaml">1.2. to_yaml</h3>
<div class="paragraph"><p>Wyświetlanie zmiennej instancyjnej (lub jakiegokolwiek innego obiektu bądź metody) w formacie YAML może być przeprowadzone tym sposobem:</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 2.11
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt>&lt;%= simple_format @post.to_yaml %&gt;
<span style="font-weight: bold"><span style="color: #0000FF">&lt;p&gt;</span></span>
  <span style="font-weight: bold"><span style="color: #0000FF">&lt;b&gt;</span></span>Title:<span style="font-weight: bold"><span style="color: #0000FF">&lt;/b&gt;</span></span>
  &lt;%=h @post.title %&gt;
<span style="font-weight: bold"><span style="color: #0000FF">&lt;/p&gt;</span></span></tt></pre></div></div>
<div class="paragraph"><p>Metoda <tt>to_yaml</tt> konwertuje wynik metody do formatu YAML, pozostawiając go
bardziej czytelnym, następnie helper <tt>simple_format</tt> jest wykorzystany do
wyświetlenia każdej linijki osobno - podobnie jak w konsoli. Odpowiada to
działaniu metody <tt>debug</tt>.</p></div>
<div class="paragraph"><p>Jako wynik zobaczysz coś takiego:</p></div>
<div class="listingblock">
<div class="content">
<pre><tt>--- !ruby/object:Post
attributes:
updated_at: 2008-09-05 22:55:47
body: It's a very helpful guide for debugging your Rails app.
title: Rails debugging guide
published: t
id: "1"
created_at: 2008-09-05 22:55:47
attributes_cache: {}

Title: Rails debugging guide</tt></pre>
</div></div>
<h3 id="_inspect">1.3. inspect</h3>
<div class="paragraph"><p>Kolejna użyteczna metoda wykorzystywana do wyświetlania wartości obiektu to <tt>inspect</tt>, szczególnie podczas pracy z tablicami lub tablicami asocjacyjnymi. Wyświetli to wartość obiektu jako string. Na przykład:</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 2.11
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt>&lt;%= [1, 2, 3, 4, 5].inspect %&gt;
<span style="font-weight: bold"><span style="color: #0000FF">&lt;p&gt;</span></span>
  <span style="font-weight: bold"><span style="color: #0000FF">&lt;b&gt;</span></span>Title:<span style="font-weight: bold"><span style="color: #0000FF">&lt;/b&gt;</span></span>
  &lt;%=h @post.title %&gt;
<span style="font-weight: bold"><span style="color: #0000FF">&lt;/p&gt;</span></span></tt></pre></div></div>
<div class="paragraph"><p>Będzie wyświetlone jako:</p></div>
<div class="listingblock">
<div class="content">
<pre><tt>[1, 2, 3, 4, 5]

Title: Rails debugging guide</tt></pre>
</div></div>
<h3 id="_debugging_javascript">1.4. Debugging Javascript</h3>
<div class="paragraph"><p>Railsy posiadają wbudowane wspomaganie debugowania RJS. By je aktywować, ustaw  <tt>ActionView::Base.debug_rjs</tt> jako <em>true</em>, to określi czy odpowiedzi RJS powinni być objęte blokiem try/catch i zaalarmować o złapanym wyjątku.</p></div>
<div class="paragraph"><p>Aby to umożliwić, dodaj poniższy kod w bloku <tt>Rails::Initializer do |config|</tt> wewnątrz <tt>environment.rb</tt>:</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 2.11
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt>config<span style="color: #990000">.</span>action_view<span style="color: #990000">[:</span>debug_rjs<span style="color: #990000">]</span> <span style="color: #990000">=</span> <span style="font-weight: bold"><span style="color: #0000FF">true</span></span></tt></pre></div></div>
<div class="paragraph"><p>Lub, w dowolnym momencie, ustaw <tt>ActionView::Base.debug_rjs</tt> jako <em>true</em>:</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 2.11
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt>ActionView<span style="color: #990000">::</span>Base<span style="color: #990000">.</span>debug_rjs <span style="color: #990000">=</span> <span style="font-weight: bold"><span style="color: #0000FF">true</span></span></tt></pre></div></div>
<div class="admonitionblock">
<table><tr>
<td class="icon">
<img src="./images/icons/tip.png" alt="Tip" />
</td>
<td class="content">Po więcej informacji z zakresu debugowania języka javascript odsyłamy do <a href="http://getfirebug.com/">Firebug&#8217;a</a>, popularnego debuggera przeglądarki Firefox.</td>
</tr></table>
</div>
</div>
<h2 id="_logger">2. Logger</h2>
<div class="sectionbody">
<div class="paragraph"><p>Użyteczne może być również zapisywanie informacji do plików log w czasie pracy. Railsy zachowują oddzielny log dla każdego środowiska uruchomieniowego.</p></div>
<h3 id="_czym_jest_logger">2.1. Czym jest Logger?</h3>
<div class="paragraph"><p>Railsy wykorzystują standardowy <tt>logger</tt> języka Ruby by zapisywać informację w logach. Możesz również zastąpić go innym loggerem, jak na przykład <tt>Log4R</tt> jeśli chcesz.</p></div>
<div class="paragraph"><p>Możesz sprecyzować alternatywny logger w twoim <tt>environment.rb</tt> bądź jakimkolwiek pliku środowiska:</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 2.11
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt>ActiveRecord<span style="color: #990000">::</span>Base<span style="color: #990000">.</span>logger <span style="color: #990000">=</span> Logger<span style="color: #990000">.</span>new<span style="color: #990000">(</span>STDOUT<span style="color: #990000">)</span>
ActiveRecord<span style="color: #990000">::</span>Base<span style="color: #990000">.</span>logger <span style="color: #990000">=</span> Log4r<span style="color: #990000">::</span>Logger<span style="color: #990000">.</span>new<span style="color: #990000">(</span><span style="color: #FF0000">"Application Log"</span><span style="color: #990000">)</span></tt></pre></div></div>
<div class="paragraph"><p>Lub w sekcji <tt>Initializer</tt>, dodaj <em>dowolny</em> z poniższych:</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 2.11
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt>config<span style="color: #990000">.</span>logger <span style="color: #990000">=</span> Logger<span style="color: #990000">.</span>new<span style="color: #990000">(</span>STDOUT<span style="color: #990000">)</span>
config<span style="color: #990000">.</span>logger <span style="color: #990000">=</span> Log4r<span style="color: #990000">::</span>Logger<span style="color: #990000">.</span>new<span style="color: #990000">(</span><span style="color: #FF0000">"Application Log"</span><span style="color: #990000">)</span></tt></pre></div></div>
<div class="admonitionblock">
<table><tr>
<td class="icon">
<img src="./images/icons/tip.png" alt="Tip" />
</td>
<td class="content">Domyślnie, każdy log jest tworzony w katalogu <tt>RAILS_ROOT/log/</tt> a jego nazwa to <tt>environment_name.log</tt>.</td>
</tr></table>
</div>
<h3 id="_poziomy_log_w">2.2. Poziomy logów</h3>
<div class="paragraph"><p>Gdy coś jest logowane, jest wpisywane do odpowiadającego loga jeśli poziom
logowania tej wiadomości jest równy lub wyższy niż skonfigurowany poziom
loggera. Jeśli chcesz znać aktualny poziom loggera, możesz wykorzystać metodę  <tt>ActiveRecord::Base.logger.level</tt>.</p></div>
<div class="paragraph"><p>Dostępne poziomy logowania to: <tt>:debug</tt>, <tt>:info</tt>, <tt>:warn</tt>, <tt>:error</tt>, and <tt>:fatal</tt>, odpowiadające numerom poziomów logowania odpowiednio od 0 do 4. By zmienić domyślny poziom logowania, użyj</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 2.11
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt>config<span style="color: #990000">.</span>log_level <span style="color: #990000">=</span> Logger<span style="color: #990000">::</span>WARN <span style="font-style: italic"><span style="color: #9A1900"># W dowolnym inicjalizatorze środowiska lub</span></span>
ActiveRecord<span style="color: #990000">::</span>Base<span style="color: #990000">.</span>logger<span style="color: #990000">.</span>level <span style="color: #990000">=</span> <span style="color: #993399">0</span> <span style="font-style: italic"><span style="color: #9A1900"># w dowolnej chwili</span></span></tt></pre></div></div>
<div class="paragraph"><p>Jest to użyteczne, gdy chcesz logować w środowisku programisty (development) lub
przejściowym (staging), ale nie chcesz zaśmiecać loga  nieistotnymi
informacjami w środowisku produkcyjnym.</p></div>
<div class="admonitionblock">
<table><tr>
<td class="icon">
<img src="./images/icons/tip.png" alt="Tip" />
</td>
<td class="content">Domyślny poziom logów w Rails to  <tt>info</tt> dla trybu produkcyjnego oraz
<tt>debug</tt> dla programowania i testowego.</td>
</tr></table>
</div>
<h3 id="_wysy_anie_wiadomo_ci">2.3. Wysyłanie wiadomości</h3>
<div class="paragraph"><p>By pisać w aktualnym logu, użyj metody <tt>logger.(debug|info|warn|error|fatal)</tt> z kontrolera, modelu lub mailera:</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 2.11
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt>logger<span style="color: #990000">.</span>debug <span style="color: #FF0000">"Person attributes hash: #{@person.attributes.inspect}"</span>
logger<span style="color: #990000">.</span>info <span style="color: #FF0000">"Processing the request..."</span>
logger<span style="color: #990000">.</span>fatal <span style="color: #FF0000">"Terminating application, raised unrecoverable error!!!"</span></tt></pre></div></div>
<div class="paragraph"><p>Oto przykład metody wyposażonej w dodatkowe logowanie:</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 2.11
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="font-weight: bold"><span style="color: #0000FF">class</span></span> PostsController <span style="color: #990000">&lt;</span> ApplicationController
  <span style="font-style: italic"><span style="color: #9A1900"># ...</span></span>

  <span style="font-weight: bold"><span style="color: #0000FF">def</span></span> create
    <span style="color: #009900">@post</span> <span style="color: #990000">=</span> Post<span style="color: #990000">.</span>new<span style="color: #990000">(</span>params<span style="color: #990000">[:</span>post<span style="color: #990000">])</span>
    logger<span style="color: #990000">.</span>debug <span style="color: #FF0000">"New post: #{@post.attributes.inspect}"</span>
    logger<span style="color: #990000">.</span>debug <span style="color: #FF0000">"Post should be valid: #{@post.valid?}"</span>

    <span style="font-weight: bold"><span style="color: #0000FF">if</span></span> <span style="color: #009900">@post</span><span style="color: #990000">.</span>save
      flash<span style="color: #990000">[:</span>notice<span style="color: #990000">]</span> <span style="color: #990000">=</span> <span style="color: #FF0000">'Post was successfully created.'</span>
      logger<span style="color: #990000">.</span>debug <span style="color: #FF0000">"The post was saved and now is the user is going to be redirected..."</span>
      redirect_to<span style="color: #990000">(</span><span style="color: #009900">@post</span><span style="color: #990000">)</span>
    <span style="font-weight: bold"><span style="color: #0000FF">else</span></span>
      render <span style="color: #990000">:</span>action <span style="color: #990000">=&gt;</span> <span style="color: #FF0000">"new"</span>
    <span style="font-weight: bold"><span style="color: #0000FF">end</span></span>
  <span style="font-weight: bold"><span style="color: #0000FF">end</span></span>

  <span style="font-style: italic"><span style="color: #9A1900"># ...</span></span>
<span style="font-weight: bold"><span style="color: #0000FF">end</span></span></tt></pre></div></div>
<div class="paragraph"><p>Oraz przykład loga wygenerowanego przez tę metodę:</p></div>
<div class="listingblock">
<div class="content">
<pre><tt>Processing PostsController#create (for 127.0.0.1 at 2008-09-08 11:52:54) [POST]
  Session ID: BAh7BzoMY3NyZl9pZCIlMDY5MWU1M2I1ZDRjODBlMzkyMWI1OTg2NWQyNzViZjYiCmZsYXNoSUM6J0FjdGl
vbkNvbnRyb2xsZXI6OkZsYXNoOjpGbGFzaEhhc2h7AAY6CkB1c2VkewA=--b18cd92fba90eacf8137e5f6b3b06c4d724596a4
  Parameters: {"commit"=&gt;"Create", "post"=&gt;{"title"=&gt;"Debugging Rails",
 "body"=&gt;"I'm learning how to print in logs!!!", "published"=&gt;"0"},
 "authenticity_token"=&gt;"2059c1286e93402e389127b1153204e0d1e275dd", "action"=&gt;"create", "controller"=&gt;"posts"}
New post: {"updated_at"=&gt;nil, "title"=&gt;"Debugging Rails", "body"=&gt;"I'm learning how to print in logs!!!",
 "published"=&gt;false, "created_at"=&gt;nil}
Post should be valid: true
  Post Create (0.000443)   INSERT INTO "posts" ("updated_at", "title", "body", "published",
 "created_at") VALUES('2008-09-08 14:52:54', 'Debugging Rails',
 'I''m learning how to print in logs!!!', 'f', '2008-09-08 14:52:54')
The post was saved and now is the user is going to be redirected...
Redirected to #&lt;Post:0x20af760&gt;
Completed in 0.01224 (81 reqs/sec) | DB: 0.00044 (3%) | 302 Found [http://localhost/posts]</tt></pre>
</div></div>
<div class="paragraph"><p>Ustawianie takiego dodatkowego logowania ułatwia wyszukiwanie nieoczekiwanego bądź odstającego od normy zachowania w twoich logach. Jeśli wykorzystasz dodatkowe logowanie, pamiętaj o ostrożnym używaniu poziomów logowania, by uniknąć zapełniania twoich logów produkcyjnych bezużytecznymi drobiazgami.</p></div>
</div>
<h2 id="_debugowanie_z_u_yciem_ruby_debug">3. Debugowanie z użyciem ruby-debug</h2>
<div class="sectionbody">
<div class="paragraph"><p>Gdy twój kod zachowuje się nie tak, jak powinien, możesz spróbować
raportowania do logów lub konsoli by zdiagnozować problem. Niestety zdarza
się, że ten sposób wyszukiwania błędów jest nieefektywny przy znajdywaniu głównej przyczyny problemu. Jeśli faktycznie musisz wybrać się w podróż do wnętrza twojego działającego kodu źródłowego, debugger będzie twoim najlepszym współtowarzyszem.</p></div>
<div class="paragraph"><p>Debugger może również pomóc ci jeśli chcesz dowiedzieć się o kodzie źródłowym Rails i nie wiesz, gdzie zacząć. Po prostu zdebuguj dowolne żądanie w twojej aplikacji i użyj tego przewodnika by dowiedzieć się jak przejść z napisanego przez siebie kodu głębiej w kod źródłowy Rails.</p></div>
<h3 id="_instalacja">3.1. Instalacja</h3>
<div class="paragraph"><p>Debugger używany przez Railsy, <tt>ruby-debug</tt>, jest instalowany jako gem. By go zainstalować, po prostu uruchom:</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 2.11
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt>$ sudo gem install ruby-debug</tt></pre></div></div>
<div class="paragraph"><p>Jeśli chcesz ściągnąć konkretną wersję lub zdobyć kod źródłowy, sprawdź <a href="http://rubyforge.org/projects/ruby-debug/">stronę projektu na rubyforge</a>.</p></div>
<div class="paragraph"><p>Railsy posiadają wbudowane wspomaganie dla ruby-debug począwszy od wersji 2.0. W dowolnej Railsowej aplikacji możesz przywołać debugger używając metody <tt>debugger</tt>.</p></div>
<div class="paragraph"><p>Oto przykład:</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 2.11
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="font-weight: bold"><span style="color: #0000FF">class</span></span> PeopleController <span style="color: #990000">&lt;</span> ApplicationController
  <span style="font-weight: bold"><span style="color: #0000FF">def</span></span> new
    debugger
    <span style="color: #009900">@person</span> <span style="color: #990000">=</span> Person<span style="color: #990000">.</span>new
  <span style="font-weight: bold"><span style="color: #0000FF">end</span></span>
<span style="font-weight: bold"><span style="color: #0000FF">end</span></span></tt></pre></div></div>
<div class="paragraph"><p>Jeśli zobaczysz w konsoli lub w logach wiadomość:</p></div>
<div class="listingblock">
<div class="content">
<pre><tt>***** Debugger requested, but was not available: Start server with --debugger to enable *****</tt></pre>
</div></div>
<div class="paragraph"><p>Upewnij się, że uruchomiłeś swój serwer sieciowy z opcją  <tt>--debugger</tt>:</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 2.11
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="color: #990000">~</span>/PathTo/rails_project$ script/server --debugger
<span style="color: #990000">=&gt;</span> Booting Mongrel <span style="color: #990000">(</span>use <span style="color: #FF0000">'script/server webrick'</span> to force WEBrick<span style="color: #990000">)</span>
<span style="color: #990000">=&gt;</span> Rails <span style="color: #993399">2.2</span><span style="color: #990000">.</span><span style="color: #993399">0</span> application starting on http<span style="color: #990000">://</span><span style="color: #993399">0.0</span><span style="color: #990000">.</span><span style="color: #993399">0.0</span><span style="color: #990000">:</span><span style="color: #993399">3000</span>
<span style="color: #990000">=&gt;</span> Debugger enabled
<span style="color: #990000">...</span></tt></pre></div></div>
<div class="admonitionblock">
<table><tr>
<td class="icon">
<img src="./images/icons/tip.png" alt="Tip" />
</td>
<td class="content">W trybie programowania, możesz dynamicznie wymóc <tt>require "ruby-debug"</tt> zamiast restartować serwer, jeśli został uruchomiony bez opcji <tt>--debugger</tt>.</td>
</tr></table>
</div>
<div class="paragraph"><p>W celu skorzystania z debuggingu Rails musisz mieć uruchomiony albo serwer <strong>WEBrick</strong> albo <strong>Mongrel</strong>. Na dzień dzisiejszy inne alternatywne serwery nie są obsługiwane.</p></div>
<h3 id="_pow_oka">3.2. Powłoka</h3>
<div class="paragraph"><p>Gdy tylko twoja aplikacja przywoła metodę  <tt>debugger</tt>, debugger zostanie uruchomiony w powłoce w oknie terminala, w którym uruchomiłeś swój serwer i zostaniesz przeniesiony do znaku zachęty (ang. prompt) ruby-debug <tt>(rdb:n)</tt>. Owe <em>n</em> jest numerem wątku. Znak zachęty pokaże ci również kolejną linijkę kodu oczekującą na uruchomienie.</p></div>
<div class="paragraph"><p>Jeśli dostałeś się tam poprzez żądanie przeglądarki, okno przeglądarki
zawierające żądanie pozostanie zawieszone dopóki debugger nie zostanie
zakończony oraz przetwarzanie całego żądania nie zostanie ukończone.</p></div>
<div class="paragraph"><p>Na przykład:</p></div>
<div class="listingblock">
<div class="content">
<pre><tt>@posts = Post.find(:all)
(rdb:7)</tt></pre>
</div></div>
<div class="paragraph"><p>Teraz pora na zbadanie i przekopanie twojej aplikacji. Dobrym początkiem będzie zapytanie debuggera o pomoc... wpisz więc:  <tt>help</tt> (Nikt by się nie domyślił, nieprawdaż?)</p></div>
<div class="listingblock">
<div class="content">
<pre><tt>(rdb:7) help
ruby-debug help v0.10.2
Type 'help &lt;command-name&gt;' for help on a specific command

Available commands:
backtrace  delete   enable  help    next  quit     show    trace
break      disable  eval    info    p     reload   source  undisplay
catch      display  exit    irb     pp    restart  step    up
condition  down     finish  list    ps    save     thread  var
continue   edit     frame   method  putl  set      tmate   where</tt></pre>
</div></div>
<div class="admonitionblock">
<table><tr>
<td class="icon">
<img src="./images/icons/tip.png" alt="Tip" />
</td>
<td class="content">By zobaczyć menu pomocy dla dowolnej komendy użyj <tt>help &lt;command-name&gt;</tt> w
aktywnym trybie debugowania. Na przykład: <tt>help var</tt></td>
</tr></table>
</div>
<div class="paragraph"><p>Kolejna komenda to jedna z najbardziej użytecznych: <tt>list</tt>. Możesz również skrócić komendy ruby-debug poprzez zapewnienie ilości liter wystarczającej do odróżnienia ich od pozostałych komend - możesz więc użyć tylko <tt>l</tt> dla komendy <tt>list</tt>.</p></div>
<div class="paragraph"><p>Ta komenda informuje cię, gdzie jesteś w kodzie poprzez wyświetlenie 10 linii kodu wokół aktualnej linijki; w poniższym przypadku owa aktualna linijka to linia 6, oznaczona <tt>=&gt;</tt>.</p></div>
<div class="listingblock">
<div class="content">
<pre><tt>(rdb:7) list
[1, 10] in /PathToProject/posts_controller.rb
   1  class PostsController &lt; ApplicationController
   2    # GET /posts
   3    # GET /posts.xml
   4    def index
   5      debugger
=&gt; 6      @posts = Post.find(:all)
   7
   8      respond_to do |format|
   9        format.html # index.html.erb
   10        format.xml  { render :xml =&gt; @posts }</tt></pre>
</div></div>
<div class="paragraph"><p>Jeśli powtórzysz komendę <tt>list</tt>, tym razem używając tylko <tt>l</tt>, zwrócone zostanie kolejne 10 linijek kodu:</p></div>
<div class="listingblock">
<div class="content">
<pre><tt>(rdb:7) l
[11, 20] in /PathTo/project/app/controllers/posts_controller.rb
   11      end
   12    end
   13
   14    # GET /posts/1
   15    # GET /posts/1.xml
   16    def show
   17      @post = Post.find(params[:id])
   18
   19      respond_to do |format|
   20        format.html # show.html.erb</tt></pre>
</div></div>
<div class="paragraph"><p>I tak dalej aż do końca pliku. Kiedy koniec pliku zostanie osiągnięty, komenda <tt>list</tt> zacznie znów od początku pliku i będzie kontynuować ponownie do jego końca, traktując go jak zapętlony bufor.</p></div>
<h3 id="_kontekst">3.3. Kontekst</h3>
<div class="paragraph"><p>Gdy rozpoczniesz debugowanie swojej aplikacji, będziesz umieszczany w różnych kontekstach w miarę przemieszczania się przez różne części stosu.</p></div>
<div class="paragraph"><p>ruby-debug tworzy kontekst, gdy osiąga punkt wstrzymania bądź zdarzenie. Kontekst posiada informacje o zawieszonym programie, co pozwala debuggerowi zbadać stos oraz oszacować zmienne z perspektywy debugowanego programu. Posiada również informacje o miejscu, w którym debugger został zatrzymany.</p></div>
<div class="paragraph"><p>Zawszy możesz użyć komendy <tt>backtrace</tt> (bądź jej aliasu <tt>where</tt>) by wyświetlić
wsteczny przebieg aplikacji. Może być to bardzo pomocne w przekonaniu się, jak
dostałeś się w miejsce, w którym się znajdujesz. Jeśli kiedykolwiek zastanawiałeś się, jak znalazłeś się w danym miejscu kodu, komenda <tt>backtrace</tt> zapewni odpowiedź.</p></div>
<div class="listingblock">
<div class="content">
<pre><tt>(rdb:5) where
    #0 PostsController.index
       at line /PathTo/project/app/controllers/posts_controller.rb:6
    #1 Kernel.send
       at line /PathTo/project/vendor/rails/actionpack/lib/action_controller/base.rb:1175
    #2 ActionController::Base.perform_action_without_filters
       at line /PathTo/project/vendor/rails/actionpack/lib/action_controller/base.rb:1175
    #3 ActionController::Filters::InstanceMethods.call_filters(chain#ActionController::Fil...,...)
       at line /PathTo/project/vendor/rails/actionpack/lib/action_controller/filters.rb:617
...</tt></pre>
</div></div>
<div class="paragraph"><p>Możesz poruszać się gdzie tylko chcesz w tym stosie wywołań (tym samym
zmieniając kontekst) używając komendy <tt>frame <em>n</em></tt>, gdzie <em>n</em> to określony numer ramki.</p></div>
<div class="listingblock">
<div class="content">
<pre><tt>(rdb:5) frame 2
#2 ActionController::Base.perform_action_without_filters
       at line /PathTo/project/vendor/rails/actionpack/lib/action_controller/base.rb:1175</tt></pre>
</div></div>
<div class="paragraph"><p>Dostępne zmienne są takie same, jak gdybyś uruchamiał kod linijka za linijką. O to w końcu chodzi w debugowaniu.</p></div>
<div class="paragraph"><p>Poruszanie się w górę i w dół stosu: Możesz użyć <tt>up [n]</tt> (w skrócie <tt>u</tt>)
oraz <tt>down [n]</tt> w celu zmiany kontekstu o <em>n</em> ramek odpowiednio w górę lub w dół
stosu. <em>n</em> to domyślnie jeden. "W górę" to w tym przypadku w kierunku ramki o
wyższym numerze, zaś "w dół"- w kierunku ramki o niższym.</p></div>
<h3 id="_w_tki">3.4. Wątki</h3>
<div class="paragraph"><p>Debugger może sporządzić listę, zatrzymać, przywrócić oraz przełączać się
pomiędzy działającymi wątkami z użyciem komendy <tt>thread</tt> (lub skrócone <tt>th</tt>). Ta komenda posiada wiele opcji:</p></div>
<div class="ulist"><ul>
<li>
<p>
<tt>thread</tt> pokazuje aktualny wątek
</p>
</li>
<li>
<p>
<tt>thread list</tt> jest używana do utworzenia listy wszystkich wątków oraz ich statusów. Znak plus + oraz numer oznacza aktualnie wykonywany wątek
</p>
</li>
<li>
<p>
<tt>thread stop <em>n</em></tt> zatrzymuje wątek <em>n</em>
</p>
</li>
<li>
<p>
<tt>thread resume <em>n</em></tt> przywraca wątek <em>n</em> do działania
</p>
</li>
<li>
<p>
<tt>thread switch <em>n</em></tt> zmienia kontekst aktualnego wątku na <em>n</em>
</p>
</li>
</ul></div>
<div class="paragraph"><p>Ta komenda jest bardzo pomocna na przykład (spośród wielu różnych sytuacji)
gdy debugujesz równoczesne wątki i musisz upewnić się, że nie ma <em>sytuacji
wyścigu</em> (race conditions) w twoim kodzie.</p></div>
<h3 id="_sprawdzanie_zmiennych">3.5. Sprawdzanie zmiennych</h3>
<div class="paragraph"><p>Dowolne wyrażenie może być ocenione w aktualnym kontekście. By oszacować wyrażenie, po prostu wpisz je!</p></div>
<div class="paragraph"><p>Ten przykład pokazuje, jak można wyświetlić zmienne instancyjne zdefiniowane w aktualnym kontekście:</p></div>
<div class="listingblock">
<div class="content">
<pre><tt>@posts = Post.find(:all)
(rdb:11) instance_variables
["@_response", "@action_name", "@url", "@_session", "@_cookies", "@performed_render", "@_flash", "@template", "@_params", "@before_filter_chain_aborted", "@request_origin", "@_headers", "@performed_redirect", "@_request"]</tt></pre>
</div></div>
<div class="paragraph"><p>Jak mogłeś się domyślić, wszystkie zmienne, do których możesz dotrzeć z
kontrolera, są wyświetlane. Lista ta jest na bieżąco aktualizowana w miarę jak
przeprowadzasz działanie kodu. Na przykład, uruchom kolejną linię używając
<tt>next</tt> (dowiesz się więcej o tej komendzie w dalszej części przewodnika).</p></div>
<div class="listingblock">
<div class="content">
<pre><tt>(rdb:11) next
Processing PostsController#index (for 127.0.0.1 at 2008-09-04 19:51:34) [GET]
  Session ID: BAh7BiIKZmxhc2hJQzonQWN0aW9uQ29udHJvbGxlcjo6Rmxhc2g6OkZsYXNoSGFzaHsABjoKQHVzZWR7AA==--b16e91b992453a8cc201694d660147bba8b0fd0e
  Parameters: {"action"=&gt;"index", "controller"=&gt;"posts"}
/PathToProject/posts_controller.rb:8
respond_to do |format|</tt></pre>
</div></div>
<div class="paragraph"><p>A następnie spytaj ponownie o zmienne instancyjne:</p></div>
<div class="listingblock">
<div class="content">
<pre><tt>(rdb:11) instance_variables.include? "@posts"
true</tt></pre>
</div></div>
<div class="paragraph"><p>Teraz <tt>@posts</tt> jest zawarty w zmiennych instancyjnych, bo linia go definiująca została wykonana</p></div>
<div class="admonitionblock">
<table><tr>
<td class="icon">
<img src="./images/icons/tip.png" alt="Tip" />
</td>
<td class="content">Możesz również przejść do trybu irb komendą (oczywiście!) irb. W ten sposób
sesja irb zostanie uaktywniona w kontekście, w którym ją wywołałeś. Uwaga - jest to póki co opcja eksperymentalna.</td>
</tr></table>
</div>
<div class="paragraph"><p>Metoda <tt>var</tt> to najwygodniejszy sposób wyświetlania zmiennych i ich wartości:</p></div>
<div class="listingblock">
<div class="content">
<pre><tt>var
(rdb:1) v[ar] const &lt;object&gt;            show constants of object
(rdb:1) v[ar] g[lobal]                  show global variables
(rdb:1) v[ar] i[nstance] &lt;object&gt;       show instance variables of object
(rdb:1) v[ar] l[ocal]                   show local variables</tt></pre>
</div></div>
<div class="paragraph"><p>Świetny sposób sprawdzania wartości zmiennych aktualnego kontekstu. Na przykład:</p></div>
<div class="listingblock">
<div class="content">
<pre><tt>(rdb:9) var local
  __dbg_verbose_save =&gt; false</tt></pre>
</div></div>
<div class="paragraph"><p>Możesz w ten sposób dokonać również inspekcji obiektu:</p></div>
<div class="listingblock">
<div class="content">
<pre><tt>(rdb:9) var instance Post.new
@attributes = {"updated_at"=&gt;nil, "body"=&gt;nil, "title"=&gt;nil, "published"=&gt;nil, "created_at"...
@attributes_cache = {}
@new_record = true</tt></pre>
</div></div>
<div class="admonitionblock">
<table><tr>
<td class="icon">
<img src="./images/icons/tip.png" alt="Tip" />
</td>
<td class="content">Komendy p (print) oraz pp (pretty print) mogą być użyte do oszacowania wyrażeń Ruby i wyświetlania wartości zmiennych w konsoli.</td>
</tr></table>
</div>
<div class="paragraph"><p>Możesz też użyć <tt>display</tt> by zacząć oglądać zmienne. To dobry sposób śledzenia wartości zmiennych w miarę jak wykonywanie programu postępuje.</p></div>
<div class="listingblock">
<div class="content">
<pre><tt>(rdb:1) display @recent_comments
1: @recent_comments =</tt></pre>
</div></div>
<div class="paragraph"><p>Wyświetlane zmienne podane będą ze swymi wartościami po tym jak przejdziesz po
stosie. By wyłączyć wyświetlanie zmiennej, użyj <tt>undisplay <em>n</em></tt> gdzie <em>n</em> to numer
zmiennej (1 w poprzednim przykładzie).</p></div>
<h3 id="_krok_po_kroku">3.6. Krok po kroku</h3>
<div class="paragraph"><p>Teraz powinieneś wiedzieć, w którym miejscu wykonywanego programu jesteś i być w stanie wyświetlić dostępne zmienne. Idźmy więc dalej z wykonywaniem aplikacji.</p></div>
<div class="paragraph"><p>Użyj <tt>step</tt> (w skrócie <tt>s</tt>) aby kontynuować działanie programu do następnego logicznego punktu wstrzymania i przywróć kontrolę ruby-debug.</p></div>
<div class="admonitionblock">
<table><tr>
<td class="icon">
<img src="./images/icons/tip.png" alt="Tip" />
</td>
<td class="content">Możesz też użyć <tt>step+ n</tt> oraz <tt>step- n</tt> by poruszyć się odpowiednio naprzód lub wstecz o n kroków.</td>
</tr></table>
</div>
<div class="paragraph"><p>Możesz też użyć <tt>next</tt>, które jest analogiczne do <tt>step</tt>, ale funkcje lub
wywołania metod, które pojawiają się w linijce kodu są wykonywane bez zatrzymania. Tak jak przy step, możesz używać znaku plus by przejść o n kroków.</p></div>
<div class="paragraph"><p>Różnia między <tt>next</tt> i <tt>step</tt> jest taka, iż <tt>step</tt> zatrzymuje się w następnej linijce
wykonanego kodu, wykonując po prostu pojedynczy krok, podczas gdy <tt>next</tt>
przechodzi do następnej linii bez zagłębiania się w napotkane metody.</p></div>
<div class="paragraph"><p>Na przykład, przyjrzyjmy się temu blokowi kodu z wywołaniem <tt>debugger</tt>:</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 2.11
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="font-weight: bold"><span style="color: #0000FF">class</span></span> Author <span style="color: #990000">&lt;</span> ActiveRecord<span style="color: #990000">::</span>Base
  has_one <span style="color: #990000">:</span>editorial
  has_many <span style="color: #990000">:</span>comments

  <span style="font-weight: bold"><span style="color: #0000FF">def</span></span> find_recent_comments<span style="color: #990000">(</span>limit <span style="color: #990000">=</span> <span style="color: #993399">10</span><span style="color: #990000">)</span>
    debugger
    <span style="color: #009900">@recent_comments</span> <span style="color: #990000">||=</span> comments<span style="color: #990000">.</span>find<span style="color: #990000">(</span>
      <span style="color: #990000">:</span>all<span style="color: #990000">,</span>
      <span style="color: #990000">:</span>conditions <span style="color: #990000">=&gt;</span> <span style="color: #990000">[</span><span style="color: #FF0000">"created_at &gt; ?"</span><span style="color: #990000">,</span> <span style="color: #993399">1</span><span style="color: #990000">.</span>week<span style="color: #990000">.</span>ago<span style="color: #990000">],</span>
      <span style="color: #990000">:</span>limit <span style="color: #990000">=&gt;</span> limit
    <span style="color: #990000">)</span>
  <span style="font-weight: bold"><span style="color: #0000FF">end</span></span>
<span style="font-weight: bold"><span style="color: #0000FF">end</span></span></tt></pre></div></div>
<div class="admonitionblock">
<table><tr>
<td class="icon">
<img src="./images/icons/tip.png" alt="Tip" />
</td>
<td class="content">Możesz używać ruby-debug podczas używania <tt>script/console</tt>. Pamiętaj tylko o
<tt>require "ruby-debug"</tt> przed użyciem metody <tt>debugger</tt>.</td>
</tr></table>
</div>
<div class="listingblock">
<div class="content">
<pre><tt>/PathTo/project $ script/console
Loading development environment (Rails 2.1.0)
&gt;&gt; require "ruby-debug"
=&gt; []
&gt;&gt; author = Author.first
=&gt; #&lt;Author id: 1, first_name: "Bob", last_name: "Smith", created_at: "2008-07-31 12:46:10", updated_at: "2008-07-31 12:46:10"&gt;
&gt;&gt; author.find_recent_comments
/PathTo/project/app/models/author.rb:11
)</tt></pre>
</div></div>
<div class="paragraph"><p>Po zatrzymaniu kodu, rozejrzyjmy się w nim:</p></div>
<div class="listingblock">
<div class="content">
<pre><tt>(rdb:1) list
[6, 15] in /PathTo/project/app/models/author.rb
   6      debugger
   7      @recent_comments ||= comments.find(
   8        :all,
   9        :conditions =&gt; ["created_at &gt; ?", 1.week.ago],
   10        :limit =&gt; limit
=&gt; 11      )
   12    end
   13  end</tt></pre>
</div></div>
<div class="paragraph"><p>Jesteś na końcu linii, ale... czy linia ta została wykonana? Możesz sprawdzić zmienne instancyjne.</p></div>
<div class="listingblock">
<div class="content">
<pre><tt>(rdb:1) var instance
@attributes = {"updated_at"=&gt;"2008-07-31 12:46:10", "id"=&gt;"1", "first_name"=&gt;"Bob", "las...
@attributes_cache = {}</tt></pre>
</div></div>
<div class="paragraph"><p><tt>@recent_comments</tt> nie zostało jeszcze zdefiniowane, więc jest oczywiste, że
linia ta nie została jeszcze wykonana. Użyj komendy <tt>next</tt> by poruszać się w kodzie:</p></div>
<div class="listingblock">
<div class="content">
<pre><tt>(rdb:1) next
/PathTo/project/app/models/author.rb:12
@recent_comments
(rdb:1) var instance
@attributes = {"updated_at"=&gt;"2008-07-31 12:46:10", "id"=&gt;"1", "first_name"=&gt;"Bob", "las...
@attributes_cache = {}
@comments = []
@recent_comments = []</tt></pre>
</div></div>
<div class="paragraph"><p>Teraz widzisz, że relacja <tt>@comments</tt> została załadowana i <tt>@recent_comments</tt> zdefiniowane poprzez wykonanie kodu w tej linijce.</p></div>
<div class="paragraph"><p>Jeśli chcesz bardziej zagłębić się w stosie możesz poruszać się pojedynczymi
krokami, przez twoje wywoływane metody, a także do wnętrza kodu Railsów. To jeden z najlepszych sposobów do wyszukiwania błędów w twoim kodzie albo, być może, w Ruby lub Rails.</p></div>
<h3 id="_breakpointy">3.7. Breakpointy</h3>
<div class="paragraph"><p>Breakpoint zatrzymuje twoją aplikację gdy tylko określony punkt programu
zostanie osiągnięty. W tej linii uruchamiana jest konsola debuggera.</p></div>
<div class="paragraph"><p>Możesz dodawać breakpointy na bieżąco komendą <tt>break</tt> (lub po prostu <tt>b</tt>). Są 3 metody dodawania breakpointów ręcznie:</p></div>
<div class="ulist"><ul>
<li>
<p>
<tt>break line</tt>: ustawia breakpoint w <em>line</em> w aktualnym pliku źródłowym
</p>
</li>
<li>
<p>
<tt>break file:line [if expression]</tt>: ustawia breakpoint w linii o numerze
</p>
</li>
<li>
<p>
<em>line</em>  wewnątrz pliku <em>file</em>. Jeśli wyrażenie <em>expression</em> jest podane,
   musi ewaluować się  na <em>true</em> by uruchomić debugger
</p>
</li>
<li>
<p>
<tt>break class(.|#)method [if expression]</tt>: ustawia breakpoint w metodzie
  <em>method</em> (. oraz \# odpowiednio dla metody klasowej i instancyjnej)
  zdefiniowanej w klasie <em>class</em>. <em>expression</em> działa tak samo, jak przy <tt>file:line</tt>
</p>
</li>
</ul></div>
<div class="listingblock">
<div class="content">
<pre><tt>(rdb:5) break 10
Breakpoint 1 file /PathTo/project/vendor/rails/actionpack/lib/action_controller/filters.rb, line 10</tt></pre>
</div></div>
<div class="paragraph"><p>Użyj <tt>info breakpoints <em>n</em></tt> lub <tt>info break <em>n</em></tt> by wyświetlić breakpointy. Jeśli podasz liczbę, wyświetli breakpoint o danym numerze. W innym przypadku wyświetlone zostaną wszystkie breakpointy.</p></div>
<div class="listingblock">
<div class="content">
<pre><tt>(rdb:5) info breakpoints
Num Enb What
  1 y   at filters.rb:10</tt></pre>
</div></div>
<div class="paragraph"><p>By usuwać breakpointy: użyj komendy <tt>delete n</tt> by usunąć breakpoint numer <em>n</em>. Jeśli nie zostanie podany numer, komenda usunie wszystkie aktualnie aktywne breakpointy.</p></div>
<div class="listingblock">
<div class="content">
<pre><tt>(rdb:5) delete 1
(rdb:5) info breakpoints
No breakpoints.</tt></pre>
</div></div>
<div class="paragraph"><p>Możesz również umożliwić bądź uniemożliwić działanie breakpointów:</p></div>
<div class="ulist"><ul>
<li>
<p>
<tt>enable breakpoints</tt>: pozwala liście breakpointów lub wszystkim breakpointom, jeśli nie zostanie sprecyzowana lista, zatrzymywać twój program. Jest to stan domyślny, gdy tworzysz nowy breakpoint.
</p>
</li>
<li>
<p>
<tt>disable breakpoints</tt>: breakpointy nie będą wpływać na twój program.
</p>
</li>
</ul></div>
<h3 id="_apanie_wyj_tk_w">3.8. Łapanie wyjątków</h3>
<div class="paragraph"><p>Komenda <tt>catch <em>exception-name</em></tt> (lub po prostu <tt>cat <em>exception-name</em></tt>) może
być użyta do przechwycenia wyjątku typu <em>exception-name</em> jeśli nie byłoby niczego innego, co mogłoby zajmować się danym wyjątkiem.</p></div>
<div class="paragraph"><p>By wyświetlić wszystkie aktywne catchpointy użyj <tt>catch</tt>.</p></div>
<h3 id="_przywracanie_wykonywania">3.9. Przywracanie wykonywania</h3>
<div class="paragraph"><p>Są dwie metody przywrócenia procesu wykonywania aplikacji wstrzymanej w debuggerze:</p></div>
<div class="ulist"><ul>
<li>
<p>
<tt>continue</tt> [numer linii] (lub <tt>c</tt>): przywraca wykonywanie programu w
  miejscu, gdzie twój skrypt ostatnio się zatrzymał; jakiekolwiek breakpointy
  ustawione w tym miejscu są pomijane. Opcjonalny argument "numer linii" pozwala ci ustawić numer linii, gdzie zostanie ustawiony breakpoint jednorazowego użytku (będzie skasowany, gdy zostanie osiągnięty).
</p>
</li>
<li>
<p>
<tt>finish</tt> [numer ramki] (lub <tt>fin</tt>): wykonuje dopóki wskazana ramka stosu nie
  zostanie opuszczona. Jeśli nie zostanie podany "numer ramki", aplikacja
  będzie działać, dopóki aktualnie wybrana ramka nie zostanie opuszczona.
  Aktualnie wybrana ramka oznacza najbliższą ostatnią ramkę lub 0 jeśli żadne
  pozycjonowanie ramek (np. <tt>up</tt>, <tt>down</tt> lub <tt>frame</tt>) nie było wykonywane.
  Jeśli "numer ramki" jest podany program będzie wykonywany do momentu
  opuszczenia owej ramki.
</p>
</li>
</ul></div>
<h3 id="_edytowanie">3.10. Edytowanie</h3>
<div class="paragraph"><p>Dwie komendy pozwalają ci na otwarcie kodu z debuggera w edytorze:</p></div>
<div class="ulist"><ul>
<li>
<p>
<tt>edit [file:line]</tt>: edytuje <em>file</em> używając edytora sprecyzowanego w
  zmiennej środowiskowej EDITOR. Można podać konkretną linię <em>line</em> do edycji.
</p>
</li>
<li>
<p>
<tt>tmate n</tt> (w skrócie <tt>tm</tt>): otwiera aktualny plik w TextMate. Używa n-tej
  ramki, jeśli <em>n</em> jest podane.
</p>
</li>
</ul></div>
<h3 id="_wychodzenie">3.11. Wychodzenie</h3>
<div class="paragraph"><p>By opuścić debugger, użyj komendy <tt>quit</tt> (w skrócie <tt>q</tt>), lub jej aliasu <tt>exit</tt>.</p></div>
<div class="paragraph"><p>Zwykłe wyjście oznacza zakończenie wszystkich aktualnie działających wątków. Tym samym twój serwer zostanie wstrzymany i będziesz musiał uruchomić go ponownie.</p></div>
<h3 id="_ustawienia">3.12. Ustawienia</h3>
<div class="paragraph"><p>Pewne ustawienia mogą zostać skonfigurowane w <tt>ruby-debug</tt> by ułatwić debugowanie twego kodu. Oto kilka dostępnych opcji:</p></div>
<div class="ulist"><ul>
<li>
<p>
<tt>set reload</tt>: ładuje ponownie kod źródłowy, gdy został zmieniony.
</p>
</li>
<li>
<p>
<tt>set autolist</tt>: wykonuje komendę <tt>list</tt> przy każdym breakpoincie.
</p>
</li>
<li>
<p>
<tt>set listsize <em>n</em></tt>: ustawia ilość linii kodu, które będą domyślnie
  wyświetlane przy wywołaniu <tt>list</tt> na <em>n</em>
</p>
</li>
<li>
<p>
<tt>set forcestep</tt>: zapewnia, że komendy <tt>next</tt> oraz <tt>step</tt> zawsze przenoszą do nowej linii.
</p>
</li>
</ul></div>
<div class="paragraph"><p>Możesz zobaczyć pełną listę używając <tt>help set</tt>. Użyj <tt>help set <em>komenda</em></tt>  by
dowiedzieć się o konkretnej komendzie typu <tt>set</tt>.</p></div>
<div class="admonitionblock">
<table><tr>
<td class="icon">
<img src="./images/icons/tip.png" alt="Tip" />
</td>
<td class="content">Możesz zawrzeć dowolną ilość ustawień konfiguracyjnych wewnątrz pliku
<tt>.rdebugrc</tt> w twoim folderze HOME. <tt>ruby-debug</tt> odczyta ten plik za każdym razem, gdy zostanie załadowany i odpowiednio się skonfiguruje.</td>
</tr></table>
</div>
<div class="paragraph"><p>Oto dobry początek <tt>.rdebugrc</tt>:</p></div>
<div class="listingblock">
<div class="content">
<pre><tt>set autolist
set forcestep
set listsize 25</tt></pre>
</div></div>
</div>
<h2 id="_debugowanie_wyciek_w_pami_ci">4. Debugowanie Wycieków Pamięci</h2>
<div class="sectionbody">
<div class="paragraph"><p>Aplikacja Ruby (on Rails lub nie), może mieć czasem wycieki pamięci - zarówno w kodzie Ruby jak i na poziomie kodu C.</p></div>
<div class="paragraph"><p>W tej sekcji dowiesz się jak znaleźć i naprawić takie wycieki używając narzędzi debugujących Bleak House oraz Valgrind.</p></div>
<h3 id="_bleakhouse">4.1. BleakHouse</h3>
<div class="paragraph"><p><a href="http://github.com/fauna/bleak_house/tree/master">BleakHouse</a> to biblioteka służąca do wyszukiwania wycieków pamięci.</p></div>
<div class="paragraph"><p>Jeśli obiekt Ruby nie znika z zasięgu, Ruby Garbage Collector nie usunie go,
gdyż w jakimś miejscu jest do niego odniesienie. Takie wycieki mogą stopniowo
narastać i twoja aplikacja będzie pożerać coraz to więcej pamięci, stopniowo
wpływając na sprawność całego systemu. To narzędzie pozwoli ci znaleźć wycieki
na stercie programu w Rubim.</p></div>
<div class="paragraph"><p>By ją zainstalować, uruchom:</p></div>
<div class="listingblock">
<div class="content">
<pre><tt>sudo gem install bleak_house</tt></pre>
</div></div>
<div class="paragraph"><p>Następnie ustaw swoją aplikację na profilowanie. Dodaj poniższy wpis na dole
<tt>config/environment.rb</tt>:</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 2.11
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="font-weight: bold"><span style="color: #000080">require</span></span> <span style="color: #FF0000">'bleak_house'</span> <span style="font-weight: bold"><span style="color: #0000FF">if</span></span> ENV<span style="color: #990000">[</span><span style="color: #FF0000">'BLEAK_HOUSE'</span><span style="color: #990000">]</span></tt></pre></div></div>
<div class="paragraph"><p>Uruchom serwer z integracją BleakHouse:</p></div>
<div class="listingblock">
<div class="content">
<pre><tt>RAILS_ENV=production BLEAK_HOUSE=1 ruby-bleak-house ./script/server</tt></pre>
</div></div>
<div class="paragraph"><p>Uruchom co najmniej kilkaset żądań w celu uzyskania lepszych próbek danych,
następnie wciśniej CTRL-C. Serwer zostanie wstrzymany i Bleak House stworzy
zrzut pamięci w katalogu /tmp:</p></div>
<div class="listingblock">
<div class="content">
<pre><tt>** BleakHouse: working...
** BleakHouse: complete
** Bleakhouse: run 'bleak /tmp/bleak.5979.0.dump' to analyze.</tt></pre>
</div></div>
<div class="paragraph"><p>By go przeanalizować, po prostu uruchom podane komendy. 20 najbardziej wyciekających linii zostanie podanych:</p></div>
<div class="listingblock">
<div class="content">
<pre><tt>  191691 total objects
  Final heap size 191691 filled, 220961 free
  Displaying top 20 most common line/class pairs
  89513 __null__:__null__:__node__
  41438 __null__:__null__:String
  2348 /opt/local//lib/ruby/site_ruby/1.8/rubygems/specification.rb:557:Array
  1508 /opt/local//lib/ruby/gems/1.8/specifications/gettext-1.90.0.gemspec:14:String
  1021 /opt/local//lib/ruby/gems/1.8/specifications/heel-0.2.0.gemspec:14:String
   951 /opt/local//lib/ruby/site_ruby/1.8/rubygems/version.rb:111:String
   935 /opt/local//lib/ruby/site_ruby/1.8/rubygems/specification.rb:557:String
   834 /opt/local//lib/ruby/site_ruby/1.8/rubygems/version.rb:146:Array
  ...</tt></pre>
</div></div>
<div class="paragraph"><p>W ten sposób możesz znaleźć miejsca, w których twoja aplikacja traci pamięć i naprawić to.</p></div>
<div class="paragraph"><p>Jeśli BleakHouse nie znajduje żadnego niekontrolowanego wzrostu a wciąż
następuje zwiększenie wykorzystania pamięci, możesz posiadać uszkodzone
rozszerzenie C, lub prawdziwy wyciek w interpreterze. W takim wypadku spróbuj
użyć Valgrind w celu głębszego zbadania sytuacji.</p></div>
<h3 id="_valgrind">4.2. Valgrind</h3>
<div class="paragraph"><p><a href="http://valgrind.org/">Valgrind</a> to aplikacja tylko dla systemu Linux
używana do wykrywania wycieków pamięci w C oraz sytuacji wyścigu (race
conditions).</p></div>
<div class="paragraph"><p>Istnieją narzędzia Valgrind które mogą automatycznie wykryć liczne błędy
zarządzania pamięcią i szczegółowo ustawić twój program. Na przykład,
rozszerzenie C w interpreterze wywołuje <tt>malloc()</tt> ale nie wywołuje
prawidłowo <tt>free()</tt> - ta pamięć nie będzie już dostępna aż do wyłączenia aplikacji.</p></div>
<div class="paragraph"><p>Po więcej informacji jak zainstalować Valgrind oraz używać go z Ruby, odsyłamy
do
<a href="http://blog.evanweaver.com/articles/2008/02/05/valgrind-and-ruby/">Valgrind
and Ruby</a> autorstwa Evana Weavera.</p></div>
</div>
<h2 id="_pluginy_do_debugowania">5. Pluginy do Debugowania</h2>
<div class="sectionbody">
<div class="paragraph"><p>Istnieją pluginy Rails mogące pomóc ci znaleźć błędy oraz zdebugować twoją aplikację. Oto lista użytecznych pluginów do debugowania:</p></div>
<div class="ulist"><ul>
<li>
<p>
<a href="http://github.com/drnic/rails-footnotes/tree/master">Footnotes</a>: Każda strona
  Rails posiada na dole przypisy które podają informację o żądaniach i odsyłają z powrotem do twojego kodu źródłowego poprzez TextMate.
</p>
</li>
<li>
<p>
<a href="http://github.com/ntalbott/query_trace/tree/master">Query Trace</a>: Dodaje śledzenie pochodzenia zapytań do twoich logów.
</p>
</li>
<li>
<p>
<a href="http://github.com/dan-manges/query_stats/tree/master">Query Stats</a>: Plugin Rails do śledzenia zapytań bazy danych.
</p>
</li>
<li>
<p>
<a href="http://code.google.com/p/query-reviewer/">Query Reviewer</a>: Ten plugin Rails
  nie tylko uruchamia "EXPLAIN" przed każdym z twoich zapytań <tt>select</tt> w
  trybie programowania, ale dodaje niewielki DIV na każdej renderowanej
  stronie z podsumowaniem ostrzeżeń dla każdego analizowanego zapytania.
</p>
</li>
<li>
<p>
<a href="http://github.com/rails/exception_notification/tree/master">Exception
  Notifier</a>: Zapewnia obiekt mailer oraz domyślny zestaw szablonów do wysyłania mailowych ostrzeżeń, gdy wystąpi błąd aplikacji Rails.
</p>
</li>
<li>
<p>
<a href="http://github.com/defunkt/exception_logger/tree/master">Exception Logger</a>: Loguje twoje wyjątki Rails w bazie danych i zapewnia stylowy interfejs sieciowy do zarządzania nimi.
</p>
</li>
</ul></div>
</div>
<h2 id="_odno_niki">6. Odnośniki</h2>
<div class="sectionbody">
<div class="ulist"><ul>
<li>
<p>
<a href="http://www.datanoise.com/ruby-debug">ruby-debug Homepage</a>
</p>
</li>
<li>
<p>
<a href="http://www.sitepoint.com/article/debug-rails-app-ruby-debug/">Article: Debugging a Rails application with ruby-debug</a>
</p>
</li>
<li>
<p>
<a href="http://brian.maybeyoureinsane.net/blog/2007/05/07/ruby-debug-basics-screencast/">ruby-debug Basics screencast</a>
</p>
</li>
<li>
<p>
<a href="http://railscasts.com/episodes/54-debugging-with-ruby-debug">Ryan Bate&#8217;s ruby-debug screencast</a>
</p>
</li>
<li>
<p>
<a href="http://railscasts.com/episodes/24-the-stack-trace">Ryan Bate&#8217;s stack trace screencast</a>
</p>
</li>
<li>
<p>
<a href="http://railscasts.com/episodes/56-the-logger">Ryan Bate&#8217;s logger screencast</a>
</p>
</li>
<li>
<p>
<a href="http://bashdb.sourceforge.net/ruby-debug.html">Debugging with ruby-debug</a>
</p>
</li>
<li>
<p>
<a href="http://cheat.errtheblog.com/s/rdebug/">ruby-debug cheat sheet</a>
</p>
</li>
<li>
<p>
<a href="http://wiki.rubyonrails.org/rails/pages/HowtoConfigureLogging">Ruby on Rails Wiki: How to Configure Logging</a>
</p>
</li>
<li>
<p>
<a href="http://blog.evanweaver.com/files/doc/fauna/bleak_house/files/README.html">Bleak House Documentation</a>
</p>
</li>
</ul></div>
</div>
<h2 id="_changelog">7. Changelog</h2>
<div class="sectionbody">
<div class="paragraph"><p><a href="http://rails.lighthouseapp.com/projects/16213-rails-guides/tickets/5">Lighthouse ticket</a></p></div>
<div class="ulist"><ul>
<li>
<p>
November 3, 2008: Accepted for publication. Added RJS, memory leaks and plugins chapters by <a href="../authors.html#miloops">Emilio Tagua</a>
</p>
</li>
<li>
<p>
October 19, 2008: Copy editing pass by <a href="../authors.html#mgunderloy">Mike Gunderloy</a>
</p>
</li>
<li>
<p>
September 16, 2008: initial version by <a href="../authors.html#miloops">Emilio Tagua</a>
</p>
</li>
</ul></div>
</div>

    </div>
  </div>
</body>
</html>
